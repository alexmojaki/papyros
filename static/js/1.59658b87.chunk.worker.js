!function(n){var t={};function e(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=n,e.c=t,e.d=function(n,t,r){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:r})},e.r=function(n){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"===typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)e.d(r,o,function(t){return n[t]}.bind(null,o));return r},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="./",e(e.s=0)}([function(n,t,e){"use strict";function r(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}function o(n,t){if(n){if("string"===typeof n)return r(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(n,t):void 0}}function a(n,t){return function(n){if(Array.isArray(n))return n}(n)||function(n,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(n)){var e=[],r=!0,o=!1,a=void 0;try{for(var i,u=n[Symbol.iterator]();!(r=(i=u.next()).done)&&(e.push(i.value),!t||e.length!==t);r=!0);}catch(c){o=!0,a=c}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}return e}}(n,t)||o(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(n,t){var e;if("undefined"===typeof Symbol||null==n[Symbol.iterator]){if(Array.isArray(n)||(e=o(n))||t&&n&&"number"===typeof n.length){e&&(n=e);var r=0,a=function(){};return{s:a,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(n){throw n},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){e=n[Symbol.iterator]()},n:function(){var n=e.next();return u=n.done,n},e:function(n){c=!0,i=n},f:function(){try{u||null==e.return||e.return()}finally{if(c)throw i}}}}function u(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function c(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function s(n,t,e){return t&&c(n.prototype,t),e&&c(n,e),n}function f(n,t){return(f=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n})(n,t)}function l(n){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(n)}function p(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(n){return!1}}function y(n){return(y="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"===typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}function v(n,t){return!t||"object"!==y(t)&&"function"!==typeof t?function(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(n):t}function d(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function m(n,t,e){return(m=p()?Reflect.construct:function(n,t,e){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(n,r));return e&&f(o,e.prototype),o}).apply(null,arguments)}function b(n){return function(n){if(Array.isArray(n))return r(n)}(n)||function(n){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(n))return Array.from(n)}(n)||o(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}e.r(t);var g=Symbol("Comlink.proxy"),h=Symbol("Comlink.endpoint"),S=Symbol("Comlink.releaseProxy"),E=Symbol("Comlink.thrown"),w=function(n){return"object"===typeof n&&null!==n||"function"===typeof n},_=new Map([["proxy",{canHandle:function(n){return w(n)&&n[g]},serialize:function(n){var t=new MessageChannel,e=t.port1,r=t.port2;return O(n,e),[r,[r]]},deserialize:function(n){return n.start(),P(n,[],t);var t}}],["throw",{canHandle:function(n){return w(n)&&E in n},serialize:function(n){var t=n.value;return[t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[]]},deserialize:function(n){if(n.isError)throw Object.assign(new Error(n.value.message),n.value);throw n.value}}]]);function O(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:self;t.addEventListener("message",(function e(r){if(r&&r.data){var o,i=Object.assign({path:[]},r.data),u=i.id,c=i.type,s=i.path,f=(r.data.argumentList||[]).map(N);try{var l=s.slice(0,-1).reduce((function(n,t){return n[t]}),n),p=s.reduce((function(n,t){return n[t]}),n);switch(c){case"GET":o=p;break;case"SET":l[s.slice(-1)[0]]=N(r.data.value),o=!0;break;case"APPLY":o=p.apply(l,f);break;case"CONSTRUCT":var y;o=k(m(p,b(f)));break;case"ENDPOINT":var v=new MessageChannel,g=v.port1,h=v.port2;O(n,h),o=R(g,[g]);break;case"RELEASE":o=void 0;break;default:return}}catch(y){o=d({value:y},E,0)}Promise.resolve(o).catch((function(n){return d({value:n},E,0)})).then((function(n){var r=a(M(n),2),o=r[0],i=r[1];t.postMessage(Object.assign(Object.assign({},o),{id:u}),i),"RELEASE"===c&&(t.removeEventListener("message",e),j(t))}))}})),t.start&&t.start()}function j(n){(function(n){return"MessagePort"===n.constructor.name})(n)&&n.close()}function A(n){if(n)throw new Error("Proxy has been released and is not useable")}function P(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=!1,o=new Proxy(e,{get:function(e,a){if(A(r),a===S)return function(){return C(n,{type:"RELEASE",path:t.map((function(n){return n.toString()}))}).then((function(){j(n),r=!0}))};if("then"===a){if(0===t.length)return{then:function(){return o}};var i=C(n,{type:"GET",path:t.map((function(n){return n.toString()}))}).then(N);return i.then.bind(i)}return P(n,[].concat(b(t),[a]))},set:function(e,o,i){A(r);var u=a(M(i),2),c=u[0],s=u[1];return C(n,{type:"SET",path:[].concat(b(t),[o]).map((function(n){return n.toString()})),value:c},s).then(N)},apply:function(e,o,i){A(r);var u=t[t.length-1];if(u===h)return C(n,{type:"ENDPOINT"}).then(N);if("bind"===u)return P(n,t.slice(0,-1));var c=a(x(i),2),s=c[0],f=c[1];return C(n,{type:"APPLY",path:t.map((function(n){return n.toString()})),argumentList:s},f).then(N)},construct:function(e,o){A(r);var i=a(x(o),2),u=i[0],c=i[1];return C(n,{type:"CONSTRUCT",path:t.map((function(n){return n.toString()})),argumentList:u},c).then(N)}});return o}function x(n){var t,e=n.map(M);return[e.map((function(n){return n[0]})),(t=e.map((function(n){return n[1]})),Array.prototype.concat.apply([],t))]}var T=new WeakMap;function R(n,t){return T.set(n,t),n}function k(n){return Object.assign(n,d({},g,!0))}function M(n){var t,e=i(_);try{for(e.s();!(t=e.n()).done;){var r=a(t.value,2),o=r[0],u=r[1];if(u.canHandle(n)){var c=a(u.serialize(n),2);return[{type:"HANDLER",name:o,value:c[0]},c[1]]}}}catch(s){e.e(s)}finally{e.f()}return[{type:"RAW",value:n},T.get(n)||[]]}function N(n){switch(n.type){case"HANDLER":return _.get(n.name).deserialize(n.value);case"RAW":return n.value}}function C(n,t,e){return new Promise((function(r){var o=new Array(4).fill(0).map((function(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)})).join("-");n.addEventListener("message",(function t(e){e.data&&e.data.id&&e.data.id===o&&(n.removeEventListener("message",t),r(e.data))})),n.start&&n.start(),n.postMessage(Object.assign({id:o},t),e)}))}var I;!function(n){n[n.Debug=0]="Debug",n[n.Error=1]="Error",n[n.Important=2]="Important"}(I||(I={}));function L(n){var t=n!==I.Debug;if(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];var a,i;if(n===I.Error)(a=console).error.apply(a,r);else(i=console).log.apply(i,r)}}O(new(function(n){!function(n,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),t&&f(n,t)}(e,n);var t=function(n){var t=p();return function(){var e,r=l(n);if(t){var o=l(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return v(this,e)}}(e);function e(){return u(this,e),t.apply(this,arguments)}return s(e,[{key:"_runCodeInternal",value:function(n){var t=new Map([["prompt","__prompt"],["console.log","__papyros_log"],["console.error","__papyros_error"]]),e={__onEvent:this.onEvent.bind(this)},r=[],o=[];for(var u in e)o.push("const ".concat(u," = ctx['").concat(u,"'];"));var c,s=i(t.entries());try{for(s.s();!(c=s.n()).done;){var f=a(c.value,2),l=f[0],p=f[1];o.push("".concat(p," = ").concat(l)),r.push("".concat(l," = ").concat(p))}}catch(v){s.e(v)}finally{s.f()}o.push('\nfunction prompt(text="", defaultText=""){\n    __onEvent({"type": "output", "data": text});\n    const promptedValue = __onEvent({"type": "input", "data": text});\n    __onEvent({"type": "output", "data": promptedValue + "\\n"});\n    return promptedValue;\n}\nfunction __stringify(args, addNewline=false){\n    let asString = "";\n    if(Array.isArray(args)){\n        if(args.length === 1){\n            asString = JSON.stringify(args[0]);\n        } else {\n            asString = args.map(s => {\n                if(typeof s === \'string\' || s instanceof String){\n                    return s; // prevent spurious quotes\n                } else {\n                    return JSON.stringify(s);\n                }\n            }).join(" ");\n        }\n    } else {\n        asString = JSON.stringify(args);\n    }\n    if(addNewline){\n        asString += "\\n";\n    }\n    return asString;\n}\nconsole.log = (...args) => {\n    __onEvent({"type": "output", "data": __stringify(args, true)});\n}\nconsole.error = (...args) => {\n    __onEvent({"type": "error", "data": __stringify(args, true)});\n}\n        '),o.push("\ntry {\n".concat(n,"\n} finally {\n").concat(r.join("\n"),"\n}\n        "));var y=o.join("\n");return Promise.resolve(new Function("ctx",y)(e))}}]),e}(function(){function n(){u(this,n),this.onEvent=void 0,this.onEvent=function(n){}}return s(n,[{key:"launch",value:function(n,t,e){var r=function(n,t){if(n&&t){var e=new TextDecoder;return function(){for(;"timed-out"===Atomics.wait(t,0,0,100););Atomics.store(t,0,0);var r=Atomics.exchange(t,1,0),o=n.slice(0,r);return e.decode(o)}}return function(){var n=new XMLHttpRequest;do{n.open("GET","/__papyros_input",!1),n.send(null)}while(n.status>=400);return n.responseText}}(t,e);return this.onEvent=function(t){if(n(t),"input"===t.type)return r()},Promise.resolve()}},{key:"runCode",value:function(n){var t=this;return L(I.Debug,"Running code in worker: ",n),this._runCodeInternal(n).then((function(e){return L(I.Important,"ran code: "+n+" and received: ",e),t.onEvent({type:"success",data:e})})).catch((function(n){var e="toString"in n?n.toString():JSON.stringify(n);return L(I.Error,"Error during execution: ",n,e),t.onEvent({type:"error",data:e})}))}}]),n}())))}]);
//# sourceMappingURL=1.59658b87.chunk.worker.js.map