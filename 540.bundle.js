(()=>{"use strict";const t=Symbol("Comlink.proxy"),n=Symbol("Comlink.endpoint"),e=Symbol("Comlink.releaseProxy"),r=Symbol("Comlink.thrown"),o=t=>"object"==typeof t&&null!==t||"function"==typeof t,a=new Map([["proxy",{canHandle:n=>o(n)&&n[t],serialize(t){const{port1:n,port2:e}=new MessageChannel;return i(t,n),[e,[e]]},deserialize:t=>(t.start(),c(t,[],undefined))}],["throw",{canHandle:t=>o(t)&&r in t,serialize({value:t}){let n;return n=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[n,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function i(n,e=self){e.addEventListener("message",(function o(a){if(!a||!a.data)return;const{id:u,type:c,path:l}=Object.assign({path:[]},a.data),h=(a.data.argumentList||[]).map(y);let d;try{const e=l.slice(0,-1).reduce(((t,n)=>t[n]),n),r=l.reduce(((t,n)=>t[n]),n);switch(c){case"GET":d=r;break;case"SET":e[l.slice(-1)[0]]=y(a.data.value),d=!0;break;case"APPLY":d=r.apply(e,h);break;case"CONSTRUCT":d=function(n){return Object.assign(n,{[t]:!0})}(new r(...h));break;case"ENDPOINT":{const{port1:t,port2:e}=new MessageChannel;i(n,e),d=function(t,n){return p.set(t,n),t}(t,[t])}break;case"RELEASE":d=void 0;break;default:return}}catch(t){d={value:t,[r]:0}}Promise.resolve(d).catch((t=>({value:t,[r]:0}))).then((t=>{const[n,r]=f(t);e.postMessage(Object.assign(Object.assign({},n),{id:u}),r),"RELEASE"===c&&(e.removeEventListener("message",o),s(e))}))})),e.start&&e.start()}function s(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function u(t){if(t)throw new Error("Proxy has been released and is not useable")}function c(t,r=[],o=function(){}){let a=!1;const i=new Proxy(o,{get(n,o){if(u(a),o===e)return()=>h(t,{type:"RELEASE",path:r.map((t=>t.toString()))}).then((()=>{s(t),a=!0}));if("then"===o){if(0===r.length)return{then:()=>i};const n=h(t,{type:"GET",path:r.map((t=>t.toString()))}).then(y);return n.then.bind(n)}return c(t,[...r,o])},set(n,e,o){u(a);const[i,s]=f(o);return h(t,{type:"SET",path:[...r,e].map((t=>t.toString())),value:i},s).then(y)},apply(e,o,i){u(a);const s=r[r.length-1];if(s===n)return h(t,{type:"ENDPOINT"}).then(y);if("bind"===s)return c(t,r.slice(0,-1));const[p,f]=l(i);return h(t,{type:"APPLY",path:r.map((t=>t.toString())),argumentList:p},f).then(y)},construct(n,e){u(a);const[o,i]=l(e);return h(t,{type:"CONSTRUCT",path:r.map((t=>t.toString())),argumentList:o},i).then(y)}});return i}function l(t){const n=t.map(f);return[n.map((t=>t[0])),(e=n.map((t=>t[1])),Array.prototype.concat.apply([],e))];var e}const p=new WeakMap;function f(t){for(const[n,e]of a)if(e.canHandle(t)){const[r,o]=e.serialize(t);return[{type:"HANDLER",name:n,value:r},o]}return[{type:"RAW",value:t},p.get(t)||[]]}function y(t){switch(t.type){case"HANDLER":return a.get(t.name).deserialize(t.value);case"RAW":return t.value}}function h(t,n,e){return new Promise((r=>{const o=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function n(e){e.data&&e.data.id&&e.data.id===o&&(t.removeEventListener("message",n),r(e.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:o},n),e)}))}var d,g=function(t,n){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var r,o,a=e.call(t),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(e=a.return)&&e.call(a)}finally{if(o)throw o.error}}return i},v=function(t,n,e){if(e||2===arguments.length)for(var r,o=0,a=n.length;o<a;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return t.concat(r||Array.prototype.slice.call(n))};function m(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var r=t!==d.Debug;r&&(t===d.Error?console.error.apply(console,v([],g(n),!1)):console.log.apply(console,v([],g(n),!1)))}!function(t){t[t.Debug=0]="Debug",t[t.Error=1]="Error",t[t.Important=2]="Important"}(d||(d={}));var b,E=function(){function t(){this.onEvent=function(){}}return t.prototype.launch=function(t,n,e){var r=function(t,n){if(t&&n){var e=new TextDecoder;return function(){for(;"timed-out"===Atomics.wait(n,0,0,100););Atomics.store(n,0,0);var r=Atomics.exchange(n,1,0),o=t.slice(0,r);return e.decode(o)}}return function(){var t=new XMLHttpRequest;do{t.open("GET","/__papyros_input",!1),t.send(null)}while(t.status>=400);return t.responseText}}(n,e);return this.onEvent=function(n){if(t(n),"input"===n.type)return r()},Promise.resolve()},t.prototype.runCode=function(t){return n=this,e=void 0,o=function(){var n,e,r;return function(t,n){var e,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(t,i)}catch(t){a=[6,t],r=0}finally{e=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}(this,(function(o){switch(o.label){case 0:m(d.Debug,"Running code in worker: ",t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._runCodeInternal(t)];case 2:return n=o.sent(),m(d.Important,"ran code: "+t+" and received: ",n),[2,this.onEvent({type:"success",data:n})];case 3:return e=o.sent(),r="toString"in e?e.toString():JSON.stringify(e),m(d.Error,"Error during execution: ",e,r),[2,this.onEvent({type:"error",data:r})];case 4:return[2]}}))},new((r=void 0)||(r=Promise))((function(t,a){function i(t){try{u(o.next(t))}catch(t){a(t)}}function s(t){try{u(o.throw(t))}catch(t){a(t)}}function u(n){var e;n.done?t(n.value):(e=n.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,s)}u((o=o.apply(n,e||[])).next())}));var n,e,r,o},t}(),w=(b=function(t,n){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},b(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}b(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}),S=function(t,n){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var r,o,a=e.call(t),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(e=a.return)&&e.call(a)}finally{if(o)throw o.error}}return i};i(new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return w(n,t),n.prototype._runCodeInternal=function(t){var n,e,r=new Map([["prompt","__prompt"],["console.log","__papyros_log"],["console.error","__papyros_error"]]),o={__onEvent:this.onEvent.bind(this)},a=[],i=[];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&i.push("const "+s+" = ctx['"+s+"'];");try{for(var u=function(t){var n="function"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(r.entries()),c=u.next();!c.done;c=u.next()){var l=S(c.value,2),p=l[0],f=l[1];i.push(f+" = "+p),a.push(p+" = "+f)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(e=u.return)&&e.call(u)}finally{if(n)throw n.error}}i.push('\nfunction prompt(text="", defaultText=""){\n    __onEvent({"type": "output", "data": text});\n    const promptedValue = __onEvent({"type": "input", "data": text});\n    __onEvent({"type": "output", "data": promptedValue + "\\n"});\n    return promptedValue;\n}\nfunction __stringify(args, addNewline=false){\n    let asString = "";\n    if(Array.isArray(args)){\n        if(args.length === 1){\n            asString = JSON.stringify(args[0]);\n        } else {\n            asString = args.map(s => {\n                if(typeof s === \'string\' || s instanceof String){\n                    return s; // prevent spurious quotes\n                } else {\n                    return JSON.stringify(s);\n                }\n            }).join(" ");\n        }\n    } else {\n        asString = JSON.stringify(args);\n    }\n    if(addNewline){\n        asString += "\\n";\n    }\n    return asString;\n}\nconsole.log = (...args) => {\n    __onEvent({"type": "output", "data": __stringify(args, true)});\n}\nconsole.error = (...args) => {\n    __onEvent({"type": "error", "data": __stringify(args, true)});\n}\n        '),i.push("\ntry {\n"+t+"\n} finally {\n"+a.join("\n")+"\n}\n        ");var y=i.join("\n");return Promise.resolve(new Function("ctx",y)(o))},n}(E)))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVdELEVBQVFqRixNQUFPLDJCQUE0QixFQUFPb0gsR0FDdEQsQ0FBUCxFQUFPMUIsS0FBS0MsUUFBUSxDQUFFN0UsS0FBTSxRQUFTRixLQUFNd0csSyxzVEFHdkQsRUE5Q0EsRyw2dEJDc0NBNUgsRUFBTyxJQXZFUCx5QiwrQ0FxRUEsT0FyRStCLE9BQ2xCLFlBQUEwSCxpQkFBVCxTQUEwQkQsRyxRQUNoQk0sRUFBWSxJQUFJdEksSUFBSSxDQUN0QixDQUFDLFNBQVUsWUFDWCxDQUFDLGNBQWUsaUJBQ2hCLENBQUMsZ0JBQWlCLHFCQXNDaEJ1SSxFQUFhLENBQ2YsVUFBYTlCLEtBQUtDLFFBQVFsQyxLQUFLaUMsT0FFN0IrQixFQUFrQixHQUNsQkMsRUFBVSxHQUNoQixJQUFLLElBQU1DLEtBQUtILEVBQ1JuSCxPQUFPOEQsVUFBVXlELGVBQWVDLEtBQUtMLEVBQVlHLElBQ2pERCxFQUFRSSxLQUFLLFNBQVNILEVBQUMsV0FBV0EsRUFBQyxPLElBRzNDLElBQTJCLE0seVNBQUEsQ0FBQUosRUFBVVEsV0FBUyw4QkFBRSxDQUFyQyxtQkFBQ0MsRUFBRSxLQUFFQyxFQUFNLEtBQ2xCUCxFQUFRSSxLQUFRRyxFQUFNLE1BQU1ELEdBQzVCUCxFQUFnQkssS0FBUUUsRUFBRSxNQUFNQyxJLGlHQUVwQ1AsRUFBUUksS0FsRGlCLGltQ0FtRHpCSixFQUFRSSxLQUFLLFlBRW5CYixFQUFJLGtCQUVKUSxFQUFnQjFDLEtBQUssTUFBSyxpQkFHcEIsSUFBTW1ELEVBQVNSLEVBQVEzQyxLQUFLLE1BRTVCLE9BQU8vQyxRQUFRQyxRQUFRLElBQUlrRyxTQUFTLE1BQU9ELEVBQXBCLENBQTRCVixLQUUzRCxFQXJFQSxDQUErQlksTSIsInNvdXJjZXMiOlsid2VicGFjazovL3BhcHlyb3MvLi9ub2RlX21vZHVsZXMvY29tbGluay9kaXN0L2VzbS9jb21saW5rLm1qcyIsIndlYnBhY2s6Ly9wYXB5cm9zLy4vc3JjL0NvbnN0YW50cy50cyIsIndlYnBhY2s6Ly9wYXB5cm9zLy4vc3JjL3V0aWwvTG9nZ2luZy50cyIsIndlYnBhY2s6Ly9wYXB5cm9zLy4vc3JjL0JhY2tlbmQudHMiLCJ3ZWJwYWNrOi8vcGFweXJvcy8uL3NyYy93b3JrZXJzL2phdmFzY3JpcHQvSmF2YVNjcmlwdFdvcmtlci53b3JrZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgcHJveHlNYXJrZXIgPSBTeW1ib2woXCJDb21saW5rLnByb3h5XCIpO1xyXG5jb25zdCBjcmVhdGVFbmRwb2ludCA9IFN5bWJvbChcIkNvbWxpbmsuZW5kcG9pbnRcIik7XHJcbmNvbnN0IHJlbGVhc2VQcm94eSA9IFN5bWJvbChcIkNvbWxpbmsucmVsZWFzZVByb3h5XCIpO1xyXG5jb25zdCB0aHJvd01hcmtlciA9IFN5bWJvbChcIkNvbWxpbmsudGhyb3duXCIpO1xyXG5jb25zdCBpc09iamVjdCA9ICh2YWwpID0+ICh0eXBlb2YgdmFsID09PSBcIm9iamVjdFwiICYmIHZhbCAhPT0gbnVsbCkgfHwgdHlwZW9mIHZhbCA9PT0gXCJmdW5jdGlvblwiO1xyXG4vKipcclxuICogSW50ZXJuYWwgdHJhbnNmZXIgaGFuZGxlIHRvIGhhbmRsZSBvYmplY3RzIG1hcmtlZCB0byBwcm94eS5cclxuICovXHJcbmNvbnN0IHByb3h5VHJhbnNmZXJIYW5kbGVyID0ge1xyXG4gICAgY2FuSGFuZGxlOiAodmFsKSA9PiBpc09iamVjdCh2YWwpICYmIHZhbFtwcm94eU1hcmtlcl0sXHJcbiAgICBzZXJpYWxpemUob2JqKSB7XHJcbiAgICAgICAgY29uc3QgeyBwb3J0MSwgcG9ydDIgfSA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpO1xyXG4gICAgICAgIGV4cG9zZShvYmosIHBvcnQxKTtcclxuICAgICAgICByZXR1cm4gW3BvcnQyLCBbcG9ydDJdXTtcclxuICAgIH0sXHJcbiAgICBkZXNlcmlhbGl6ZShwb3J0KSB7XHJcbiAgICAgICAgcG9ydC5zdGFydCgpO1xyXG4gICAgICAgIHJldHVybiB3cmFwKHBvcnQpO1xyXG4gICAgfSxcclxufTtcclxuLyoqXHJcbiAqIEludGVybmFsIHRyYW5zZmVyIGhhbmRsZXIgdG8gaGFuZGxlIHRocm93biBleGNlcHRpb25zLlxyXG4gKi9cclxuY29uc3QgdGhyb3dUcmFuc2ZlckhhbmRsZXIgPSB7XHJcbiAgICBjYW5IYW5kbGU6ICh2YWx1ZSkgPT4gaXNPYmplY3QodmFsdWUpICYmIHRocm93TWFya2VyIGluIHZhbHVlLFxyXG4gICAgc2VyaWFsaXplKHsgdmFsdWUgfSkge1xyXG4gICAgICAgIGxldCBzZXJpYWxpemVkO1xyXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIHNlcmlhbGl6ZWQgPSB7XHJcbiAgICAgICAgICAgICAgICBpc0Vycm9yOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiB2YWx1ZS5tZXNzYWdlLFxyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHZhbHVlLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhY2s6IHZhbHVlLnN0YWNrLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHNlcmlhbGl6ZWQgPSB7IGlzRXJyb3I6IGZhbHNlLCB2YWx1ZSB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gW3NlcmlhbGl6ZWQsIFtdXTtcclxuICAgIH0sXHJcbiAgICBkZXNlcmlhbGl6ZShzZXJpYWxpemVkKSB7XHJcbiAgICAgICAgaWYgKHNlcmlhbGl6ZWQuaXNFcnJvcikge1xyXG4gICAgICAgICAgICB0aHJvdyBPYmplY3QuYXNzaWduKG5ldyBFcnJvcihzZXJpYWxpemVkLnZhbHVlLm1lc3NhZ2UpLCBzZXJpYWxpemVkLnZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3cgc2VyaWFsaXplZC52YWx1ZTtcclxuICAgIH0sXHJcbn07XHJcbi8qKlxyXG4gKiBBbGxvd3MgY3VzdG9taXppbmcgdGhlIHNlcmlhbGl6YXRpb24gb2YgY2VydGFpbiB2YWx1ZXMuXHJcbiAqL1xyXG5jb25zdCB0cmFuc2ZlckhhbmRsZXJzID0gbmV3IE1hcChbXHJcbiAgICBbXCJwcm94eVwiLCBwcm94eVRyYW5zZmVySGFuZGxlcl0sXHJcbiAgICBbXCJ0aHJvd1wiLCB0aHJvd1RyYW5zZmVySGFuZGxlcl0sXHJcbl0pO1xyXG5mdW5jdGlvbiBleHBvc2Uob2JqLCBlcCA9IHNlbGYpIHtcclxuICAgIGVwLmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIGZ1bmN0aW9uIGNhbGxiYWNrKGV2KSB7XHJcbiAgICAgICAgaWYgKCFldiB8fCAhZXYuZGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHsgaWQsIHR5cGUsIHBhdGggfSA9IE9iamVjdC5hc3NpZ24oeyBwYXRoOiBbXSB9LCBldi5kYXRhKTtcclxuICAgICAgICBjb25zdCBhcmd1bWVudExpc3QgPSAoZXYuZGF0YS5hcmd1bWVudExpc3QgfHwgW10pLm1hcChmcm9tV2lyZVZhbHVlKTtcclxuICAgICAgICBsZXQgcmV0dXJuVmFsdWU7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgcGFyZW50ID0gcGF0aC5zbGljZSgwLCAtMSkucmVkdWNlKChvYmosIHByb3ApID0+IG9ialtwcm9wXSwgb2JqKTtcclxuICAgICAgICAgICAgY29uc3QgcmF3VmFsdWUgPSBwYXRoLnJlZHVjZSgob2JqLCBwcm9wKSA9PiBvYmpbcHJvcF0sIG9iaik7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIkdFVFwiIC8qIEdFVCAqLzpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gcmF3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIlNFVFwiIC8qIFNFVCAqLzpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudFtwYXRoLnNsaWNlKC0xKVswXV0gPSBmcm9tV2lyZVZhbHVlKGV2LmRhdGEudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIkFQUExZXCIgLyogQVBQTFkgKi86XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHJhd1ZhbHVlLmFwcGx5KHBhcmVudCwgYXJndW1lbnRMaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiQ09OU1RSVUNUXCIgLyogQ09OU1RSVUNUICovOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBuZXcgcmF3VmFsdWUoLi4uYXJndW1lbnRMaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBwcm94eSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIkVORFBPSU5UXCIgLyogRU5EUE9JTlQgKi86XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHBvcnQxLCBwb3J0MiB9ID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9zZShvYmosIHBvcnQyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSB0cmFuc2Zlcihwb3J0MSwgW3BvcnQxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIlJFTEVBU0VcIiAvKiBSRUxFQVNFICovOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVyblZhbHVlID0geyB2YWx1ZSwgW3Rocm93TWFya2VyXTogMCB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBQcm9taXNlLnJlc29sdmUocmV0dXJuVmFsdWUpXHJcbiAgICAgICAgICAgIC5jYXRjaCgodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWUsIFt0aHJvd01hcmtlcl06IDAgfTtcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAudGhlbigocmV0dXJuVmFsdWUpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgW3dpcmVWYWx1ZSwgdHJhbnNmZXJhYmxlc10gPSB0b1dpcmVWYWx1ZShyZXR1cm5WYWx1ZSk7XHJcbiAgICAgICAgICAgIGVwLnBvc3RNZXNzYWdlKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgd2lyZVZhbHVlKSwgeyBpZCB9KSwgdHJhbnNmZXJhYmxlcyk7XHJcbiAgICAgICAgICAgIGlmICh0eXBlID09PSBcIlJFTEVBU0VcIiAvKiBSRUxFQVNFICovKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBkZXRhY2ggYW5kIGRlYWN0aXZlIGFmdGVyIHNlbmRpbmcgcmVsZWFzZSByZXNwb25zZSBhYm92ZS5cclxuICAgICAgICAgICAgICAgIGVwLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIGNhbGxiYWNrKTtcclxuICAgICAgICAgICAgICAgIGNsb3NlRW5kUG9pbnQoZXApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIGlmIChlcC5zdGFydCkge1xyXG4gICAgICAgIGVwLnN0YXJ0KCk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gaXNNZXNzYWdlUG9ydChlbmRwb2ludCkge1xyXG4gICAgcmV0dXJuIGVuZHBvaW50LmNvbnN0cnVjdG9yLm5hbWUgPT09IFwiTWVzc2FnZVBvcnRcIjtcclxufVxyXG5mdW5jdGlvbiBjbG9zZUVuZFBvaW50KGVuZHBvaW50KSB7XHJcbiAgICBpZiAoaXNNZXNzYWdlUG9ydChlbmRwb2ludCkpXHJcbiAgICAgICAgZW5kcG9pbnQuY2xvc2UoKTtcclxufVxyXG5mdW5jdGlvbiB3cmFwKGVwLCB0YXJnZXQpIHtcclxuICAgIHJldHVybiBjcmVhdGVQcm94eShlcCwgW10sIHRhcmdldCk7XHJcbn1cclxuZnVuY3Rpb24gdGhyb3dJZlByb3h5UmVsZWFzZWQoaXNSZWxlYXNlZCkge1xyXG4gICAgaWYgKGlzUmVsZWFzZWQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQcm94eSBoYXMgYmVlbiByZWxlYXNlZCBhbmQgaXMgbm90IHVzZWFibGVcIik7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gY3JlYXRlUHJveHkoZXAsIHBhdGggPSBbXSwgdGFyZ2V0ID0gZnVuY3Rpb24gKCkgeyB9KSB7XHJcbiAgICBsZXQgaXNQcm94eVJlbGVhc2VkID0gZmFsc2U7XHJcbiAgICBjb25zdCBwcm94eSA9IG5ldyBQcm94eSh0YXJnZXQsIHtcclxuICAgICAgICBnZXQoX3RhcmdldCwgcHJvcCkge1xyXG4gICAgICAgICAgICB0aHJvd0lmUHJveHlSZWxlYXNlZChpc1Byb3h5UmVsZWFzZWQpO1xyXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gcmVsZWFzZVByb3h5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiUkVMRUFTRVwiIC8qIFJFTEVBU0UgKi8sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgubWFwKChwKSA9PiBwLnRvU3RyaW5nKCkpLFxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZUVuZFBvaW50KGVwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXNQcm94eVJlbGVhc2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHByb3AgPT09IFwidGhlblwiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4geyB0aGVuOiAoKSA9PiBwcm94eSB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc3QgciA9IHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIkdFVFwiIC8qIEdFVCAqLyxcclxuICAgICAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLm1hcCgocCkgPT4gcC50b1N0cmluZygpKSxcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnJvbVdpcmVWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gci50aGVuLmJpbmQocik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVByb3h5KGVwLCBbLi4ucGF0aCwgcHJvcF0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0KF90YXJnZXQsIHByb3AsIHJhd1ZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRocm93SWZQcm94eVJlbGVhc2VkKGlzUHJveHlSZWxlYXNlZCk7XHJcbiAgICAgICAgICAgIC8vIEZJWE1FOiBFUzYgUHJveHkgSGFuZGxlciBgc2V0YCBtZXRob2RzIGFyZSBzdXBwb3NlZCB0byByZXR1cm4gYVxyXG4gICAgICAgICAgICAvLyBib29sZWFuLiBUbyBzaG93IGdvb2Qgd2lsbCwgd2UgcmV0dXJuIHRydWUgYXN5bmNocm9ub3VzbHkgwq9cXF8o44OEKV8vwq9cclxuICAgICAgICAgICAgY29uc3QgW3ZhbHVlLCB0cmFuc2ZlcmFibGVzXSA9IHRvV2lyZVZhbHVlKHJhd1ZhbHVlKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwiU0VUXCIgLyogU0VUICovLFxyXG4gICAgICAgICAgICAgICAgcGF0aDogWy4uLnBhdGgsIHByb3BdLm1hcCgocCkgPT4gcC50b1N0cmluZygpKSxcclxuICAgICAgICAgICAgICAgIHZhbHVlLFxyXG4gICAgICAgICAgICB9LCB0cmFuc2ZlcmFibGVzKS50aGVuKGZyb21XaXJlVmFsdWUpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYXBwbHkoX3RhcmdldCwgX3RoaXNBcmcsIHJhd0FyZ3VtZW50TGlzdCkge1xyXG4gICAgICAgICAgICB0aHJvd0lmUHJveHlSZWxlYXNlZChpc1Byb3h5UmVsZWFzZWQpO1xyXG4gICAgICAgICAgICBjb25zdCBsYXN0ID0gcGF0aFtwYXRoLmxlbmd0aCAtIDFdO1xyXG4gICAgICAgICAgICBpZiAobGFzdCA9PT0gY3JlYXRlRW5kcG9pbnQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJFTkRQT0lOVFwiIC8qIEVORFBPSU5UICovLFxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmcm9tV2lyZVZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBXZSBqdXN0IHByZXRlbmQgdGhhdCBgYmluZCgpYCBkaWRu4oCZdCBoYXBwZW4uXHJcbiAgICAgICAgICAgIGlmIChsYXN0ID09PSBcImJpbmRcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVByb3h5KGVwLCBwYXRoLnNsaWNlKDAsIC0xKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgW2FyZ3VtZW50TGlzdCwgdHJhbnNmZXJhYmxlc10gPSBwcm9jZXNzQXJndW1lbnRzKHJhd0FyZ3VtZW50TGlzdCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcIkFQUExZXCIgLyogQVBQTFkgKi8sXHJcbiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLm1hcCgocCkgPT4gcC50b1N0cmluZygpKSxcclxuICAgICAgICAgICAgICAgIGFyZ3VtZW50TGlzdCxcclxuICAgICAgICAgICAgfSwgdHJhbnNmZXJhYmxlcykudGhlbihmcm9tV2lyZVZhbHVlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNvbnN0cnVjdChfdGFyZ2V0LCByYXdBcmd1bWVudExpc3QpIHtcclxuICAgICAgICAgICAgdGhyb3dJZlByb3h5UmVsZWFzZWQoaXNQcm94eVJlbGVhc2VkKTtcclxuICAgICAgICAgICAgY29uc3QgW2FyZ3VtZW50TGlzdCwgdHJhbnNmZXJhYmxlc10gPSBwcm9jZXNzQXJndW1lbnRzKHJhd0FyZ3VtZW50TGlzdCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcIkNPTlNUUlVDVFwiIC8qIENPTlNUUlVDVCAqLyxcclxuICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgubWFwKChwKSA9PiBwLnRvU3RyaW5nKCkpLFxyXG4gICAgICAgICAgICAgICAgYXJndW1lbnRMaXN0LFxyXG4gICAgICAgICAgICB9LCB0cmFuc2ZlcmFibGVzKS50aGVuKGZyb21XaXJlVmFsdWUpO1xyXG4gICAgICAgIH0sXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBwcm94eTtcclxufVxyXG5mdW5jdGlvbiBteUZsYXQoYXJyKSB7XHJcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmNvbmNhdC5hcHBseShbXSwgYXJyKTtcclxufVxyXG5mdW5jdGlvbiBwcm9jZXNzQXJndW1lbnRzKGFyZ3VtZW50TGlzdCkge1xyXG4gICAgY29uc3QgcHJvY2Vzc2VkID0gYXJndW1lbnRMaXN0Lm1hcCh0b1dpcmVWYWx1ZSk7XHJcbiAgICByZXR1cm4gW3Byb2Nlc3NlZC5tYXAoKHYpID0+IHZbMF0pLCBteUZsYXQocHJvY2Vzc2VkLm1hcCgodikgPT4gdlsxXSkpXTtcclxufVxyXG5jb25zdCB0cmFuc2ZlckNhY2hlID0gbmV3IFdlYWtNYXAoKTtcclxuZnVuY3Rpb24gdHJhbnNmZXIob2JqLCB0cmFuc2ZlcnMpIHtcclxuICAgIHRyYW5zZmVyQ2FjaGUuc2V0KG9iaiwgdHJhbnNmZXJzKTtcclxuICAgIHJldHVybiBvYmo7XHJcbn1cclxuZnVuY3Rpb24gcHJveHkob2JqKSB7XHJcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihvYmosIHsgW3Byb3h5TWFya2VyXTogdHJ1ZSB9KTtcclxufVxyXG5mdW5jdGlvbiB3aW5kb3dFbmRwb2ludCh3LCBjb250ZXh0ID0gc2VsZiwgdGFyZ2V0T3JpZ2luID0gXCIqXCIpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcG9zdE1lc3NhZ2U6IChtc2csIHRyYW5zZmVyYWJsZXMpID0+IHcucG9zdE1lc3NhZ2UobXNnLCB0YXJnZXRPcmlnaW4sIHRyYW5zZmVyYWJsZXMpLFxyXG4gICAgICAgIGFkZEV2ZW50TGlzdGVuZXI6IGNvbnRleHQuYWRkRXZlbnRMaXN0ZW5lci5iaW5kKGNvbnRleHQpLFxyXG4gICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXI6IGNvbnRleHQucmVtb3ZlRXZlbnRMaXN0ZW5lci5iaW5kKGNvbnRleHQpLFxyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiB0b1dpcmVWYWx1ZSh2YWx1ZSkge1xyXG4gICAgZm9yIChjb25zdCBbbmFtZSwgaGFuZGxlcl0gb2YgdHJhbnNmZXJIYW5kbGVycykge1xyXG4gICAgICAgIGlmIChoYW5kbGVyLmNhbkhhbmRsZSh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgY29uc3QgW3NlcmlhbGl6ZWRWYWx1ZSwgdHJhbnNmZXJhYmxlc10gPSBoYW5kbGVyLnNlcmlhbGl6ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJIQU5ETEVSXCIgLyogSEFORExFUiAqLyxcclxuICAgICAgICAgICAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBzZXJpYWxpemVkVmFsdWUsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgdHJhbnNmZXJhYmxlcyxcclxuICAgICAgICAgICAgXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdHlwZTogXCJSQVdcIiAvKiBSQVcgKi8sXHJcbiAgICAgICAgICAgIHZhbHVlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdHJhbnNmZXJDYWNoZS5nZXQodmFsdWUpIHx8IFtdLFxyXG4gICAgXTtcclxufVxyXG5mdW5jdGlvbiBmcm9tV2lyZVZhbHVlKHZhbHVlKSB7XHJcbiAgICBzd2l0Y2ggKHZhbHVlLnR5cGUpIHtcclxuICAgICAgICBjYXNlIFwiSEFORExFUlwiIC8qIEhBTkRMRVIgKi86XHJcbiAgICAgICAgICAgIHJldHVybiB0cmFuc2ZlckhhbmRsZXJzLmdldCh2YWx1ZS5uYW1lKS5kZXNlcmlhbGl6ZSh2YWx1ZS52YWx1ZSk7XHJcbiAgICAgICAgY2FzZSBcIlJBV1wiIC8qIFJBVyAqLzpcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnZhbHVlO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIG1zZywgdHJhbnNmZXJzKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgICBjb25zdCBpZCA9IGdlbmVyYXRlVVVJRCgpO1xyXG4gICAgICAgIGVwLmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIGZ1bmN0aW9uIGwoZXYpIHtcclxuICAgICAgICAgICAgaWYgKCFldi5kYXRhIHx8ICFldi5kYXRhLmlkIHx8IGV2LmRhdGEuaWQgIT09IGlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXAucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgbCk7XHJcbiAgICAgICAgICAgIHJlc29sdmUoZXYuZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKGVwLnN0YXJ0KSB7XHJcbiAgICAgICAgICAgIGVwLnN0YXJ0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVwLnBvc3RNZXNzYWdlKE9iamVjdC5hc3NpZ24oeyBpZCB9LCBtc2cpLCB0cmFuc2ZlcnMpO1xyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gZ2VuZXJhdGVVVUlEKCkge1xyXG4gICAgcmV0dXJuIG5ldyBBcnJheSg0KVxyXG4gICAgICAgIC5maWxsKDApXHJcbiAgICAgICAgLm1hcCgoKSA9PiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikudG9TdHJpbmcoMTYpKVxyXG4gICAgICAgIC5qb2luKFwiLVwiKTtcclxufVxuXG5leHBvcnQgeyBjcmVhdGVFbmRwb2ludCwgZXhwb3NlLCBwcm94eSwgcHJveHlNYXJrZXIsIHJlbGVhc2VQcm94eSwgdHJhbnNmZXIsIHRyYW5zZmVySGFuZGxlcnMsIHdpbmRvd0VuZHBvaW50LCB3cmFwIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb21saW5rLm1qcy5tYXBcbiIsImV4cG9ydCBjb25zdCBNQUlOX0FQUF9JRCA9IFwicGFweXJvc1wiO1xuXG5leHBvcnQgY29uc3QgT1VUUFVUX1RBX0lEID0gXCJjb2RlLW91dHB1dC1hcmVhXCI7XG5leHBvcnQgY29uc3QgSU5QVVRfVEFfSUQgPSBcImNvZGUtaW5wdXQtYXJlYVwiO1xuZXhwb3J0IGNvbnN0IENPREVfVEFfSUQgPSBcImNvZGUtYXJlYVwiO1xuXG5leHBvcnQgY29uc3QgU1RBVEVfU1BJTk5FUl9JRCA9IFwic3RhdGUtc3Bpbm5lclwiO1xuZXhwb3J0IGNvbnN0IEFQUExJQ0FUSU9OX1NUQVRFX1BfSUQgPSBcImFwcGxpY2F0aW9uLXN0YXRlLXBcIjtcblxuZXhwb3J0IGNvbnN0IFJVTl9CVE5fSUQgPSBcInJ1bi1jb2RlLWJ0blwiO1xuZXhwb3J0IGNvbnN0IFRFUk1JTkFURV9CVE5fSUQgPSBcInRlcm1pbmF0ZS1idG5cIjtcblxuZXhwb3J0IGNvbnN0IExBTkdVQUdFX1NFTEVDVF9JRCA9IFwibGFuZ3VhZ2Utc2VsZWN0XCI7XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX1BST0dSQU1NSU5HX0xBTkdVQUdFID0gXCJweXRob25cIjtcblxuZXhwb3J0IGNvbnN0IElOUFVUX1JFTEFUSVZFX1VSTCA9IFwiL19fcGFweXJvc19pbnB1dFwiO1xuIiwiZXhwb3J0IGVudW0gTG9nVHlwZSB7XG4gICAgRGVidWcsIEVycm9yLCBJbXBvcnRhbnRcbn1cblxuY29uc3QgRU5WSVJPTk1FTlQ6IHN0cmluZyA9IHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8IFwiZGV2ZWxvcG1lbnRcIjtcbmV4cG9ydCBmdW5jdGlvbiBwYXB5cm9zTG9nKGxvZ1R5cGU6IExvZ1R5cGUsIC4uLmFyZ3M6IGFueVtdKTogdm9pZCB7XG4gICAgY29uc3QgZG9Mb2cgPSBFTlZJUk9OTUVOVCAhPT0gXCJwcm9kdWN0aW9uXCIgfHwgbG9nVHlwZSAhPT0gTG9nVHlwZS5EZWJ1ZztcbiAgICBpZiAoZG9Mb2cpIHtcbiAgICAgICAgaWYgKGxvZ1R5cGUgPT09IExvZ1R5cGUuRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoLi4uYXJncyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyguLi5hcmdzKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsImltcG9ydCB7IElOUFVUX1JFTEFUSVZFX1VSTCB9IGZyb20gXCIuL0NvbnN0YW50c1wiO1xuaW1wb3J0IHsgUGFweXJvc0V2ZW50IH0gZnJvbSBcIi4vUGFweXJvc0V2ZW50XCI7XG5pbXBvcnQgeyBMb2dUeXBlLCBwYXB5cm9zTG9nIH0gZnJvbSBcIi4vdXRpbC9Mb2dnaW5nXCI7XG5cbmZ1bmN0aW9uIGdldElucHV0Q2FsbGJhY2soaW5wdXRUZXh0QXJyYXk/OiBVaW50OEFycmF5LCBpbnB1dE1ldGFEYXRhPzogSW50MzJBcnJheSk6ICgpID0+IHN0cmluZyB7XG4gICAgaWYgKGlucHV0VGV4dEFycmF5ICYmIGlucHV0TWV0YURhdGEpIHtcbiAgICAgICAgY29uc3QgdGV4dERlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zdGFudC1jb25kaXRpb25cbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKEF0b21pY3Mud2FpdChpbnB1dE1ldGFEYXRhLCAwLCAwLCAxMDApID09PSBcInRpbWVkLW91dFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHBhcHlyb3NMb2cubG9nKFwid2FpdGluZyBvbiBpbnB1dFwiKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgKGludGVycnVwdEJ1ZmZlclswXSA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICAvLyAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBBdG9taWNzLnN0b3JlKGlucHV0TWV0YURhdGEsIDAsIDApO1xuICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IEF0b21pY3MuZXhjaGFuZ2UoaW5wdXRNZXRhRGF0YSwgMSwgMCk7XG4gICAgICAgICAgICBjb25zdCBieXRlcyA9IGlucHV0VGV4dEFycmF5LnNsaWNlKDAsIHNpemUpO1xuICAgICAgICAgICAgcmV0dXJuIHRleHREZWNvZGVyLmRlY29kZShieXRlcyk7XG4gICAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICAvLyBgZmFsc2VgIG1ha2VzIHRoZSByZXF1ZXN0IHN5bmNocm9ub3VzXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vcGVuKFwiR0VUXCIsIElOUFVUX1JFTEFUSVZFX1VSTCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIHJlcXVlc3Quc2VuZChudWxsKTtcbiAgICAgICAgICAgIH0gd2hpbGUgKHJlcXVlc3Quc3RhdHVzID49IDQwMCk7IC8vIHRvZG8gYmV0dGVyIGVycm9yIGhhbmRsaW5nXG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdC5yZXNwb25zZVRleHQ7XG4gICAgICAgIH07XG4gICAgfVxufVxuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmFja2VuZCB7XG4gICAgb25FdmVudDogKGU6IFBhcHlyb3NFdmVudCkgPT4gdm9pZDtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWVtcHR5LWZ1bmN0aW9uXG4gICAgICAgIHRoaXMub25FdmVudCA9ICgpID0+IHsgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBiYWNrZW5kLCBzZXR0aW5nIHVwIGFueSBnbG9iYWxzIHJlcXVpcmVkXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbihQYXB5cm9zRXZlbnQpOnZvaWR9IG9uRXZlbnQgQ2FsbGJhY2sgZm9yIHdoZW4gZXZlbnRzIG9jY3VyXG4gICAgICogQHBhcmFtIHtVaW50OEFycmF5fSBpbnB1dFRleHRBcnJheSBPcHRpb25hbCBzaGFyZWQgYnVmZmVyIGZvciBpbnB1dFxuICAgICAqIEBwYXJhbSB7SW50MzJBcnJheX0gaW5wdXRNZXRhRGF0YSBPcHRpb25hbCBzaGFyZWQgYnVmZmVyIGZvciBtZXRhZGF0YSBhYm91dCBpbnB1dFxuICAgICAqIEByZXR1cm4ge1Byb21pc2U8dm9pZD59IFByb21pc2Ugb2YgbGF1bmNoaW5nXG4gICAgICovXG4gICAgbGF1bmNoKG9uRXZlbnQ6IChlOiBQYXB5cm9zRXZlbnQpID0+IHZvaWQsXG4gICAgICAgIGlucHV0VGV4dEFycmF5PzogVWludDhBcnJheSwgaW5wdXRNZXRhRGF0YT86IEludDMyQXJyYXkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgaW5wdXRDYWxsYmFjayA9IGdldElucHV0Q2FsbGJhY2soaW5wdXRUZXh0QXJyYXksIGlucHV0TWV0YURhdGEpO1xuICAgICAgICB0aGlzLm9uRXZlbnQgPSAoZTogUGFweXJvc0V2ZW50KSA9PiB7XG4gICAgICAgICAgICBvbkV2ZW50KGUpO1xuICAgICAgICAgICAgaWYgKGUudHlwZSA9PT0gXCJpbnB1dFwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0Q2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cblxuICAgIGFic3RyYWN0IF9ydW5Db2RlSW50ZXJuYWwoY29kZTogc3RyaW5nKTogUHJvbWlzZTxhbnk+O1xuXG4gICAgLyoqXG4gICAgICogVmFsaWRhdGUgYW5kIHJ1biBhcmJpdHJhcnkgY29kZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjb2RlIFRoZSBjb2RlIHRvIHJ1blxuICAgICAqIEByZXR1cm4ge1Byb21pc2U8dm9pZD59IFByb21pc2Ugb2YgZXhlY3V0aW9uXG4gICAgICovXG4gICAgYXN5bmMgcnVuQ29kZShjb2RlOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcGFweXJvc0xvZyhMb2dUeXBlLkRlYnVnLCBcIlJ1bm5pbmcgY29kZSBpbiB3b3JrZXI6IFwiLCBjb2RlKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLl9ydW5Db2RlSW50ZXJuYWwoY29kZSk7XG4gICAgICAgICAgICBwYXB5cm9zTG9nKExvZ1R5cGUuSW1wb3J0YW50LCBcInJhbiBjb2RlOiBcIiArIGNvZGUgKyBcIiBhbmQgcmVjZWl2ZWQ6IFwiLCBkYXRhKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9uRXZlbnQoeyB0eXBlOiBcInN1Y2Nlc3NcIiwgZGF0YTogZGF0YSB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICAgICAgY29uc3QgZXJyb3JTdHJpbmcgPSBcInRvU3RyaW5nXCIgaW4gZXJyb3IgPyBlcnJvci50b1N0cmluZygpIDogSlNPTi5zdHJpbmdpZnkoZXJyb3IpO1xuICAgICAgICAgICAgcGFweXJvc0xvZyhMb2dUeXBlLkVycm9yLCBcIkVycm9yIGR1cmluZyBleGVjdXRpb246IFwiLCBlcnJvciwgZXJyb3JTdHJpbmcpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub25FdmVudCh7IHR5cGU6IFwiZXJyb3JcIiwgZGF0YTogZXJyb3JTdHJpbmcgfSk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCJpbXBvcnQgeyBleHBvc2UgfSBmcm9tIFwiY29tbGlua1wiO1xuaW1wb3J0IHsgQmFja2VuZCB9IGZyb20gXCIuLi8uLi9CYWNrZW5kXCI7XG5cblxuY2xhc3MgSmF2YVNjcmlwdFdvcmtlciBleHRlbmRzIEJhY2tlbmQge1xuICAgIG92ZXJyaWRlIF9ydW5Db2RlSW50ZXJuYWwoY29kZTogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgY29uc3QgdG9SZXN0b3JlID0gbmV3IE1hcChbXG4gICAgICAgICAgICBbXCJwcm9tcHRcIiwgXCJfX3Byb21wdFwiXSxcbiAgICAgICAgICAgIFtcImNvbnNvbGUubG9nXCIsIFwiX19wYXB5cm9zX2xvZ1wiXSxcbiAgICAgICAgICAgIFtcImNvbnNvbGUuZXJyb3JcIiwgXCJfX3BhcHlyb3NfZXJyb3JcIl1cbiAgICAgICAgXSk7XG4gICAgICAgIGNvbnN0IG92ZXJyaWRlQnVpbHRpbnMgPSBgXG5mdW5jdGlvbiBwcm9tcHQodGV4dD1cIlwiLCBkZWZhdWx0VGV4dD1cIlwiKXtcbiAgICBfX29uRXZlbnQoe1widHlwZVwiOiBcIm91dHB1dFwiLCBcImRhdGFcIjogdGV4dH0pO1xuICAgIGNvbnN0IHByb21wdGVkVmFsdWUgPSBfX29uRXZlbnQoe1widHlwZVwiOiBcImlucHV0XCIsIFwiZGF0YVwiOiB0ZXh0fSk7XG4gICAgX19vbkV2ZW50KHtcInR5cGVcIjogXCJvdXRwdXRcIiwgXCJkYXRhXCI6IHByb21wdGVkVmFsdWUgKyBcIlxcXFxuXCJ9KTtcbiAgICByZXR1cm4gcHJvbXB0ZWRWYWx1ZTtcbn1cbmZ1bmN0aW9uIF9fc3RyaW5naWZ5KGFyZ3MsIGFkZE5ld2xpbmU9ZmFsc2Upe1xuICAgIGxldCBhc1N0cmluZyA9IFwiXCI7XG4gICAgaWYoQXJyYXkuaXNBcnJheShhcmdzKSl7XG4gICAgICAgIGlmKGFyZ3MubGVuZ3RoID09PSAxKXtcbiAgICAgICAgICAgIGFzU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoYXJnc1swXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhc1N0cmluZyA9IGFyZ3MubWFwKHMgPT4ge1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBzID09PSAnc3RyaW5nJyB8fCBzIGluc3RhbmNlb2YgU3RyaW5nKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHM7IC8vIHByZXZlbnQgc3B1cmlvdXMgcXVvdGVzXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmpvaW4oXCIgXCIpO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgYXNTdHJpbmcgPSBKU09OLnN0cmluZ2lmeShhcmdzKTtcbiAgICB9XG4gICAgaWYoYWRkTmV3bGluZSl7XG4gICAgICAgIGFzU3RyaW5nICs9IFwiXFxcXG5cIjtcbiAgICB9XG4gICAgcmV0dXJuIGFzU3RyaW5nO1xufVxuY29uc29sZS5sb2cgPSAoLi4uYXJncykgPT4ge1xuICAgIF9fb25FdmVudCh7XCJ0eXBlXCI6IFwib3V0cHV0XCIsIFwiZGF0YVwiOiBfX3N0cmluZ2lmeShhcmdzLCB0cnVlKX0pO1xufVxuY29uc29sZS5lcnJvciA9ICguLi5hcmdzKSA9PiB7XG4gICAgX19vbkV2ZW50KHtcInR5cGVcIjogXCJlcnJvclwiLCBcImRhdGFcIjogX19zdHJpbmdpZnkoYXJncywgdHJ1ZSl9KTtcbn1cbiAgICAgICAgYDtcbiAgICAgICAgY29uc3QgbmV3Q29udGV4dCA9IHtcbiAgICAgICAgICAgIFwiX19vbkV2ZW50XCI6IHRoaXMub25FdmVudC5iaW5kKHRoaXMpXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHJlc3RvcmVCdWlsdGlucyA9IFtdO1xuICAgICAgICBjb25zdCBuZXdCb2R5ID0gW107XG4gICAgICAgIGZvciAoY29uc3QgayBpbiBuZXdDb250ZXh0KSB7XG4gICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG5ld0NvbnRleHQsIGspKSB7XG4gICAgICAgICAgICAgICAgbmV3Qm9keS5wdXNoKGBjb25zdCAke2t9ID0gY3R4Wycke2t9J107YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBbZm4sIGJhY2t1cF0gb2YgdG9SZXN0b3JlLmVudHJpZXMoKSkge1xuICAgICAgICAgICAgbmV3Qm9keS5wdXNoKGAke2JhY2t1cH0gPSAke2ZufWApO1xuICAgICAgICAgICAgcmVzdG9yZUJ1aWx0aW5zLnB1c2goYCR7Zm59ID0gJHtiYWNrdXB9YCk7XG4gICAgICAgIH1cbiAgICAgICAgbmV3Qm9keS5wdXNoKG92ZXJyaWRlQnVpbHRpbnMpO1xuICAgICAgICBuZXdCb2R5LnB1c2goYFxudHJ5IHtcbiR7Y29kZX1cbn0gZmluYWxseSB7XG4ke3Jlc3RvcmVCdWlsdGlucy5qb2luKFwiXFxuXCIpfVxufVxuICAgICAgICBgKTtcbiAgICAgICAgY29uc3QgZm5Cb2R5ID0gbmV3Qm9keS5qb2luKFwiXFxuXCIpO1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tbmV3LWZ1bmNcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgRnVuY3Rpb24oXCJjdHhcIiwgZm5Cb2R5KShuZXdDb250ZXh0KSk7XG4gICAgfVxufVxuXG5leHBvc2UobmV3IEphdmFTY3JpcHRXb3JrZXIoKSk7XG4iXSwibmFtZXMiOlsicHJveHlNYXJrZXIiLCJTeW1ib2wiLCJjcmVhdGVFbmRwb2ludCIsInJlbGVhc2VQcm94eSIsInRocm93TWFya2VyIiwiaXNPYmplY3QiLCJ2YWwiLCJ0cmFuc2ZlckhhbmRsZXJzIiwiTWFwIiwiY2FuSGFuZGxlIiwic2VyaWFsaXplIiwib2JqIiwicG9ydDEiLCJwb3J0MiIsIk1lc3NhZ2VDaGFubmVsIiwiZXhwb3NlIiwiZGVzZXJpYWxpemUiLCJwb3J0Iiwic3RhcnQiLCJjcmVhdGVQcm94eSIsInRhcmdldCIsInZhbHVlIiwic2VyaWFsaXplZCIsIkVycm9yIiwiaXNFcnJvciIsIm1lc3NhZ2UiLCJuYW1lIiwic3RhY2siLCJPYmplY3QiLCJhc3NpZ24iLCJlcCIsInNlbGYiLCJhZGRFdmVudExpc3RlbmVyIiwiY2FsbGJhY2siLCJldiIsImRhdGEiLCJpZCIsInR5cGUiLCJwYXRoIiwiYXJndW1lbnRMaXN0IiwibWFwIiwiZnJvbVdpcmVWYWx1ZSIsInJldHVyblZhbHVlIiwicGFyZW50Iiwic2xpY2UiLCJyZWR1Y2UiLCJwcm9wIiwicmF3VmFsdWUiLCJhcHBseSIsInByb3h5IiwidHJhbnNmZXJzIiwidHJhbnNmZXJDYWNoZSIsInNldCIsInRyYW5zZmVyIiwidW5kZWZpbmVkIiwiUHJvbWlzZSIsInJlc29sdmUiLCJjYXRjaCIsInRoZW4iLCJ3aXJlVmFsdWUiLCJ0cmFuc2ZlcmFibGVzIiwidG9XaXJlVmFsdWUiLCJwb3N0TWVzc2FnZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjbG9zZUVuZFBvaW50IiwiZW5kcG9pbnQiLCJjb25zdHJ1Y3RvciIsImlzTWVzc2FnZVBvcnQiLCJjbG9zZSIsInRocm93SWZQcm94eVJlbGVhc2VkIiwiaXNSZWxlYXNlZCIsImlzUHJveHlSZWxlYXNlZCIsIlByb3h5IiwiZ2V0IiwiX3RhcmdldCIsInJlcXVlc3RSZXNwb25zZU1lc3NhZ2UiLCJwIiwidG9TdHJpbmciLCJsZW5ndGgiLCJyIiwiYmluZCIsIl90aGlzQXJnIiwicmF3QXJndW1lbnRMaXN0IiwibGFzdCIsInByb2Nlc3NBcmd1bWVudHMiLCJjb25zdHJ1Y3QiLCJwcm9jZXNzZWQiLCJ2IiwiYXJyIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJjb25jYXQiLCJXZWFrTWFwIiwiaGFuZGxlciIsInNlcmlhbGl6ZWRWYWx1ZSIsIm1zZyIsImZpbGwiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJOdW1iZXIiLCJNQVhfU0FGRV9JTlRFR0VSIiwiam9pbiIsImwiLCJMb2dUeXBlIiwicGFweXJvc0xvZyIsImxvZ1R5cGUiLCJkb0xvZyIsIkRlYnVnIiwiY29uc29sZSIsImVycm9yIiwiYXJncyIsImxvZyIsInRoaXMiLCJvbkV2ZW50IiwibGF1bmNoIiwiaW5wdXRUZXh0QXJyYXkiLCJpbnB1dE1ldGFEYXRhIiwiaW5wdXRDYWxsYmFjayIsIlRleHREZWNvZGVyIiwiQXRvbWljcyIsIndhaXQiLCJzdG9yZSIsInNpemUiLCJleGNoYW5nZSIsImJ5dGVzIiwiZGVjb2RlIiwicmVxdWVzdCIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsInNlbmQiLCJzdGF0dXMiLCJyZXNwb25zZVRleHQiLCJnZXRJbnB1dENhbGxiYWNrIiwiZSIsInJ1bkNvZGUiLCJjb2RlIiwiX3J1bkNvZGVJbnRlcm5hbCIsIkltcG9ydGFudCIsImVycm9yU3RyaW5nIiwiSlNPTiIsInN0cmluZ2lmeSIsInRvUmVzdG9yZSIsIm5ld0NvbnRleHQiLCJyZXN0b3JlQnVpbHRpbnMiLCJuZXdCb2R5IiwiayIsImhhc093blByb3BlcnR5IiwiY2FsbCIsInB1c2giLCJlbnRyaWVzIiwiZm4iLCJiYWNrdXAiLCJmbkJvZHkiLCJGdW5jdGlvbiIsIkJhY2tlbmQiXSwic291cmNlUm9vdCI6IiJ9