(()=>{"use strict";const t=Symbol("Comlink.proxy"),n=Symbol("Comlink.endpoint"),e=Symbol("Comlink.releaseProxy"),r=Symbol("Comlink.thrown"),o=t=>"object"==typeof t&&null!==t||"function"==typeof t,a=new Map([["proxy",{canHandle:n=>o(n)&&n[t],serialize(t){const{port1:n,port2:e}=new MessageChannel;return i(t,n),[e,[e]]},deserialize:t=>(t.start(),c(t,[],undefined))}],["throw",{canHandle:t=>o(t)&&r in t,serialize({value:t}){let n;return n=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[n,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function i(n,e=self){e.addEventListener("message",(function o(a){if(!a||!a.data)return;const{id:u,type:c,path:l}=Object.assign({path:[]},a.data),h=(a.data.argumentList||[]).map(y);let d;try{const e=l.slice(0,-1).reduce(((t,n)=>t[n]),n),r=l.reduce(((t,n)=>t[n]),n);switch(c){case"GET":d=r;break;case"SET":e[l.slice(-1)[0]]=y(a.data.value),d=!0;break;case"APPLY":d=r.apply(e,h);break;case"CONSTRUCT":d=function(n){return Object.assign(n,{[t]:!0})}(new r(...h));break;case"ENDPOINT":{const{port1:t,port2:e}=new MessageChannel;i(n,e),d=function(t,n){return p.set(t,n),t}(t,[t])}break;case"RELEASE":d=void 0;break;default:return}}catch(t){d={value:t,[r]:0}}Promise.resolve(d).catch((t=>({value:t,[r]:0}))).then((t=>{const[n,r]=f(t);e.postMessage(Object.assign(Object.assign({},n),{id:u}),r),"RELEASE"===c&&(e.removeEventListener("message",o),s(e))}))})),e.start&&e.start()}function s(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function u(t){if(t)throw new Error("Proxy has been released and is not useable")}function c(t,r=[],o=function(){}){let a=!1;const i=new Proxy(o,{get(n,o){if(u(a),o===e)return()=>h(t,{type:"RELEASE",path:r.map((t=>t.toString()))}).then((()=>{s(t),a=!0}));if("then"===o){if(0===r.length)return{then:()=>i};const n=h(t,{type:"GET",path:r.map((t=>t.toString()))}).then(y);return n.then.bind(n)}return c(t,[...r,o])},set(n,e,o){u(a);const[i,s]=f(o);return h(t,{type:"SET",path:[...r,e].map((t=>t.toString())),value:i},s).then(y)},apply(e,o,i){u(a);const s=r[r.length-1];if(s===n)return h(t,{type:"ENDPOINT"}).then(y);if("bind"===s)return c(t,r.slice(0,-1));const[p,f]=l(i);return h(t,{type:"APPLY",path:r.map((t=>t.toString())),argumentList:p},f).then(y)},construct(n,e){u(a);const[o,i]=l(e);return h(t,{type:"CONSTRUCT",path:r.map((t=>t.toString())),argumentList:o},i).then(y)}});return i}function l(t){const n=t.map(f);return[n.map((t=>t[0])),(e=n.map((t=>t[1])),Array.prototype.concat.apply([],e))];var e}const p=new WeakMap;function f(t){for(const[n,e]of a)if(e.canHandle(t)){const[r,o]=e.serialize(t);return[{type:"HANDLER",name:n,value:r},o]}return[{type:"RAW",value:t},p.get(t)||[]]}function y(t){switch(t.type){case"HANDLER":return a.get(t.name).deserialize(t.value);case"RAW":return t.value}}function h(t,n,e){return new Promise((r=>{const o=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function n(e){e.data&&e.data.id&&e.data.id===o&&(t.removeEventListener("message",n),r(e.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:o},n),e)}))}var d,g=function(t,n){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var r,o,a=e.call(t),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(e=a.return)&&e.call(a)}finally{if(o)throw o.error}}return i},v=function(t,n,e){if(e||2===arguments.length)for(var r,o=0,a=n.length;o<a;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return t.concat(r||Array.prototype.slice.call(n))};function m(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var r=t!==d.Debug;r&&(t===d.Error?console.error.apply(console,v([],g(n),!1)):console.log.apply(console,v([],g(n),!1)))}!function(t){t[t.Debug=0]="Debug",t[t.Error=1]="Error",t[t.Important=2]="Important"}(d||(d={}));var b,E=function(){function t(){this.onEvent=function(){}}return t.prototype.launch=function(t,n,e){var r=function(t,n){if(t&&n){var e=new TextDecoder;return function(){for(;"timed-out"===Atomics.wait(n,0,0,100););Atomics.store(n,0,0);var r=Atomics.exchange(n,1,0),o=t.slice(0,r);return e.decode(o)}}return function(){var t=new XMLHttpRequest;do{t.open("GET","/__papyros_input",!1),t.send(null)}while(t.status>=400);return t.responseText}}(n,e);return this.onEvent=function(n){if(t(n),"input"===n.type)return r()},Promise.resolve()},t.prototype.runCode=function(t){return n=this,e=void 0,o=function(){var n,e,r;return function(t,n){var e,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(t,i)}catch(t){a=[6,t],r=0}finally{e=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}(this,(function(o){switch(o.label){case 0:m(d.Debug,"Running code in worker: ",t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._runCodeInternal(t)];case 2:return n=o.sent(),m(d.Important,"ran code: "+t+" and received: ",n),[2,this.onEvent({type:"success",data:n})];case 3:return e=o.sent(),r="toString"in e?e.toString():JSON.stringify(e),m(d.Error,"Error during execution: ",e,r),[2,this.onEvent({type:"error",data:r})];case 4:return[2]}}))},new((r=void 0)||(r=Promise))((function(t,a){function i(t){try{u(o.next(t))}catch(t){a(t)}}function s(t){try{u(o.throw(t))}catch(t){a(t)}}function u(n){var e;n.done?t(n.value):(e=n.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,s)}u((o=o.apply(n,e||[])).next())}));var n,e,r,o},t}(),w=(b=function(t,n){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},b(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}b(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}),S=function(t,n){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var r,o,a=e.call(t),i=[];try{for(;(void 0===n||n-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(e=a.return)&&e.call(a)}finally{if(o)throw o.error}}return i};i(new(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return w(n,t),n.prototype._runCodeInternal=function(t){var n,e,r=new Map([["prompt","__prompt"],["console.log","__papyros_log"],["console.error","__papyros_error"]]),o={__onEvent:this.onEvent.bind(this)},a=[],i=[];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&i.push("const "+s+" = ctx['"+s+"'];");try{for(var u=function(t){var n="function"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(r.entries()),c=u.next();!c.done;c=u.next()){var l=S(c.value,2),p=l[0],f=l[1];i.push(f+" = "+p),a.push(p+" = "+f)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(e=u.return)&&e.call(u)}finally{if(n)throw n.error}}i.push('\nfunction prompt(text="", defaultText=""){\n    __onEvent({"type": "output", "data": text});\n    const promptedValue = __onEvent({"type": "input", "data": text});\n    __onEvent({"type": "output", "data": promptedValue + "\\n"});\n    return promptedValue;\n}\nfunction __stringify(args, addNewline=false){\n    let asString = "";\n    if(Array.isArray(args)){\n        if(args.length === 1){\n            asString = JSON.stringify(args[0]);\n        } else {\n            asString = args.map(s => {\n                if(typeof s === \'string\' || s instanceof String){\n                    return s; // prevent spurious quotes\n                } else {\n                    return JSON.stringify(s);\n                }\n            }).join(" ");\n        }\n    } else {\n        asString = JSON.stringify(args);\n    }\n    if(addNewline){\n        asString += "\\n";\n    }\n    return asString;\n}\nconsole.log = (...args) => {\n    __onEvent({"type": "output", "data": __stringify(args, true)});\n}\nconsole.error = (...args) => {\n    __onEvent({"type": "error", "data": __stringify(args, true)});\n}\n        '),i.push("\ntry {\n"+t+"\n} finally {\n"+a.join("\n")+"\n}\n        ");var y=i.join("\n");return Promise.resolve(new Function("ctx",y)(o))},n}(E)))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBV0QsRUFBUWpGLE1BQU8sMkJBQTRCLEVBQU9vSCxHQUN0RCxDQUFQLEVBQU8xQixLQUFLQyxRQUFRLENBQUU3RSxLQUFNLFFBQVNGLEtBQU13RyxLLHNUQUd2RCxFQTlDQSxHLDZ0QkNzQ0E1SCxFQUFPLElBdkVQLHlCLCtDQXFFQSxPQXJFK0IsT0FDbEIsWUFBQTBILGlCQUFULFNBQTBCRCxHLFFBQ2hCTSxFQUFZLElBQUl0SSxJQUFJLENBQ3RCLENBQUMsU0FBVSxZQUNYLENBQUMsY0FBZSxpQkFDaEIsQ0FBQyxnQkFBaUIscUJBc0NoQnVJLEVBQWEsQ0FDZixVQUFhOUIsS0FBS0MsUUFBUWxDLEtBQUtpQyxPQUU3QitCLEVBQWtCLEdBQ2xCQyxFQUFVLEdBQ2hCLElBQUssSUFBTUMsS0FBS0gsRUFDUm5ILE9BQU84RCxVQUFVeUQsZUFBZUMsS0FBS0wsRUFBWUcsSUFDakRELEVBQVFJLEtBQUssU0FBU0gsRUFBQyxXQUFXQSxFQUFDLE8sSUFHM0MsSUFBMkIsTSx5U0FBQSxDQUFBSixFQUFVUSxXQUFTLDhCQUFFLENBQXJDLG1CQUFDQyxFQUFFLEtBQUVDLEVBQU0sS0FDbEJQLEVBQVFJLEtBQVFHLEVBQU0sTUFBTUQsR0FDNUJQLEVBQWdCSyxLQUFRRSxFQUFFLE1BQU1DLEksaUdBRXBDUCxFQUFRSSxLQWxEaUIsaW1DQW1EekJKLEVBQVFJLEtBQUssWUFFbkJiLEVBQUksa0JBRUpRLEVBQWdCMUMsS0FBSyxNQUFLLGlCQUdwQixJQUFNbUQsRUFBU1IsRUFBUTNDLEtBQUssTUFFNUIsT0FBTy9DLFFBQVFDLFFBQVEsSUFBSWtHLFNBQVMsTUFBT0QsRUFBcEIsQ0FBNEJWLEtBRTNELEVBckVBLENBQStCWSxNIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcGFweXJvcy8uL25vZGVfbW9kdWxlcy9jb21saW5rL2Rpc3QvZXNtL2NvbWxpbmsubWpzIiwid2VicGFjazovL3BhcHlyb3MvLi9zcmMvQ29uc3RhbnRzLnRzIiwid2VicGFjazovL3BhcHlyb3MvLi9zcmMvdXRpbC9Mb2dnaW5nLnRzIiwid2VicGFjazovL3BhcHlyb3MvLi9zcmMvQmFja2VuZC50cyIsIndlYnBhY2s6Ly9wYXB5cm9zLy4vc3JjL3dvcmtlcnMvamF2YXNjcmlwdC9KYXZhU2NyaXB0V29ya2VyLndvcmtlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBwcm94eU1hcmtlciA9IFN5bWJvbChcIkNvbWxpbmsucHJveHlcIik7XHJcbmNvbnN0IGNyZWF0ZUVuZHBvaW50ID0gU3ltYm9sKFwiQ29tbGluay5lbmRwb2ludFwiKTtcclxuY29uc3QgcmVsZWFzZVByb3h5ID0gU3ltYm9sKFwiQ29tbGluay5yZWxlYXNlUHJveHlcIik7XHJcbmNvbnN0IHRocm93TWFya2VyID0gU3ltYm9sKFwiQ29tbGluay50aHJvd25cIik7XHJcbmNvbnN0IGlzT2JqZWN0ID0gKHZhbCkgPT4gKHR5cGVvZiB2YWwgPT09IFwib2JqZWN0XCIgJiYgdmFsICE9PSBudWxsKSB8fCB0eXBlb2YgdmFsID09PSBcImZ1bmN0aW9uXCI7XHJcbi8qKlxyXG4gKiBJbnRlcm5hbCB0cmFuc2ZlciBoYW5kbGUgdG8gaGFuZGxlIG9iamVjdHMgbWFya2VkIHRvIHByb3h5LlxyXG4gKi9cclxuY29uc3QgcHJveHlUcmFuc2ZlckhhbmRsZXIgPSB7XHJcbiAgICBjYW5IYW5kbGU6ICh2YWwpID0+IGlzT2JqZWN0KHZhbCkgJiYgdmFsW3Byb3h5TWFya2VyXSxcclxuICAgIHNlcmlhbGl6ZShvYmopIHtcclxuICAgICAgICBjb25zdCB7IHBvcnQxLCBwb3J0MiB9ID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7XHJcbiAgICAgICAgZXhwb3NlKG9iaiwgcG9ydDEpO1xyXG4gICAgICAgIHJldHVybiBbcG9ydDIsIFtwb3J0Ml1dO1xyXG4gICAgfSxcclxuICAgIGRlc2VyaWFsaXplKHBvcnQpIHtcclxuICAgICAgICBwb3J0LnN0YXJ0KCk7XHJcbiAgICAgICAgcmV0dXJuIHdyYXAocG9ydCk7XHJcbiAgICB9LFxyXG59O1xyXG4vKipcclxuICogSW50ZXJuYWwgdHJhbnNmZXIgaGFuZGxlciB0byBoYW5kbGUgdGhyb3duIGV4Y2VwdGlvbnMuXHJcbiAqL1xyXG5jb25zdCB0aHJvd1RyYW5zZmVySGFuZGxlciA9IHtcclxuICAgIGNhbkhhbmRsZTogKHZhbHVlKSA9PiBpc09iamVjdCh2YWx1ZSkgJiYgdGhyb3dNYXJrZXIgaW4gdmFsdWUsXHJcbiAgICBzZXJpYWxpemUoeyB2YWx1ZSB9KSB7XHJcbiAgICAgICAgbGV0IHNlcmlhbGl6ZWQ7XHJcbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgc2VyaWFsaXplZCA9IHtcclxuICAgICAgICAgICAgICAgIGlzRXJyb3I6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHZhbHVlLm1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdmFsdWUubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBzdGFjazogdmFsdWUuc3RhY2ssXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgc2VyaWFsaXplZCA9IHsgaXNFcnJvcjogZmFsc2UsIHZhbHVlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBbc2VyaWFsaXplZCwgW11dO1xyXG4gICAgfSxcclxuICAgIGRlc2VyaWFsaXplKHNlcmlhbGl6ZWQpIHtcclxuICAgICAgICBpZiAoc2VyaWFsaXplZC5pc0Vycm9yKSB7XHJcbiAgICAgICAgICAgIHRocm93IE9iamVjdC5hc3NpZ24obmV3IEVycm9yKHNlcmlhbGl6ZWQudmFsdWUubWVzc2FnZSksIHNlcmlhbGl6ZWQudmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBzZXJpYWxpemVkLnZhbHVlO1xyXG4gICAgfSxcclxufTtcclxuLyoqXHJcbiAqIEFsbG93cyBjdXN0b21pemluZyB0aGUgc2VyaWFsaXphdGlvbiBvZiBjZXJ0YWluIHZhbHVlcy5cclxuICovXHJcbmNvbnN0IHRyYW5zZmVySGFuZGxlcnMgPSBuZXcgTWFwKFtcclxuICAgIFtcInByb3h5XCIsIHByb3h5VHJhbnNmZXJIYW5kbGVyXSxcclxuICAgIFtcInRocm93XCIsIHRocm93VHJhbnNmZXJIYW5kbGVyXSxcclxuXSk7XHJcbmZ1bmN0aW9uIGV4cG9zZShvYmosIGVwID0gc2VsZikge1xyXG4gICAgZXAuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgZnVuY3Rpb24gY2FsbGJhY2soZXYpIHtcclxuICAgICAgICBpZiAoIWV2IHx8ICFldi5kYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgeyBpZCwgdHlwZSwgcGF0aCB9ID0gT2JqZWN0LmFzc2lnbih7IHBhdGg6IFtdIH0sIGV2LmRhdGEpO1xyXG4gICAgICAgIGNvbnN0IGFyZ3VtZW50TGlzdCA9IChldi5kYXRhLmFyZ3VtZW50TGlzdCB8fCBbXSkubWFwKGZyb21XaXJlVmFsdWUpO1xyXG4gICAgICAgIGxldCByZXR1cm5WYWx1ZTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBwYXRoLnNsaWNlKDAsIC0xKS5yZWR1Y2UoKG9iaiwgcHJvcCkgPT4gb2JqW3Byb3BdLCBvYmopO1xyXG4gICAgICAgICAgICBjb25zdCByYXdWYWx1ZSA9IHBhdGgucmVkdWNlKChvYmosIHByb3ApID0+IG9ialtwcm9wXSwgb2JqKTtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiR0VUXCIgLyogR0VUICovOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSByYXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiU0VUXCIgLyogU0VUICovOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50W3BhdGguc2xpY2UoLTEpWzBdXSA9IGZyb21XaXJlVmFsdWUoZXYuZGF0YS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiQVBQTFlcIiAvKiBBUFBMWSAqLzpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gcmF3VmFsdWUuYXBwbHkocGFyZW50LCBhcmd1bWVudExpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJDT05TVFJVQ1RcIiAvKiBDT05TVFJVQ1QgKi86XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IG5ldyByYXdWYWx1ZSguLi5hcmd1bWVudExpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHByb3h5KHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiRU5EUE9JTlRcIiAvKiBFTkRQT0lOVCAqLzpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgcG9ydDEsIHBvcnQyIH0gPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwb3NlKG9iaiwgcG9ydDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHRyYW5zZmVyKHBvcnQxLCBbcG9ydDFdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiUkVMRUFTRVwiIC8qIFJFTEVBU0UgKi86XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAodmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSB7IHZhbHVlLCBbdGhyb3dNYXJrZXJdOiAwIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFByb21pc2UucmVzb2x2ZShyZXR1cm5WYWx1ZSlcclxuICAgICAgICAgICAgLmNhdGNoKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4geyB2YWx1ZSwgW3Rocm93TWFya2VyXTogMCB9O1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKChyZXR1cm5WYWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBbd2lyZVZhbHVlLCB0cmFuc2ZlcmFibGVzXSA9IHRvV2lyZVZhbHVlKHJldHVyblZhbHVlKTtcclxuICAgICAgICAgICAgZXAucG9zdE1lc3NhZ2UoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB3aXJlVmFsdWUpLCB7IGlkIH0pLCB0cmFuc2ZlcmFibGVzKTtcclxuICAgICAgICAgICAgaWYgKHR5cGUgPT09IFwiUkVMRUFTRVwiIC8qIFJFTEVBU0UgKi8pIHtcclxuICAgICAgICAgICAgICAgIC8vIGRldGFjaCBhbmQgZGVhY3RpdmUgYWZ0ZXIgc2VuZGluZyByZWxlYXNlIHJlc3BvbnNlIGFib3ZlLlxyXG4gICAgICAgICAgICAgICAgZXAucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgY2xvc2VFbmRQb2ludChlcCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgaWYgKGVwLnN0YXJ0KSB7XHJcbiAgICAgICAgZXAuc3RhcnQoKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBpc01lc3NhZ2VQb3J0KGVuZHBvaW50KSB7XHJcbiAgICByZXR1cm4gZW5kcG9pbnQuY29uc3RydWN0b3IubmFtZSA9PT0gXCJNZXNzYWdlUG9ydFwiO1xyXG59XHJcbmZ1bmN0aW9uIGNsb3NlRW5kUG9pbnQoZW5kcG9pbnQpIHtcclxuICAgIGlmIChpc01lc3NhZ2VQb3J0KGVuZHBvaW50KSlcclxuICAgICAgICBlbmRwb2ludC5jbG9zZSgpO1xyXG59XHJcbmZ1bmN0aW9uIHdyYXAoZXAsIHRhcmdldCkge1xyXG4gICAgcmV0dXJuIGNyZWF0ZVByb3h5KGVwLCBbXSwgdGFyZ2V0KTtcclxufVxyXG5mdW5jdGlvbiB0aHJvd0lmUHJveHlSZWxlYXNlZChpc1JlbGVhc2VkKSB7XHJcbiAgICBpZiAoaXNSZWxlYXNlZCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlByb3h5IGhhcyBiZWVuIHJlbGVhc2VkIGFuZCBpcyBub3QgdXNlYWJsZVwiKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBjcmVhdGVQcm94eShlcCwgcGF0aCA9IFtdLCB0YXJnZXQgPSBmdW5jdGlvbiAoKSB7IH0pIHtcclxuICAgIGxldCBpc1Byb3h5UmVsZWFzZWQgPSBmYWxzZTtcclxuICAgIGNvbnN0IHByb3h5ID0gbmV3IFByb3h5KHRhcmdldCwge1xyXG4gICAgICAgIGdldChfdGFyZ2V0LCBwcm9wKSB7XHJcbiAgICAgICAgICAgIHRocm93SWZQcm94eVJlbGVhc2VkKGlzUHJveHlSZWxlYXNlZCk7XHJcbiAgICAgICAgICAgIGlmIChwcm9wID09PSByZWxlYXNlUHJveHkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJSRUxFQVNFXCIgLyogUkVMRUFTRSAqLyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogcGF0aC5tYXAoKHApID0+IHAudG9TdHJpbmcoKSksXHJcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlRW5kUG9pbnQoZXApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1Byb3h5UmVsZWFzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gXCJ0aGVuXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwYXRoLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHRoZW46ICgpID0+IHByb3h5IH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCByID0gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiR0VUXCIgLyogR0VUICovLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgubWFwKChwKSA9PiBwLnRvU3RyaW5nKCkpLFxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmcm9tV2lyZVZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByLnRoZW4uYmluZChyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlUHJveHkoZXAsIFsuLi5wYXRoLCBwcm9wXSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQoX3RhcmdldCwgcHJvcCwgcmF3VmFsdWUpIHtcclxuICAgICAgICAgICAgdGhyb3dJZlByb3h5UmVsZWFzZWQoaXNQcm94eVJlbGVhc2VkKTtcclxuICAgICAgICAgICAgLy8gRklYTUU6IEVTNiBQcm94eSBIYW5kbGVyIGBzZXRgIG1ldGhvZHMgYXJlIHN1cHBvc2VkIHRvIHJldHVybiBhXHJcbiAgICAgICAgICAgIC8vIGJvb2xlYW4uIFRvIHNob3cgZ29vZCB3aWxsLCB3ZSByZXR1cm4gdHJ1ZSBhc3luY2hyb25vdXNseSDCr1xcXyjjg4QpXy/Cr1xyXG4gICAgICAgICAgICBjb25zdCBbdmFsdWUsIHRyYW5zZmVyYWJsZXNdID0gdG9XaXJlVmFsdWUocmF3VmFsdWUpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogXCJTRVRcIiAvKiBTRVQgKi8sXHJcbiAgICAgICAgICAgICAgICBwYXRoOiBbLi4ucGF0aCwgcHJvcF0ubWFwKChwKSA9PiBwLnRvU3RyaW5nKCkpLFxyXG4gICAgICAgICAgICAgICAgdmFsdWUsXHJcbiAgICAgICAgICAgIH0sIHRyYW5zZmVyYWJsZXMpLnRoZW4oZnJvbVdpcmVWYWx1ZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBhcHBseShfdGFyZ2V0LCBfdGhpc0FyZywgcmF3QXJndW1lbnRMaXN0KSB7XHJcbiAgICAgICAgICAgIHRocm93SWZQcm94eVJlbGVhc2VkKGlzUHJveHlSZWxlYXNlZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxhc3QgPSBwYXRoW3BhdGgubGVuZ3RoIC0gMV07XHJcbiAgICAgICAgICAgIGlmIChsYXN0ID09PSBjcmVhdGVFbmRwb2ludCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIkVORFBPSU5UXCIgLyogRU5EUE9JTlQgKi8sXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZyb21XaXJlVmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIFdlIGp1c3QgcHJldGVuZCB0aGF0IGBiaW5kKClgIGRpZG7igJl0IGhhcHBlbi5cclxuICAgICAgICAgICAgaWYgKGxhc3QgPT09IFwiYmluZFwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlUHJveHkoZXAsIHBhdGguc2xpY2UoMCwgLTEpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBbYXJndW1lbnRMaXN0LCB0cmFuc2ZlcmFibGVzXSA9IHByb2Nlc3NBcmd1bWVudHMocmF3QXJndW1lbnRMaXN0KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwiQVBQTFlcIiAvKiBBUFBMWSAqLyxcclxuICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgubWFwKChwKSA9PiBwLnRvU3RyaW5nKCkpLFxyXG4gICAgICAgICAgICAgICAgYXJndW1lbnRMaXN0LFxyXG4gICAgICAgICAgICB9LCB0cmFuc2ZlcmFibGVzKS50aGVuKGZyb21XaXJlVmFsdWUpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29uc3RydWN0KF90YXJnZXQsIHJhd0FyZ3VtZW50TGlzdCkge1xyXG4gICAgICAgICAgICB0aHJvd0lmUHJveHlSZWxlYXNlZChpc1Byb3h5UmVsZWFzZWQpO1xyXG4gICAgICAgICAgICBjb25zdCBbYXJndW1lbnRMaXN0LCB0cmFuc2ZlcmFibGVzXSA9IHByb2Nlc3NBcmd1bWVudHMocmF3QXJndW1lbnRMaXN0KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwiQ09OU1RSVUNUXCIgLyogQ09OU1RSVUNUICovLFxyXG4gICAgICAgICAgICAgICAgcGF0aDogcGF0aC5tYXAoKHApID0+IHAudG9TdHJpbmcoKSksXHJcbiAgICAgICAgICAgICAgICBhcmd1bWVudExpc3QsXHJcbiAgICAgICAgICAgIH0sIHRyYW5zZmVyYWJsZXMpLnRoZW4oZnJvbVdpcmVWYWx1ZSk7XHJcbiAgICAgICAgfSxcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHByb3h5O1xyXG59XHJcbmZ1bmN0aW9uIG15RmxhdChhcnIpIHtcclxuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLCBhcnIpO1xyXG59XHJcbmZ1bmN0aW9uIHByb2Nlc3NBcmd1bWVudHMoYXJndW1lbnRMaXN0KSB7XHJcbiAgICBjb25zdCBwcm9jZXNzZWQgPSBhcmd1bWVudExpc3QubWFwKHRvV2lyZVZhbHVlKTtcclxuICAgIHJldHVybiBbcHJvY2Vzc2VkLm1hcCgodikgPT4gdlswXSksIG15RmxhdChwcm9jZXNzZWQubWFwKCh2KSA9PiB2WzFdKSldO1xyXG59XHJcbmNvbnN0IHRyYW5zZmVyQ2FjaGUgPSBuZXcgV2Vha01hcCgpO1xyXG5mdW5jdGlvbiB0cmFuc2ZlcihvYmosIHRyYW5zZmVycykge1xyXG4gICAgdHJhbnNmZXJDYWNoZS5zZXQob2JqLCB0cmFuc2ZlcnMpO1xyXG4gICAgcmV0dXJuIG9iajtcclxufVxyXG5mdW5jdGlvbiBwcm94eShvYmopIHtcclxuICAgIHJldHVybiBPYmplY3QuYXNzaWduKG9iaiwgeyBbcHJveHlNYXJrZXJdOiB0cnVlIH0pO1xyXG59XHJcbmZ1bmN0aW9uIHdpbmRvd0VuZHBvaW50KHcsIGNvbnRleHQgPSBzZWxmLCB0YXJnZXRPcmlnaW4gPSBcIipcIikge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBwb3N0TWVzc2FnZTogKG1zZywgdHJhbnNmZXJhYmxlcykgPT4gdy5wb3N0TWVzc2FnZShtc2csIHRhcmdldE9yaWdpbiwgdHJhbnNmZXJhYmxlcyksXHJcbiAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogY29udGV4dC5hZGRFdmVudExpc3RlbmVyLmJpbmQoY29udGV4dCksXHJcbiAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjogY29udGV4dC5yZW1vdmVFdmVudExpc3RlbmVyLmJpbmQoY29udGV4dCksXHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIHRvV2lyZVZhbHVlKHZhbHVlKSB7XHJcbiAgICBmb3IgKGNvbnN0IFtuYW1lLCBoYW5kbGVyXSBvZiB0cmFuc2ZlckhhbmRsZXJzKSB7XHJcbiAgICAgICAgaWYgKGhhbmRsZXIuY2FuSGFuZGxlKHZhbHVlKSkge1xyXG4gICAgICAgICAgICBjb25zdCBbc2VyaWFsaXplZFZhbHVlLCB0cmFuc2ZlcmFibGVzXSA9IGhhbmRsZXIuc2VyaWFsaXplKHZhbHVlKTtcclxuICAgICAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIkhBTkRMRVJcIiAvKiBIQU5ETEVSICovLFxyXG4gICAgICAgICAgICAgICAgICAgIG5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHNlcmlhbGl6ZWRWYWx1ZSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB0cmFuc2ZlcmFibGVzLFxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0eXBlOiBcIlJBV1wiIC8qIFJBVyAqLyxcclxuICAgICAgICAgICAgdmFsdWUsXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0cmFuc2ZlckNhY2hlLmdldCh2YWx1ZSkgfHwgW10sXHJcbiAgICBdO1xyXG59XHJcbmZ1bmN0aW9uIGZyb21XaXJlVmFsdWUodmFsdWUpIHtcclxuICAgIHN3aXRjaCAodmFsdWUudHlwZSkge1xyXG4gICAgICAgIGNhc2UgXCJIQU5ETEVSXCIgLyogSEFORExFUiAqLzpcclxuICAgICAgICAgICAgcmV0dXJuIHRyYW5zZmVySGFuZGxlcnMuZ2V0KHZhbHVlLm5hbWUpLmRlc2VyaWFsaXplKHZhbHVlLnZhbHVlKTtcclxuICAgICAgICBjYXNlIFwiUkFXXCIgLyogUkFXICovOlxyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUudmFsdWU7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwgbXNnLCB0cmFuc2ZlcnMpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGlkID0gZ2VuZXJhdGVVVUlEKCk7XHJcbiAgICAgICAgZXAuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgZnVuY3Rpb24gbChldikge1xyXG4gICAgICAgICAgICBpZiAoIWV2LmRhdGEgfHwgIWV2LmRhdGEuaWQgfHwgZXYuZGF0YS5pZCAhPT0gaWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlcC5yZW1vdmVFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBsKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShldi5kYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoZXAuc3RhcnQpIHtcclxuICAgICAgICAgICAgZXAuc3RhcnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZXAucG9zdE1lc3NhZ2UoT2JqZWN0LmFzc2lnbih7IGlkIH0sIG1zZyksIHRyYW5zZmVycyk7XHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBnZW5lcmF0ZVVVSUQoKSB7XHJcbiAgICByZXR1cm4gbmV3IEFycmF5KDQpXHJcbiAgICAgICAgLmZpbGwoMClcclxuICAgICAgICAubWFwKCgpID0+IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKS50b1N0cmluZygxNikpXHJcbiAgICAgICAgLmpvaW4oXCItXCIpO1xyXG59XG5cbmV4cG9ydCB7IGNyZWF0ZUVuZHBvaW50LCBleHBvc2UsIHByb3h5LCBwcm94eU1hcmtlciwgcmVsZWFzZVByb3h5LCB0cmFuc2ZlciwgdHJhbnNmZXJIYW5kbGVycywgd2luZG93RW5kcG9pbnQsIHdyYXAgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbWxpbmsubWpzLm1hcFxuIiwiZXhwb3J0IGNvbnN0IE1BSU5fQVBQX0lEID0gXCJwYXB5cm9zXCI7XG5cbmV4cG9ydCBjb25zdCBPVVRQVVRfVEFfSUQgPSBcImNvZGUtb3V0cHV0LWFyZWFcIjtcbmV4cG9ydCBjb25zdCBJTlBVVF9UQV9JRCA9IFwiY29kZS1pbnB1dC1hcmVhXCI7XG5leHBvcnQgY29uc3QgQ09ERV9UQV9JRCA9IFwiY29kZS1hcmVhXCI7XG5cbmV4cG9ydCBjb25zdCBSVU5fQlROX0lEID0gXCJydW4tY29kZS1idG5cIjtcbmV4cG9ydCBjb25zdCBURVJNSU5BVEVfQlROX0lEID0gXCJ0ZXJtaW5hdGUtYnRuXCI7XG5cbmV4cG9ydCBjb25zdCBMQU5HVUFHRV9TRUxFQ1RfSUQgPSBcImxhbmd1YWdlLXNlbGVjdFwiO1xuXG5leHBvcnQgY29uc3QgREVGQVVMVF9QUk9HUkFNTUlOR19MQU5HVUFHRSA9IFwicHl0aG9uXCI7XG5cbmV4cG9ydCBjb25zdCBJTlBVVF9SRUxBVElWRV9VUkwgPSBcIi9fX3BhcHlyb3NfaW5wdXRcIjtcbiIsImV4cG9ydCBlbnVtIExvZ1R5cGUge1xuICAgIERlYnVnLCBFcnJvciwgSW1wb3J0YW50XG59XG5cbmNvbnN0IEVOVklST05NRU5UOiBzdHJpbmcgPSBwcm9jZXNzLmVudi5OT0RFX0VOViB8fCBcImRldmVsb3BtZW50XCI7XG5leHBvcnQgZnVuY3Rpb24gcGFweXJvc0xvZyhsb2dUeXBlOiBMb2dUeXBlLCAuLi5hcmdzOiBhbnlbXSk6IHZvaWQge1xuICAgIGNvbnN0IGRvTG9nID0gRU5WSVJPTk1FTlQgIT09IFwicHJvZHVjdGlvblwiIHx8IGxvZ1R5cGUgIT09IExvZ1R5cGUuRGVidWc7XG4gICAgaWYgKGRvTG9nKSB7XG4gICAgICAgIGlmIChsb2dUeXBlID09PSBMb2dUeXBlLkVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKC4uLmFyZ3MpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCJpbXBvcnQgeyBJTlBVVF9SRUxBVElWRV9VUkwgfSBmcm9tIFwiLi9Db25zdGFudHNcIjtcbmltcG9ydCB7IFBhcHlyb3NFdmVudCB9IGZyb20gXCIuL1BhcHlyb3NFdmVudFwiO1xuaW1wb3J0IHsgTG9nVHlwZSwgcGFweXJvc0xvZyB9IGZyb20gXCIuL3V0aWwvTG9nZ2luZ1wiO1xuXG5mdW5jdGlvbiBnZXRJbnB1dENhbGxiYWNrKGlucHV0VGV4dEFycmF5PzogVWludDhBcnJheSwgaW5wdXRNZXRhRGF0YT86IEludDMyQXJyYXkpOiAoKSA9PiBzdHJpbmcge1xuICAgIGlmIChpbnB1dFRleHRBcnJheSAmJiBpbnB1dE1ldGFEYXRhKSB7XG4gICAgICAgIGNvbnN0IHRleHREZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc3RhbnQtY29uZGl0aW9uXG4gICAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgICAgIGlmIChBdG9taWNzLndhaXQoaW5wdXRNZXRhRGF0YSwgMCwgMCwgMTAwKSA9PT0gXCJ0aW1lZC1vdXRcIikge1xuICAgICAgICAgICAgICAgICAgICAvLyBwYXB5cm9zTG9nLmxvZyhcIndhaXRpbmcgb24gaW5wdXRcIik7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIChpbnRlcnJ1cHRCdWZmZXJbMF0gPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgQXRvbWljcy5zdG9yZShpbnB1dE1ldGFEYXRhLCAwLCAwKTtcbiAgICAgICAgICAgIGNvbnN0IHNpemUgPSBBdG9taWNzLmV4Y2hhbmdlKGlucHV0TWV0YURhdGEsIDEsIDApO1xuICAgICAgICAgICAgY29uc3QgYnl0ZXMgPSBpbnB1dFRleHRBcnJheS5zbGljZSgwLCBzaXplKTtcbiAgICAgICAgICAgIHJldHVybiB0ZXh0RGVjb2Rlci5kZWNvZGUoYnl0ZXMpO1xuICAgICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgLy8gYGZhbHNlYCBtYWtlcyB0aGUgcmVxdWVzdCBzeW5jaHJvbm91c1xuICAgICAgICAgICAgICAgIHJlcXVlc3Qub3BlbihcIkdFVFwiLCBJTlBVVF9SRUxBVElWRV9VUkwsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnNlbmQobnVsbCk7XG4gICAgICAgICAgICB9IHdoaWxlIChyZXF1ZXN0LnN0YXR1cyA+PSA0MDApOyAvLyB0b2RvIGJldHRlciBlcnJvciBoYW5kbGluZ1xuICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3QucmVzcG9uc2VUZXh0O1xuICAgICAgICB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEJhY2tlbmQge1xuICAgIG9uRXZlbnQ6IChlOiBQYXB5cm9zRXZlbnQpID0+IHZvaWQ7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1lbXB0eS1mdW5jdGlvblxuICAgICAgICB0aGlzLm9uRXZlbnQgPSAoKSA9PiB7IH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZSB0aGUgYmFja2VuZCwgc2V0dGluZyB1cCBhbnkgZ2xvYmFscyByZXF1aXJlZFxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oUGFweXJvc0V2ZW50KTp2b2lkfSBvbkV2ZW50IENhbGxiYWNrIGZvciB3aGVuIGV2ZW50cyBvY2N1clxuICAgICAqIEBwYXJhbSB7VWludDhBcnJheX0gaW5wdXRUZXh0QXJyYXkgT3B0aW9uYWwgc2hhcmVkIGJ1ZmZlciBmb3IgaW5wdXRcbiAgICAgKiBAcGFyYW0ge0ludDMyQXJyYXl9IGlucHV0TWV0YURhdGEgT3B0aW9uYWwgc2hhcmVkIGJ1ZmZlciBmb3IgbWV0YWRhdGEgYWJvdXQgaW5wdXRcbiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPHZvaWQ+fSBQcm9taXNlIG9mIGxhdW5jaGluZ1xuICAgICAqL1xuICAgIGxhdW5jaChvbkV2ZW50OiAoZTogUGFweXJvc0V2ZW50KSA9PiB2b2lkLFxuICAgICAgICBpbnB1dFRleHRBcnJheT86IFVpbnQ4QXJyYXksIGlucHV0TWV0YURhdGE/OiBJbnQzMkFycmF5KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IGlucHV0Q2FsbGJhY2sgPSBnZXRJbnB1dENhbGxiYWNrKGlucHV0VGV4dEFycmF5LCBpbnB1dE1ldGFEYXRhKTtcbiAgICAgICAgdGhpcy5vbkV2ZW50ID0gKGU6IFBhcHlyb3NFdmVudCkgPT4ge1xuICAgICAgICAgICAgb25FdmVudChlKTtcbiAgICAgICAgICAgIGlmIChlLnR5cGUgPT09IFwiaW5wdXRcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiBpbnB1dENhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG5cbiAgICBhYnN0cmFjdCBfcnVuQ29kZUludGVybmFsKGNvZGU6IHN0cmluZyk6IFByb21pc2U8YW55PjtcblxuICAgIC8qKlxuICAgICAqIFZhbGlkYXRlIGFuZCBydW4gYXJiaXRyYXJ5IGNvZGVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gY29kZSBUaGUgY29kZSB0byBydW5cbiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPHZvaWQ+fSBQcm9taXNlIG9mIGV4ZWN1dGlvblxuICAgICAqL1xuICAgIGFzeW5jIHJ1bkNvZGUoY29kZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHBhcHlyb3NMb2coTG9nVHlwZS5EZWJ1ZywgXCJSdW5uaW5nIGNvZGUgaW4gd29ya2VyOiBcIiwgY29kZSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5fcnVuQ29kZUludGVybmFsKGNvZGUpO1xuICAgICAgICAgICAgcGFweXJvc0xvZyhMb2dUeXBlLkltcG9ydGFudCwgXCJyYW4gY29kZTogXCIgKyBjb2RlICsgXCIgYW5kIHJlY2VpdmVkOiBcIiwgZGF0YSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vbkV2ZW50KHsgdHlwZTogXCJzdWNjZXNzXCIsIGRhdGE6IGRhdGEgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yU3RyaW5nID0gXCJ0b1N0cmluZ1wiIGluIGVycm9yID8gZXJyb3IudG9TdHJpbmcoKSA6IEpTT04uc3RyaW5naWZ5KGVycm9yKTtcbiAgICAgICAgICAgIHBhcHlyb3NMb2coTG9nVHlwZS5FcnJvciwgXCJFcnJvciBkdXJpbmcgZXhlY3V0aW9uOiBcIiwgZXJyb3IsIGVycm9yU3RyaW5nKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9uRXZlbnQoeyB0eXBlOiBcImVycm9yXCIsIGRhdGE6IGVycm9yU3RyaW5nIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgZXhwb3NlIH0gZnJvbSBcImNvbWxpbmtcIjtcbmltcG9ydCB7IEJhY2tlbmQgfSBmcm9tIFwiLi4vLi4vQmFja2VuZFwiO1xuXG5cbmNsYXNzIEphdmFTY3JpcHRXb3JrZXIgZXh0ZW5kcyBCYWNrZW5kIHtcbiAgICBvdmVycmlkZSBfcnVuQ29kZUludGVybmFsKGNvZGU6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGNvbnN0IHRvUmVzdG9yZSA9IG5ldyBNYXAoW1xuICAgICAgICAgICAgW1wicHJvbXB0XCIsIFwiX19wcm9tcHRcIl0sXG4gICAgICAgICAgICBbXCJjb25zb2xlLmxvZ1wiLCBcIl9fcGFweXJvc19sb2dcIl0sXG4gICAgICAgICAgICBbXCJjb25zb2xlLmVycm9yXCIsIFwiX19wYXB5cm9zX2Vycm9yXCJdXG4gICAgICAgIF0pO1xuICAgICAgICBjb25zdCBvdmVycmlkZUJ1aWx0aW5zID0gYFxuZnVuY3Rpb24gcHJvbXB0KHRleHQ9XCJcIiwgZGVmYXVsdFRleHQ9XCJcIil7XG4gICAgX19vbkV2ZW50KHtcInR5cGVcIjogXCJvdXRwdXRcIiwgXCJkYXRhXCI6IHRleHR9KTtcbiAgICBjb25zdCBwcm9tcHRlZFZhbHVlID0gX19vbkV2ZW50KHtcInR5cGVcIjogXCJpbnB1dFwiLCBcImRhdGFcIjogdGV4dH0pO1xuICAgIF9fb25FdmVudCh7XCJ0eXBlXCI6IFwib3V0cHV0XCIsIFwiZGF0YVwiOiBwcm9tcHRlZFZhbHVlICsgXCJcXFxcblwifSk7XG4gICAgcmV0dXJuIHByb21wdGVkVmFsdWU7XG59XG5mdW5jdGlvbiBfX3N0cmluZ2lmeShhcmdzLCBhZGROZXdsaW5lPWZhbHNlKXtcbiAgICBsZXQgYXNTdHJpbmcgPSBcIlwiO1xuICAgIGlmKEFycmF5LmlzQXJyYXkoYXJncykpe1xuICAgICAgICBpZihhcmdzLmxlbmd0aCA9PT0gMSl7XG4gICAgICAgICAgICBhc1N0cmluZyA9IEpTT04uc3RyaW5naWZ5KGFyZ3NbMF0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXNTdHJpbmcgPSBhcmdzLm1hcChzID0+IHtcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgcyA9PT0gJ3N0cmluZycgfHwgcyBpbnN0YW5jZW9mIFN0cmluZyl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzOyAvLyBwcmV2ZW50IHNwdXJpb3VzIHF1b3Rlc1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5qb2luKFwiIFwiKTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGFzU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoYXJncyk7XG4gICAgfVxuICAgIGlmKGFkZE5ld2xpbmUpe1xuICAgICAgICBhc1N0cmluZyArPSBcIlxcXFxuXCI7XG4gICAgfVxuICAgIHJldHVybiBhc1N0cmluZztcbn1cbmNvbnNvbGUubG9nID0gKC4uLmFyZ3MpID0+IHtcbiAgICBfX29uRXZlbnQoe1widHlwZVwiOiBcIm91dHB1dFwiLCBcImRhdGFcIjogX19zdHJpbmdpZnkoYXJncywgdHJ1ZSl9KTtcbn1cbmNvbnNvbGUuZXJyb3IgPSAoLi4uYXJncykgPT4ge1xuICAgIF9fb25FdmVudCh7XCJ0eXBlXCI6IFwiZXJyb3JcIiwgXCJkYXRhXCI6IF9fc3RyaW5naWZ5KGFyZ3MsIHRydWUpfSk7XG59XG4gICAgICAgIGA7XG4gICAgICAgIGNvbnN0IG5ld0NvbnRleHQgPSB7XG4gICAgICAgICAgICBcIl9fb25FdmVudFwiOiB0aGlzLm9uRXZlbnQuYmluZCh0aGlzKVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXN0b3JlQnVpbHRpbnMgPSBbXTtcbiAgICAgICAgY29uc3QgbmV3Qm9keSA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IGsgaW4gbmV3Q29udGV4dCkge1xuICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuZXdDb250ZXh0LCBrKSkge1xuICAgICAgICAgICAgICAgIG5ld0JvZHkucHVzaChgY29uc3QgJHtrfSA9IGN0eFsnJHtrfSddO2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgW2ZuLCBiYWNrdXBdIG9mIHRvUmVzdG9yZS5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIG5ld0JvZHkucHVzaChgJHtiYWNrdXB9ID0gJHtmbn1gKTtcbiAgICAgICAgICAgIHJlc3RvcmVCdWlsdGlucy5wdXNoKGAke2ZufSA9ICR7YmFja3VwfWApO1xuICAgICAgICB9XG4gICAgICAgIG5ld0JvZHkucHVzaChvdmVycmlkZUJ1aWx0aW5zKTtcbiAgICAgICAgbmV3Qm9keS5wdXNoKGBcbnRyeSB7XG4ke2NvZGV9XG59IGZpbmFsbHkge1xuJHtyZXN0b3JlQnVpbHRpbnMuam9pbihcIlxcblwiKX1cbn1cbiAgICAgICAgYCk7XG4gICAgICAgIGNvbnN0IGZuQm9keSA9IG5ld0JvZHkuam9pbihcIlxcblwiKTtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLW5ldy1mdW5jXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IEZ1bmN0aW9uKFwiY3R4XCIsIGZuQm9keSkobmV3Q29udGV4dCkpO1xuICAgIH1cbn1cblxuZXhwb3NlKG5ldyBKYXZhU2NyaXB0V29ya2VyKCkpO1xuIl0sIm5hbWVzIjpbInByb3h5TWFya2VyIiwiU3ltYm9sIiwiY3JlYXRlRW5kcG9pbnQiLCJyZWxlYXNlUHJveHkiLCJ0aHJvd01hcmtlciIsImlzT2JqZWN0IiwidmFsIiwidHJhbnNmZXJIYW5kbGVycyIsIk1hcCIsImNhbkhhbmRsZSIsInNlcmlhbGl6ZSIsIm9iaiIsInBvcnQxIiwicG9ydDIiLCJNZXNzYWdlQ2hhbm5lbCIsImV4cG9zZSIsImRlc2VyaWFsaXplIiwicG9ydCIsInN0YXJ0IiwiY3JlYXRlUHJveHkiLCJ0YXJnZXQiLCJ2YWx1ZSIsInNlcmlhbGl6ZWQiLCJFcnJvciIsImlzRXJyb3IiLCJtZXNzYWdlIiwibmFtZSIsInN0YWNrIiwiT2JqZWN0IiwiYXNzaWduIiwiZXAiLCJzZWxmIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNhbGxiYWNrIiwiZXYiLCJkYXRhIiwiaWQiLCJ0eXBlIiwicGF0aCIsImFyZ3VtZW50TGlzdCIsIm1hcCIsImZyb21XaXJlVmFsdWUiLCJyZXR1cm5WYWx1ZSIsInBhcmVudCIsInNsaWNlIiwicmVkdWNlIiwicHJvcCIsInJhd1ZhbHVlIiwiYXBwbHkiLCJwcm94eSIsInRyYW5zZmVycyIsInRyYW5zZmVyQ2FjaGUiLCJzZXQiLCJ0cmFuc2ZlciIsInVuZGVmaW5lZCIsIlByb21pc2UiLCJyZXNvbHZlIiwiY2F0Y2giLCJ0aGVuIiwid2lyZVZhbHVlIiwidHJhbnNmZXJhYmxlcyIsInRvV2lyZVZhbHVlIiwicG9zdE1lc3NhZ2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiY2xvc2VFbmRQb2ludCIsImVuZHBvaW50IiwiY29uc3RydWN0b3IiLCJpc01lc3NhZ2VQb3J0IiwiY2xvc2UiLCJ0aHJvd0lmUHJveHlSZWxlYXNlZCIsImlzUmVsZWFzZWQiLCJpc1Byb3h5UmVsZWFzZWQiLCJQcm94eSIsImdldCIsIl90YXJnZXQiLCJyZXF1ZXN0UmVzcG9uc2VNZXNzYWdlIiwicCIsInRvU3RyaW5nIiwibGVuZ3RoIiwiciIsImJpbmQiLCJfdGhpc0FyZyIsInJhd0FyZ3VtZW50TGlzdCIsImxhc3QiLCJwcm9jZXNzQXJndW1lbnRzIiwiY29uc3RydWN0IiwicHJvY2Vzc2VkIiwidiIsImFyciIsIkFycmF5IiwicHJvdG90eXBlIiwiY29uY2F0IiwiV2Vha01hcCIsImhhbmRsZXIiLCJzZXJpYWxpemVkVmFsdWUiLCJtc2ciLCJmaWxsIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiTnVtYmVyIiwiTUFYX1NBRkVfSU5URUdFUiIsImpvaW4iLCJsIiwiTG9nVHlwZSIsInBhcHlyb3NMb2ciLCJsb2dUeXBlIiwiZG9Mb2ciLCJEZWJ1ZyIsImNvbnNvbGUiLCJlcnJvciIsImFyZ3MiLCJsb2ciLCJ0aGlzIiwib25FdmVudCIsImxhdW5jaCIsImlucHV0VGV4dEFycmF5IiwiaW5wdXRNZXRhRGF0YSIsImlucHV0Q2FsbGJhY2siLCJUZXh0RGVjb2RlciIsIkF0b21pY3MiLCJ3YWl0Iiwic3RvcmUiLCJzaXplIiwiZXhjaGFuZ2UiLCJieXRlcyIsImRlY29kZSIsInJlcXVlc3QiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJzZW5kIiwic3RhdHVzIiwicmVzcG9uc2VUZXh0IiwiZ2V0SW5wdXRDYWxsYmFjayIsImUiLCJydW5Db2RlIiwiY29kZSIsIl9ydW5Db2RlSW50ZXJuYWwiLCJJbXBvcnRhbnQiLCJlcnJvclN0cmluZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0b1Jlc3RvcmUiLCJuZXdDb250ZXh0IiwicmVzdG9yZUJ1aWx0aW5zIiwibmV3Qm9keSIsImsiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJwdXNoIiwiZW50cmllcyIsImZuIiwiYmFja3VwIiwiZm5Cb2R5IiwiRnVuY3Rpb24iLCJCYWNrZW5kIl0sInNvdXJjZVJvb3QiOiIifQ==