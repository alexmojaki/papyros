(()=>{"use strict";const t=Symbol("Comlink.proxy"),e=Symbol("Comlink.endpoint"),n=Symbol("Comlink.releaseProxy"),r=Symbol("Comlink.thrown"),o=t=>"object"==typeof t&&null!==t||"function"==typeof t,i=new Map([["proxy",{canHandle:e=>o(e)&&e[t],serialize(t){const{port1:e,port2:n}=new MessageChannel;return a(t,e),[n,[n]]},deserialize:t=>(t.start(),c(t,[],undefined))}],["throw",{canHandle:t=>o(t)&&r in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function a(e,n=self){n.addEventListener("message",(function o(i){if(!i||!i.data)return;const{id:u,type:c,path:l}=Object.assign({path:[]},i.data),h=(i.data.argumentList||[]).map(d);let y;try{const n=l.slice(0,-1).reduce(((t,e)=>t[e]),e),r=l.reduce(((t,e)=>t[e]),e);switch(c){case"GET":y=r;break;case"SET":n[l.slice(-1)[0]]=d(i.data.value),y=!0;break;case"APPLY":y=r.apply(n,h);break;case"CONSTRUCT":y=function(e){return Object.assign(e,{[t]:!0})}(new r(...h));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;a(e,n),y=function(t,e){return p.set(t,e),t}(t,[t])}break;case"RELEASE":y=void 0;break;default:return}}catch(t){y={value:t,[r]:0}}Promise.resolve(y).catch((t=>({value:t,[r]:0}))).then((t=>{const[e,r]=f(t);n.postMessage(Object.assign(Object.assign({},e),{id:u}),r),"RELEASE"===c&&(n.removeEventListener("message",o),s(n))}))})),n.start&&n.start()}function s(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function u(t){if(t)throw new Error("Proxy has been released and is not useable")}function c(t,r=[],o=function(){}){let i=!1;const a=new Proxy(o,{get(e,o){if(u(i),o===n)return()=>h(t,{type:"RELEASE",path:r.map((t=>t.toString()))}).then((()=>{s(t),i=!0}));if("then"===o){if(0===r.length)return{then:()=>a};const e=h(t,{type:"GET",path:r.map((t=>t.toString()))}).then(d);return e.then.bind(e)}return c(t,[...r,o])},set(e,n,o){u(i);const[a,s]=f(o);return h(t,{type:"SET",path:[...r,n].map((t=>t.toString())),value:a},s).then(d)},apply(n,o,a){u(i);const s=r[r.length-1];if(s===e)return h(t,{type:"ENDPOINT"}).then(d);if("bind"===s)return c(t,r.slice(0,-1));const[p,f]=l(a);return h(t,{type:"APPLY",path:r.map((t=>t.toString())),argumentList:p},f).then(d)},construct(e,n){u(i);const[o,a]=l(n);return h(t,{type:"CONSTRUCT",path:r.map((t=>t.toString())),argumentList:o},a).then(d)}});return a}function l(t){const e=t.map(f);return[e.map((t=>t[0])),(n=e.map((t=>t[1])),Array.prototype.concat.apply([],n))];var n}const p=new WeakMap;function f(t){for(const[e,n]of i)if(n.canHandle(t)){const[r,o]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},o]}return[{type:"RAW",value:t},p.get(t)||[]]}function d(t){switch(t.type){case"HANDLER":return i.get(t.name).deserialize(t.value);case"RAW":return t.value}}function h(t,e,n){return new Promise((r=>{const o=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(n){n.data&&n.data.id&&n.data.id===o&&(t.removeEventListener("message",e),r(n.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:o},e),n)}))}var y,v=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},b=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))};function _(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=t!==y.Debug;r&&(t===y.Error?console.error.apply(console,b([],v(e),!1)):console.log.apply(console,b([],v(e),!1)))}!function(t){t[t.Debug=0]="Debug",t[t.Error=1]="Error",t[t.Important=2]="Important"}(y||(y={}));var m,g=function(){function t(){this.onEvent=function(){}}return t.prototype.launch=function(t,e,n){var r=function(t,e){if(t&&e){var n=new TextDecoder;return function(){for(;"timed-out"===Atomics.wait(e,0,0,100););Atomics.store(e,0,0);var r=Atomics.exchange(e,1,0),o=t.slice(0,r);return n.decode(o)}}return function(){var t=new XMLHttpRequest;do{t.open("GET","/__papyros_input",!1),t.send(null)}while(t.status>=400);return t.responseText}}(e,n);return this.onEvent=function(e){if(t(e),"input"===e.type)return r()},Promise.resolve()},t.prototype.runCode=function(t){return e=this,n=void 0,o=function(){var e,n,r;return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(o){switch(o.label){case 0:_(y.Debug,"Running code in worker: ",t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._runCodeInternal(t)];case 2:return e=o.sent(),_(y.Important,"ran code: "+t+" and received: ",e),[2,this.onEvent({type:"success",data:e})];case 3:return n=o.sent(),r="toString"in n?n.toString():JSON.stringify(n),_(y.Error,"Error during execution: ",n,r),[2,this.onEvent({type:"error",data:r})];case 4:return[2]}}))},new((r=void 0)||(r=Promise))((function(t,i){function a(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(t){t(n)}))).then(a,s)}u((o=o.apply(e,n||[])).next())}));var e,n,r,o},t}(),w=(m=function(t,e){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},m(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}m(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),E=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},S=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};importScripts("https://cdn.jsdelivr.net/pyodide/v0.18.1/full/pyodide.js"),a(new(function(t){function e(){var e=t.call(this)||this;return e.pyodide={},e.initialized=!1,e}return w(e,t),e.prototype.launch=function(e,n,r){return E(this,void 0,void 0,(function(){var o,i,a=this;return S(this,(function(s){switch(s.label){case 0:return[4,t.prototype.launch.call(this,e,n,r)];case 1:return s.sent(),[4,loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.18.1/full/",fullStdLib:!0})];case 2:return o=s.sent(),this.pyodide=o,[4,this.runCode('\nfrom pyodide import to_js\nimport sys\n\ndef __override_builtins(cb):\n    __capture_stdout(cb)\n    __override_stdin(cb)\n\ndef __capture_stdout(cb):\n    class _OutputWriter:\n\n        def write(self, s):\n            cb(to_js({"type": "output", "data":s}))\n\n        def flush(self):\n            pass # Given data is always immediately written\n\n    global print\n    __original_print = print\n    __writer = _OutputWriter()\n\n    def __dodona_print(*objects, sep=\' \', end=\'\\n\', file=sys.stdout, flush=False):\n        if file == sys.stdout:\n            __original_print(*objects, sep=sep, end=end, file=__writer, flush=flush)\n        else:\n            __original_print(*objects, sep=sep, end=end, file=file, flush=flush)\n\n    print = __dodona_print\n\ndef __override_stdin(cb):\n    global input\n    def __dodona_input(prompt=""):\n        print(prompt, end="")\n        user_value = cb(to_js({"type": "input", "data":prompt}))\n        print(user_value)\n        return user_value\n\n    input = __dodona_input\n\ndef __run_code(code):\n    return exec(code, dict(globals()))\n')];case 3:return s.sent(),i=function(t){return a.onEvent(Object.fromEntries(t))},this.pyodide.globals.get("__override_builtins")(i),this.initialized=!0,[2]}}))}))},e.prototype._runCodeInternal=function(t){return E(this,void 0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this.pyodide.loadPackagesFromImports(t)];case 1:return e.sent(),this.initialized?[2,this.pyodide.globals.get("__run_code")(t)]:[2,this.pyodide.runPythonAsync(t)]}}))}))},e}(g)))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVdELEVBQVFqRixNQUFPLDJCQUE0QixFQUFPb0gsR0FDdEQsQ0FBUCxFQUFPMUIsS0FBS0MsUUFBUSxDQUFFN0UsS0FBTSxRQUFTRixLQUFNd0csSyxzVEFHdkQsRUE5Q0EsRyxneERDcEJBRyxjQUFjLDREQXVDZC9ILEVBQU8sSUFwQ1AsWUFJSSxtQkFDSSxjQUFPLEssT0FDUCxFQUFLZ0ksUUFBVSxHQUNmLEVBQUtDLGFBQWMsRSxFQTJCM0IsT0FsQzJCLE9BVVIsWUFBQTdCLE9BQWYsU0FBc0JELEVBQ2xCRSxFQUE2QkMsRyx5R0FDN0IsU0FBTSxZQUFNRixPQUFNLFVBQUNELEVBQVNFLEVBQWdCQyxJLE9BQzVCLE9BRGhCLFNBQ2dCLEdBQU00QixZQUFZLENBQzlCQyxTQUFVLGlEQUNWQyxZQUFZLEssT0FHaEIsT0FMTUosRUFBVSxTQUloQjlCLEtBQUs4QixRQUFVQSxFQUNmLEdBQU05QixLQUFLc0IsUUNyQ2YsaWxDLGNEcUNJLFNBRU1hLEVBQWdCLFNBQUNqSCxHQUNuQixTQUFLK0UsUUFBUXRGLE9BQU95SCxZQUFZbEgsS0FDcEM4RSxLQUFLOEIsUUFBUU8sUUFBUTdFLElBQUksc0JBQXpCd0MsQ0FBZ0RtQyxHQUNoRG5DLEtBQUsrQixhQUFjLEUsWUFHUixZQUFBUCxpQkFBZixTQUFnQ0QsRywwRkFDNUIsU0FBTXZCLEtBQUs4QixRQUFRUSx3QkFBd0JmLEksT0FDM0MsT0FEQSxTQUNJdkIsS0FBSytCLFlBQ0UsQ0FBUCxFQUFPL0IsS0FBSzhCLFFBQVFPLFFBQVE3RSxJQUFJLGFBQXpCd0MsQ0FBdUN1QixJQUV2QyxDQUFQLEVBQU92QixLQUFLOEIsUUFBUVMsZUFBZWhCLFlBRy9DLEVBbENBLENBQTJCaUIsTSIsInNvdXJjZXMiOlsid2VicGFjazovL3BhcHlyb3MvLi9ub2RlX21vZHVsZXMvY29tbGluay9kaXN0L2VzbS9jb21saW5rLm1qcyIsIndlYnBhY2s6Ly9wYXB5cm9zLy4vc3JjL0NvbnN0YW50cy50cyIsIndlYnBhY2s6Ly9wYXB5cm9zLy4vc3JjL3V0aWwvTG9nZ2luZy50cyIsIndlYnBhY2s6Ly9wYXB5cm9zLy4vc3JjL0JhY2tlbmQudHMiLCJ3ZWJwYWNrOi8vcGFweXJvcy8uL3NyYy93b3JrZXJzL3B5dGhvbi9QeXRob25Xb3JrZXIud29ya2VyLnRzIiwid2VicGFjazovL3BhcHlyb3MvLi9zcmMvd29ya2Vycy9weXRob24vaW5pdC5weS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBwcm94eU1hcmtlciA9IFN5bWJvbChcIkNvbWxpbmsucHJveHlcIik7XHJcbmNvbnN0IGNyZWF0ZUVuZHBvaW50ID0gU3ltYm9sKFwiQ29tbGluay5lbmRwb2ludFwiKTtcclxuY29uc3QgcmVsZWFzZVByb3h5ID0gU3ltYm9sKFwiQ29tbGluay5yZWxlYXNlUHJveHlcIik7XHJcbmNvbnN0IHRocm93TWFya2VyID0gU3ltYm9sKFwiQ29tbGluay50aHJvd25cIik7XHJcbmNvbnN0IGlzT2JqZWN0ID0gKHZhbCkgPT4gKHR5cGVvZiB2YWwgPT09IFwib2JqZWN0XCIgJiYgdmFsICE9PSBudWxsKSB8fCB0eXBlb2YgdmFsID09PSBcImZ1bmN0aW9uXCI7XHJcbi8qKlxyXG4gKiBJbnRlcm5hbCB0cmFuc2ZlciBoYW5kbGUgdG8gaGFuZGxlIG9iamVjdHMgbWFya2VkIHRvIHByb3h5LlxyXG4gKi9cclxuY29uc3QgcHJveHlUcmFuc2ZlckhhbmRsZXIgPSB7XHJcbiAgICBjYW5IYW5kbGU6ICh2YWwpID0+IGlzT2JqZWN0KHZhbCkgJiYgdmFsW3Byb3h5TWFya2VyXSxcclxuICAgIHNlcmlhbGl6ZShvYmopIHtcclxuICAgICAgICBjb25zdCB7IHBvcnQxLCBwb3J0MiB9ID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7XHJcbiAgICAgICAgZXhwb3NlKG9iaiwgcG9ydDEpO1xyXG4gICAgICAgIHJldHVybiBbcG9ydDIsIFtwb3J0Ml1dO1xyXG4gICAgfSxcclxuICAgIGRlc2VyaWFsaXplKHBvcnQpIHtcclxuICAgICAgICBwb3J0LnN0YXJ0KCk7XHJcbiAgICAgICAgcmV0dXJuIHdyYXAocG9ydCk7XHJcbiAgICB9LFxyXG59O1xyXG4vKipcclxuICogSW50ZXJuYWwgdHJhbnNmZXIgaGFuZGxlciB0byBoYW5kbGUgdGhyb3duIGV4Y2VwdGlvbnMuXHJcbiAqL1xyXG5jb25zdCB0aHJvd1RyYW5zZmVySGFuZGxlciA9IHtcclxuICAgIGNhbkhhbmRsZTogKHZhbHVlKSA9PiBpc09iamVjdCh2YWx1ZSkgJiYgdGhyb3dNYXJrZXIgaW4gdmFsdWUsXHJcbiAgICBzZXJpYWxpemUoeyB2YWx1ZSB9KSB7XHJcbiAgICAgICAgbGV0IHNlcmlhbGl6ZWQ7XHJcbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgc2VyaWFsaXplZCA9IHtcclxuICAgICAgICAgICAgICAgIGlzRXJyb3I6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHZhbHVlLm1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdmFsdWUubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBzdGFjazogdmFsdWUuc3RhY2ssXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgc2VyaWFsaXplZCA9IHsgaXNFcnJvcjogZmFsc2UsIHZhbHVlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBbc2VyaWFsaXplZCwgW11dO1xyXG4gICAgfSxcclxuICAgIGRlc2VyaWFsaXplKHNlcmlhbGl6ZWQpIHtcclxuICAgICAgICBpZiAoc2VyaWFsaXplZC5pc0Vycm9yKSB7XHJcbiAgICAgICAgICAgIHRocm93IE9iamVjdC5hc3NpZ24obmV3IEVycm9yKHNlcmlhbGl6ZWQudmFsdWUubWVzc2FnZSksIHNlcmlhbGl6ZWQudmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBzZXJpYWxpemVkLnZhbHVlO1xyXG4gICAgfSxcclxufTtcclxuLyoqXHJcbiAqIEFsbG93cyBjdXN0b21pemluZyB0aGUgc2VyaWFsaXphdGlvbiBvZiBjZXJ0YWluIHZhbHVlcy5cclxuICovXHJcbmNvbnN0IHRyYW5zZmVySGFuZGxlcnMgPSBuZXcgTWFwKFtcclxuICAgIFtcInByb3h5XCIsIHByb3h5VHJhbnNmZXJIYW5kbGVyXSxcclxuICAgIFtcInRocm93XCIsIHRocm93VHJhbnNmZXJIYW5kbGVyXSxcclxuXSk7XHJcbmZ1bmN0aW9uIGV4cG9zZShvYmosIGVwID0gc2VsZikge1xyXG4gICAgZXAuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgZnVuY3Rpb24gY2FsbGJhY2soZXYpIHtcclxuICAgICAgICBpZiAoIWV2IHx8ICFldi5kYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgeyBpZCwgdHlwZSwgcGF0aCB9ID0gT2JqZWN0LmFzc2lnbih7IHBhdGg6IFtdIH0sIGV2LmRhdGEpO1xyXG4gICAgICAgIGNvbnN0IGFyZ3VtZW50TGlzdCA9IChldi5kYXRhLmFyZ3VtZW50TGlzdCB8fCBbXSkubWFwKGZyb21XaXJlVmFsdWUpO1xyXG4gICAgICAgIGxldCByZXR1cm5WYWx1ZTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBwYXRoLnNsaWNlKDAsIC0xKS5yZWR1Y2UoKG9iaiwgcHJvcCkgPT4gb2JqW3Byb3BdLCBvYmopO1xyXG4gICAgICAgICAgICBjb25zdCByYXdWYWx1ZSA9IHBhdGgucmVkdWNlKChvYmosIHByb3ApID0+IG9ialtwcm9wXSwgb2JqKTtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiR0VUXCIgLyogR0VUICovOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSByYXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiU0VUXCIgLyogU0VUICovOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50W3BhdGguc2xpY2UoLTEpWzBdXSA9IGZyb21XaXJlVmFsdWUoZXYuZGF0YS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiQVBQTFlcIiAvKiBBUFBMWSAqLzpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gcmF3VmFsdWUuYXBwbHkocGFyZW50LCBhcmd1bWVudExpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJDT05TVFJVQ1RcIiAvKiBDT05TVFJVQ1QgKi86XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IG5ldyByYXdWYWx1ZSguLi5hcmd1bWVudExpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHByb3h5KHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiRU5EUE9JTlRcIiAvKiBFTkRQT0lOVCAqLzpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgcG9ydDEsIHBvcnQyIH0gPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwb3NlKG9iaiwgcG9ydDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHRyYW5zZmVyKHBvcnQxLCBbcG9ydDFdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiUkVMRUFTRVwiIC8qIFJFTEVBU0UgKi86XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAodmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSB7IHZhbHVlLCBbdGhyb3dNYXJrZXJdOiAwIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFByb21pc2UucmVzb2x2ZShyZXR1cm5WYWx1ZSlcclxuICAgICAgICAgICAgLmNhdGNoKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4geyB2YWx1ZSwgW3Rocm93TWFya2VyXTogMCB9O1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKChyZXR1cm5WYWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBbd2lyZVZhbHVlLCB0cmFuc2ZlcmFibGVzXSA9IHRvV2lyZVZhbHVlKHJldHVyblZhbHVlKTtcclxuICAgICAgICAgICAgZXAucG9zdE1lc3NhZ2UoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB3aXJlVmFsdWUpLCB7IGlkIH0pLCB0cmFuc2ZlcmFibGVzKTtcclxuICAgICAgICAgICAgaWYgKHR5cGUgPT09IFwiUkVMRUFTRVwiIC8qIFJFTEVBU0UgKi8pIHtcclxuICAgICAgICAgICAgICAgIC8vIGRldGFjaCBhbmQgZGVhY3RpdmUgYWZ0ZXIgc2VuZGluZyByZWxlYXNlIHJlc3BvbnNlIGFib3ZlLlxyXG4gICAgICAgICAgICAgICAgZXAucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgY2xvc2VFbmRQb2ludChlcCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgaWYgKGVwLnN0YXJ0KSB7XHJcbiAgICAgICAgZXAuc3RhcnQoKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBpc01lc3NhZ2VQb3J0KGVuZHBvaW50KSB7XHJcbiAgICByZXR1cm4gZW5kcG9pbnQuY29uc3RydWN0b3IubmFtZSA9PT0gXCJNZXNzYWdlUG9ydFwiO1xyXG59XHJcbmZ1bmN0aW9uIGNsb3NlRW5kUG9pbnQoZW5kcG9pbnQpIHtcclxuICAgIGlmIChpc01lc3NhZ2VQb3J0KGVuZHBvaW50KSlcclxuICAgICAgICBlbmRwb2ludC5jbG9zZSgpO1xyXG59XHJcbmZ1bmN0aW9uIHdyYXAoZXAsIHRhcmdldCkge1xyXG4gICAgcmV0dXJuIGNyZWF0ZVByb3h5KGVwLCBbXSwgdGFyZ2V0KTtcclxufVxyXG5mdW5jdGlvbiB0aHJvd0lmUHJveHlSZWxlYXNlZChpc1JlbGVhc2VkKSB7XHJcbiAgICBpZiAoaXNSZWxlYXNlZCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlByb3h5IGhhcyBiZWVuIHJlbGVhc2VkIGFuZCBpcyBub3QgdXNlYWJsZVwiKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBjcmVhdGVQcm94eShlcCwgcGF0aCA9IFtdLCB0YXJnZXQgPSBmdW5jdGlvbiAoKSB7IH0pIHtcclxuICAgIGxldCBpc1Byb3h5UmVsZWFzZWQgPSBmYWxzZTtcclxuICAgIGNvbnN0IHByb3h5ID0gbmV3IFByb3h5KHRhcmdldCwge1xyXG4gICAgICAgIGdldChfdGFyZ2V0LCBwcm9wKSB7XHJcbiAgICAgICAgICAgIHRocm93SWZQcm94eVJlbGVhc2VkKGlzUHJveHlSZWxlYXNlZCk7XHJcbiAgICAgICAgICAgIGlmIChwcm9wID09PSByZWxlYXNlUHJveHkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJSRUxFQVNFXCIgLyogUkVMRUFTRSAqLyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogcGF0aC5tYXAoKHApID0+IHAudG9TdHJpbmcoKSksXHJcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlRW5kUG9pbnQoZXApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1Byb3h5UmVsZWFzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gXCJ0aGVuXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwYXRoLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHRoZW46ICgpID0+IHByb3h5IH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCByID0gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiR0VUXCIgLyogR0VUICovLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgubWFwKChwKSA9PiBwLnRvU3RyaW5nKCkpLFxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmcm9tV2lyZVZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByLnRoZW4uYmluZChyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlUHJveHkoZXAsIFsuLi5wYXRoLCBwcm9wXSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQoX3RhcmdldCwgcHJvcCwgcmF3VmFsdWUpIHtcclxuICAgICAgICAgICAgdGhyb3dJZlByb3h5UmVsZWFzZWQoaXNQcm94eVJlbGVhc2VkKTtcclxuICAgICAgICAgICAgLy8gRklYTUU6IEVTNiBQcm94eSBIYW5kbGVyIGBzZXRgIG1ldGhvZHMgYXJlIHN1cHBvc2VkIHRvIHJldHVybiBhXHJcbiAgICAgICAgICAgIC8vIGJvb2xlYW4uIFRvIHNob3cgZ29vZCB3aWxsLCB3ZSByZXR1cm4gdHJ1ZSBhc3luY2hyb25vdXNseSDCr1xcXyjjg4QpXy/Cr1xyXG4gICAgICAgICAgICBjb25zdCBbdmFsdWUsIHRyYW5zZmVyYWJsZXNdID0gdG9XaXJlVmFsdWUocmF3VmFsdWUpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogXCJTRVRcIiAvKiBTRVQgKi8sXHJcbiAgICAgICAgICAgICAgICBwYXRoOiBbLi4ucGF0aCwgcHJvcF0ubWFwKChwKSA9PiBwLnRvU3RyaW5nKCkpLFxyXG4gICAgICAgICAgICAgICAgdmFsdWUsXHJcbiAgICAgICAgICAgIH0sIHRyYW5zZmVyYWJsZXMpLnRoZW4oZnJvbVdpcmVWYWx1ZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBhcHBseShfdGFyZ2V0LCBfdGhpc0FyZywgcmF3QXJndW1lbnRMaXN0KSB7XHJcbiAgICAgICAgICAgIHRocm93SWZQcm94eVJlbGVhc2VkKGlzUHJveHlSZWxlYXNlZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxhc3QgPSBwYXRoW3BhdGgubGVuZ3RoIC0gMV07XHJcbiAgICAgICAgICAgIGlmIChsYXN0ID09PSBjcmVhdGVFbmRwb2ludCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIkVORFBPSU5UXCIgLyogRU5EUE9JTlQgKi8sXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZyb21XaXJlVmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIFdlIGp1c3QgcHJldGVuZCB0aGF0IGBiaW5kKClgIGRpZG7igJl0IGhhcHBlbi5cclxuICAgICAgICAgICAgaWYgKGxhc3QgPT09IFwiYmluZFwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlUHJveHkoZXAsIHBhdGguc2xpY2UoMCwgLTEpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBbYXJndW1lbnRMaXN0LCB0cmFuc2ZlcmFibGVzXSA9IHByb2Nlc3NBcmd1bWVudHMocmF3QXJndW1lbnRMaXN0KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwiQVBQTFlcIiAvKiBBUFBMWSAqLyxcclxuICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgubWFwKChwKSA9PiBwLnRvU3RyaW5nKCkpLFxyXG4gICAgICAgICAgICAgICAgYXJndW1lbnRMaXN0LFxyXG4gICAgICAgICAgICB9LCB0cmFuc2ZlcmFibGVzKS50aGVuKGZyb21XaXJlVmFsdWUpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29uc3RydWN0KF90YXJnZXQsIHJhd0FyZ3VtZW50TGlzdCkge1xyXG4gICAgICAgICAgICB0aHJvd0lmUHJveHlSZWxlYXNlZChpc1Byb3h5UmVsZWFzZWQpO1xyXG4gICAgICAgICAgICBjb25zdCBbYXJndW1lbnRMaXN0LCB0cmFuc2ZlcmFibGVzXSA9IHByb2Nlc3NBcmd1bWVudHMocmF3QXJndW1lbnRMaXN0KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RSZXNwb25zZU1lc3NhZ2UoZXAsIHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwiQ09OU1RSVUNUXCIgLyogQ09OU1RSVUNUICovLFxyXG4gICAgICAgICAgICAgICAgcGF0aDogcGF0aC5tYXAoKHApID0+IHAudG9TdHJpbmcoKSksXHJcbiAgICAgICAgICAgICAgICBhcmd1bWVudExpc3QsXHJcbiAgICAgICAgICAgIH0sIHRyYW5zZmVyYWJsZXMpLnRoZW4oZnJvbVdpcmVWYWx1ZSk7XHJcbiAgICAgICAgfSxcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHByb3h5O1xyXG59XHJcbmZ1bmN0aW9uIG15RmxhdChhcnIpIHtcclxuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLCBhcnIpO1xyXG59XHJcbmZ1bmN0aW9uIHByb2Nlc3NBcmd1bWVudHMoYXJndW1lbnRMaXN0KSB7XHJcbiAgICBjb25zdCBwcm9jZXNzZWQgPSBhcmd1bWVudExpc3QubWFwKHRvV2lyZVZhbHVlKTtcclxuICAgIHJldHVybiBbcHJvY2Vzc2VkLm1hcCgodikgPT4gdlswXSksIG15RmxhdChwcm9jZXNzZWQubWFwKCh2KSA9PiB2WzFdKSldO1xyXG59XHJcbmNvbnN0IHRyYW5zZmVyQ2FjaGUgPSBuZXcgV2Vha01hcCgpO1xyXG5mdW5jdGlvbiB0cmFuc2ZlcihvYmosIHRyYW5zZmVycykge1xyXG4gICAgdHJhbnNmZXJDYWNoZS5zZXQob2JqLCB0cmFuc2ZlcnMpO1xyXG4gICAgcmV0dXJuIG9iajtcclxufVxyXG5mdW5jdGlvbiBwcm94eShvYmopIHtcclxuICAgIHJldHVybiBPYmplY3QuYXNzaWduKG9iaiwgeyBbcHJveHlNYXJrZXJdOiB0cnVlIH0pO1xyXG59XHJcbmZ1bmN0aW9uIHdpbmRvd0VuZHBvaW50KHcsIGNvbnRleHQgPSBzZWxmLCB0YXJnZXRPcmlnaW4gPSBcIipcIikge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBwb3N0TWVzc2FnZTogKG1zZywgdHJhbnNmZXJhYmxlcykgPT4gdy5wb3N0TWVzc2FnZShtc2csIHRhcmdldE9yaWdpbiwgdHJhbnNmZXJhYmxlcyksXHJcbiAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogY29udGV4dC5hZGRFdmVudExpc3RlbmVyLmJpbmQoY29udGV4dCksXHJcbiAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjogY29udGV4dC5yZW1vdmVFdmVudExpc3RlbmVyLmJpbmQoY29udGV4dCksXHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIHRvV2lyZVZhbHVlKHZhbHVlKSB7XHJcbiAgICBmb3IgKGNvbnN0IFtuYW1lLCBoYW5kbGVyXSBvZiB0cmFuc2ZlckhhbmRsZXJzKSB7XHJcbiAgICAgICAgaWYgKGhhbmRsZXIuY2FuSGFuZGxlKHZhbHVlKSkge1xyXG4gICAgICAgICAgICBjb25zdCBbc2VyaWFsaXplZFZhbHVlLCB0cmFuc2ZlcmFibGVzXSA9IGhhbmRsZXIuc2VyaWFsaXplKHZhbHVlKTtcclxuICAgICAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIkhBTkRMRVJcIiAvKiBIQU5ETEVSICovLFxyXG4gICAgICAgICAgICAgICAgICAgIG5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHNlcmlhbGl6ZWRWYWx1ZSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB0cmFuc2ZlcmFibGVzLFxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0eXBlOiBcIlJBV1wiIC8qIFJBVyAqLyxcclxuICAgICAgICAgICAgdmFsdWUsXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0cmFuc2ZlckNhY2hlLmdldCh2YWx1ZSkgfHwgW10sXHJcbiAgICBdO1xyXG59XHJcbmZ1bmN0aW9uIGZyb21XaXJlVmFsdWUodmFsdWUpIHtcclxuICAgIHN3aXRjaCAodmFsdWUudHlwZSkge1xyXG4gICAgICAgIGNhc2UgXCJIQU5ETEVSXCIgLyogSEFORExFUiAqLzpcclxuICAgICAgICAgICAgcmV0dXJuIHRyYW5zZmVySGFuZGxlcnMuZ2V0KHZhbHVlLm5hbWUpLmRlc2VyaWFsaXplKHZhbHVlLnZhbHVlKTtcclxuICAgICAgICBjYXNlIFwiUkFXXCIgLyogUkFXICovOlxyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUudmFsdWU7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwgbXNnLCB0cmFuc2ZlcnMpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGlkID0gZ2VuZXJhdGVVVUlEKCk7XHJcbiAgICAgICAgZXAuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgZnVuY3Rpb24gbChldikge1xyXG4gICAgICAgICAgICBpZiAoIWV2LmRhdGEgfHwgIWV2LmRhdGEuaWQgfHwgZXYuZGF0YS5pZCAhPT0gaWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlcC5yZW1vdmVFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBsKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShldi5kYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoZXAuc3RhcnQpIHtcclxuICAgICAgICAgICAgZXAuc3RhcnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZXAucG9zdE1lc3NhZ2UoT2JqZWN0LmFzc2lnbih7IGlkIH0sIG1zZyksIHRyYW5zZmVycyk7XHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBnZW5lcmF0ZVVVSUQoKSB7XHJcbiAgICByZXR1cm4gbmV3IEFycmF5KDQpXHJcbiAgICAgICAgLmZpbGwoMClcclxuICAgICAgICAubWFwKCgpID0+IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKS50b1N0cmluZygxNikpXHJcbiAgICAgICAgLmpvaW4oXCItXCIpO1xyXG59XG5cbmV4cG9ydCB7IGNyZWF0ZUVuZHBvaW50LCBleHBvc2UsIHByb3h5LCBwcm94eU1hcmtlciwgcmVsZWFzZVByb3h5LCB0cmFuc2ZlciwgdHJhbnNmZXJIYW5kbGVycywgd2luZG93RW5kcG9pbnQsIHdyYXAgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbWxpbmsubWpzLm1hcFxuIiwiZXhwb3J0IGNvbnN0IE1BSU5fQVBQX0lEID0gXCJwYXB5cm9zXCI7XG5cbmV4cG9ydCBjb25zdCBPVVRQVVRfVEFfSUQgPSBcImNvZGUtb3V0cHV0LWFyZWFcIjtcbmV4cG9ydCBjb25zdCBJTlBVVF9UQV9JRCA9IFwiY29kZS1pbnB1dC1hcmVhXCI7XG5leHBvcnQgY29uc3QgQ09ERV9UQV9JRCA9IFwiY29kZS1hcmVhXCI7XG5cbmV4cG9ydCBjb25zdCBTVEFURV9TUElOTkVSX0lEID0gXCJzdGF0ZS1zcGlubmVyXCI7XG5leHBvcnQgY29uc3QgQVBQTElDQVRJT05fU1RBVEVfUF9JRCA9IFwiYXBwbGljYXRpb24tc3RhdGUtcFwiO1xuXG5leHBvcnQgY29uc3QgUlVOX0JUTl9JRCA9IFwicnVuLWNvZGUtYnRuXCI7XG5leHBvcnQgY29uc3QgVEVSTUlOQVRFX0JUTl9JRCA9IFwidGVybWluYXRlLWJ0blwiO1xuXG5leHBvcnQgY29uc3QgTEFOR1VBR0VfU0VMRUNUX0lEID0gXCJsYW5ndWFnZS1zZWxlY3RcIjtcblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfUFJPR1JBTU1JTkdfTEFOR1VBR0UgPSBcInB5dGhvblwiO1xuXG5leHBvcnQgY29uc3QgSU5QVVRfUkVMQVRJVkVfVVJMID0gXCIvX19wYXB5cm9zX2lucHV0XCI7XG4iLCJleHBvcnQgZW51bSBMb2dUeXBlIHtcbiAgICBEZWJ1ZywgRXJyb3IsIEltcG9ydGFudFxufVxuXG5jb25zdCBFTlZJUk9OTUVOVDogc3RyaW5nID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgfHwgXCJkZXZlbG9wbWVudFwiO1xuZXhwb3J0IGZ1bmN0aW9uIHBhcHlyb3NMb2cobG9nVHlwZTogTG9nVHlwZSwgLi4uYXJnczogYW55W10pOiB2b2lkIHtcbiAgICBjb25zdCBkb0xvZyA9IEVOVklST05NRU5UICE9PSBcInByb2R1Y3Rpb25cIiB8fCBsb2dUeXBlICE9PSBMb2dUeXBlLkRlYnVnO1xuICAgIGlmIChkb0xvZykge1xuICAgICAgICBpZiAobG9nVHlwZSA9PT0gTG9nVHlwZS5FcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvciguLi5hcmdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKC4uLmFyZ3MpO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgSU5QVVRfUkVMQVRJVkVfVVJMIH0gZnJvbSBcIi4vQ29uc3RhbnRzXCI7XG5pbXBvcnQgeyBQYXB5cm9zRXZlbnQgfSBmcm9tIFwiLi9QYXB5cm9zRXZlbnRcIjtcbmltcG9ydCB7IExvZ1R5cGUsIHBhcHlyb3NMb2cgfSBmcm9tIFwiLi91dGlsL0xvZ2dpbmdcIjtcblxuZnVuY3Rpb24gZ2V0SW5wdXRDYWxsYmFjayhpbnB1dFRleHRBcnJheT86IFVpbnQ4QXJyYXksIGlucHV0TWV0YURhdGE/OiBJbnQzMkFycmF5KTogKCkgPT4gc3RyaW5nIHtcbiAgICBpZiAoaW5wdXRUZXh0QXJyYXkgJiYgaW5wdXRNZXRhRGF0YSkge1xuICAgICAgICBjb25zdCB0ZXh0RGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnN0YW50LWNvbmRpdGlvblxuICAgICAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoQXRvbWljcy53YWl0KGlucHV0TWV0YURhdGEsIDAsIDAsIDEwMCkgPT09IFwidGltZWQtb3V0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gcGFweXJvc0xvZy5sb2coXCJ3YWl0aW5nIG9uIGlucHV0XCIpO1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiAoaW50ZXJydXB0QnVmZmVyWzBdID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIEF0b21pY3Muc3RvcmUoaW5wdXRNZXRhRGF0YSwgMCwgMCk7XG4gICAgICAgICAgICBjb25zdCBzaXplID0gQXRvbWljcy5leGNoYW5nZShpbnB1dE1ldGFEYXRhLCAxLCAwKTtcbiAgICAgICAgICAgIGNvbnN0IGJ5dGVzID0gaW5wdXRUZXh0QXJyYXkuc2xpY2UoMCwgc2l6ZSk7XG4gICAgICAgICAgICByZXR1cm4gdGV4dERlY29kZXIuZGVjb2RlKGJ5dGVzKTtcbiAgICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgIC8vIGBmYWxzZWAgbWFrZXMgdGhlIHJlcXVlc3Qgc3luY2hyb25vdXNcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9wZW4oXCJHRVRcIiwgSU5QVVRfUkVMQVRJVkVfVVJMLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgcmVxdWVzdC5zZW5kKG51bGwpO1xuICAgICAgICAgICAgfSB3aGlsZSAocmVxdWVzdC5zdGF0dXMgPj0gNDAwKTsgLy8gdG9kbyBiZXR0ZXIgZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0LnJlc3BvbnNlVGV4dDtcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBCYWNrZW5kIHtcbiAgICBvbkV2ZW50OiAoZTogUGFweXJvc0V2ZW50KSA9PiB2b2lkO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZW1wdHktZnVuY3Rpb25cbiAgICAgICAgdGhpcy5vbkV2ZW50ID0gKCkgPT4geyB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgdGhlIGJhY2tlbmQsIHNldHRpbmcgdXAgYW55IGdsb2JhbHMgcmVxdWlyZWRcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKFBhcHlyb3NFdmVudCk6dm9pZH0gb25FdmVudCBDYWxsYmFjayBmb3Igd2hlbiBldmVudHMgb2NjdXJcbiAgICAgKiBAcGFyYW0ge1VpbnQ4QXJyYXl9IGlucHV0VGV4dEFycmF5IE9wdGlvbmFsIHNoYXJlZCBidWZmZXIgZm9yIGlucHV0XG4gICAgICogQHBhcmFtIHtJbnQzMkFycmF5fSBpbnB1dE1ldGFEYXRhIE9wdGlvbmFsIHNoYXJlZCBidWZmZXIgZm9yIG1ldGFkYXRhIGFib3V0IGlucHV0XG4gICAgICogQHJldHVybiB7UHJvbWlzZTx2b2lkPn0gUHJvbWlzZSBvZiBsYXVuY2hpbmdcbiAgICAgKi9cbiAgICBsYXVuY2gob25FdmVudDogKGU6IFBhcHlyb3NFdmVudCkgPT4gdm9pZCxcbiAgICAgICAgaW5wdXRUZXh0QXJyYXk/OiBVaW50OEFycmF5LCBpbnB1dE1ldGFEYXRhPzogSW50MzJBcnJheSk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBpbnB1dENhbGxiYWNrID0gZ2V0SW5wdXRDYWxsYmFjayhpbnB1dFRleHRBcnJheSwgaW5wdXRNZXRhRGF0YSk7XG4gICAgICAgIHRoaXMub25FdmVudCA9IChlOiBQYXB5cm9zRXZlbnQpID0+IHtcbiAgICAgICAgICAgIG9uRXZlbnQoZSk7XG4gICAgICAgICAgICBpZiAoZS50eXBlID09PSBcImlucHV0XCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5wdXRDYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuXG4gICAgYWJzdHJhY3QgX3J1bkNvZGVJbnRlcm5hbChjb2RlOiBzdHJpbmcpOiBQcm9taXNlPGFueT47XG5cbiAgICAvKipcbiAgICAgKiBWYWxpZGF0ZSBhbmQgcnVuIGFyYml0cmFyeSBjb2RlXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGNvZGUgVGhlIGNvZGUgdG8gcnVuXG4gICAgICogQHJldHVybiB7UHJvbWlzZTx2b2lkPn0gUHJvbWlzZSBvZiBleGVjdXRpb25cbiAgICAgKi9cbiAgICBhc3luYyBydW5Db2RlKGNvZGU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBwYXB5cm9zTG9nKExvZ1R5cGUuRGVidWcsIFwiUnVubmluZyBjb2RlIGluIHdvcmtlcjogXCIsIGNvZGUpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHRoaXMuX3J1bkNvZGVJbnRlcm5hbChjb2RlKTtcbiAgICAgICAgICAgIHBhcHlyb3NMb2coTG9nVHlwZS5JbXBvcnRhbnQsIFwicmFuIGNvZGU6IFwiICsgY29kZSArIFwiIGFuZCByZWNlaXZlZDogXCIsIGRhdGEpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub25FdmVudCh7IHR5cGU6IFwic3VjY2Vzc1wiLCBkYXRhOiBkYXRhIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvclN0cmluZyA9IFwidG9TdHJpbmdcIiBpbiBlcnJvciA/IGVycm9yLnRvU3RyaW5nKCkgOiBKU09OLnN0cmluZ2lmeShlcnJvcik7XG4gICAgICAgICAgICBwYXB5cm9zTG9nKExvZ1R5cGUuRXJyb3IsIFwiRXJyb3IgZHVyaW5nIGV4ZWN1dGlvbjogXCIsIGVycm9yLCBlcnJvclN0cmluZyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vbkV2ZW50KHsgdHlwZTogXCJlcnJvclwiLCBkYXRhOiBlcnJvclN0cmluZyB9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsImltcG9ydCB7IGV4cG9zZSB9IGZyb20gXCJjb21saW5rXCI7XG5pbXBvcnQgeyBCYWNrZW5kIH0gZnJvbSBcIi4uLy4uL0JhY2tlbmRcIjtcbmltcG9ydCB7IFBhcHlyb3NFdmVudCB9IGZyb20gXCIuLi8uLi9QYXB5cm9zRXZlbnRcIjtcbmltcG9ydCB7IElOSVRJQUxJWkFUSU9OX0NPREUgfSBmcm9tIFwiLi9pbml0LnB5XCI7XG5cbmludGVyZmFjZSBMb2FkUHlvZGlkZUFyZ3Mge1xuICAgIGluZGV4VVJMOiBzdHJpbmc7XG4gICAgZnVsbFN0ZExpYjogYm9vbGVhbjtcbn1cbmludGVyZmFjZSBQeW9kaWRlIHtcbiAgICBydW5QeXRob25Bc3luYzogKGNvZGU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPjtcbiAgICBsb2FkUGFja2FnZXNGcm9tSW1wb3J0czogKGNvZGU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPjtcbiAgICBnbG9iYWxzOiBNYXA8c3RyaW5nLCBhbnk+O1xufVxuZGVjbGFyZSBmdW5jdGlvbiBpbXBvcnRTY3JpcHRzKC4uLnVybHM6IHN0cmluZ1tdKTogdm9pZDtcbmRlY2xhcmUgZnVuY3Rpb24gbG9hZFB5b2RpZGUoYXJnczogTG9hZFB5b2RpZGVBcmdzKTogUHJvbWlzZTxQeW9kaWRlPjtcblxuaW1wb3J0U2NyaXB0cyhcImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9weW9kaWRlL3YwLjE4LjEvZnVsbC9weW9kaWRlLmpzXCIpO1xuXG5cbmNsYXNzIFB5dGhvbldvcmtlciBleHRlbmRzIEJhY2tlbmQge1xuICAgIHB5b2RpZGU6IFB5b2RpZGU7XG4gICAgaW5pdGlhbGl6ZWQ6IGJvb2xlYW47XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5weW9kaWRlID0ge30gYXMgUHlvZGlkZTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIG92ZXJyaWRlIGFzeW5jIGxhdW5jaChvbkV2ZW50OiAoZTogUGFweXJvc0V2ZW50KSA9PiB2b2lkLFxuICAgICAgICBpbnB1dFRleHRBcnJheT86IFVpbnQ4QXJyYXksIGlucHV0TWV0YURhdGE/OiBJbnQzMkFycmF5KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IHN1cGVyLmxhdW5jaChvbkV2ZW50LCBpbnB1dFRleHRBcnJheSwgaW5wdXRNZXRhRGF0YSk7XG4gICAgICAgIGNvbnN0IHB5b2RpZGUgPSBhd2FpdCBsb2FkUHlvZGlkZSh7XG4gICAgICAgICAgICBpbmRleFVSTDogXCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvcHlvZGlkZS92MC4xOC4xL2Z1bGwvXCIsXG4gICAgICAgICAgICBmdWxsU3RkTGliOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnB5b2RpZGUgPSBweW9kaWRlO1xuICAgICAgICBhd2FpdCB0aGlzLnJ1bkNvZGUoSU5JVElBTElaQVRJT05fQ09ERSk7XG4gICAgICAgIC8vIFB5dGhvbiBjYWxscyBvdXIgZnVuY3Rpb24gd2l0aCBhIGRpY3QsIHdoaWNoIG11c3QgYmUgY29udmVydGVkIHRvIGEgUGFweXJvc0V2ZW50XG4gICAgICAgIGNvbnN0IGV2ZW50Q2FsbGJhY2sgPSAoZGF0YTogTWFwPHN0cmluZywgYW55Pik6IHZvaWQgPT5cbiAgICAgICAgICAgIHRoaXMub25FdmVudChPYmplY3QuZnJvbUVudHJpZXMoZGF0YSkgYXMgUGFweXJvc0V2ZW50KTtcbiAgICAgICAgdGhpcy5weW9kaWRlLmdsb2JhbHMuZ2V0KFwiX19vdmVycmlkZV9idWlsdGluc1wiKShldmVudENhbGxiYWNrKTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG4gICAgfVxuXG4gICAgb3ZlcnJpZGUgYXN5bmMgX3J1bkNvZGVJbnRlcm5hbChjb2RlOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICBhd2FpdCB0aGlzLnB5b2RpZGUubG9hZFBhY2thZ2VzRnJvbUltcG9ydHMoY29kZSk7XG4gICAgICAgIGlmICh0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5weW9kaWRlLmdsb2JhbHMuZ2V0KFwiX19ydW5fY29kZVwiKShjb2RlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnB5b2RpZGUucnVuUHl0aG9uQXN5bmMoY29kZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9zZShuZXcgUHl0aG9uV29ya2VyKCkpO1xuIiwiZXhwb3J0IGNvbnN0IElOSVRJQUxJWkFUSU9OX0NPREUgPVxuICAgIGBcbmZyb20gcHlvZGlkZSBpbXBvcnQgdG9fanNcbmltcG9ydCBzeXNcblxuZGVmIF9fb3ZlcnJpZGVfYnVpbHRpbnMoY2IpOlxuICAgIF9fY2FwdHVyZV9zdGRvdXQoY2IpXG4gICAgX19vdmVycmlkZV9zdGRpbihjYilcblxuZGVmIF9fY2FwdHVyZV9zdGRvdXQoY2IpOlxuICAgIGNsYXNzIF9PdXRwdXRXcml0ZXI6XG5cbiAgICAgICAgZGVmIHdyaXRlKHNlbGYsIHMpOlxuICAgICAgICAgICAgY2IodG9fanMoe1widHlwZVwiOiBcIm91dHB1dFwiLCBcImRhdGFcIjpzfSkpXG5cbiAgICAgICAgZGVmIGZsdXNoKHNlbGYpOlxuICAgICAgICAgICAgcGFzcyAjIEdpdmVuIGRhdGEgaXMgYWx3YXlzIGltbWVkaWF0ZWx5IHdyaXR0ZW5cblxuICAgIGdsb2JhbCBwcmludFxuICAgIF9fb3JpZ2luYWxfcHJpbnQgPSBwcmludFxuICAgIF9fd3JpdGVyID0gX091dHB1dFdyaXRlcigpXG5cbiAgICBkZWYgX19kb2RvbmFfcHJpbnQoKm9iamVjdHMsIHNlcD0nICcsIGVuZD0nXFxcXG4nLCBmaWxlPXN5cy5zdGRvdXQsIGZsdXNoPUZhbHNlKTpcbiAgICAgICAgaWYgZmlsZSA9PSBzeXMuc3Rkb3V0OlxuICAgICAgICAgICAgX19vcmlnaW5hbF9wcmludCgqb2JqZWN0cywgc2VwPXNlcCwgZW5kPWVuZCwgZmlsZT1fX3dyaXRlciwgZmx1c2g9Zmx1c2gpXG4gICAgICAgIGVsc2U6XG4gICAgICAgICAgICBfX29yaWdpbmFsX3ByaW50KCpvYmplY3RzLCBzZXA9c2VwLCBlbmQ9ZW5kLCBmaWxlPWZpbGUsIGZsdXNoPWZsdXNoKVxuXG4gICAgcHJpbnQgPSBfX2RvZG9uYV9wcmludFxuXG5kZWYgX19vdmVycmlkZV9zdGRpbihjYik6XG4gICAgZ2xvYmFsIGlucHV0XG4gICAgZGVmIF9fZG9kb25hX2lucHV0KHByb21wdD1cIlwiKTpcbiAgICAgICAgcHJpbnQocHJvbXB0LCBlbmQ9XCJcIilcbiAgICAgICAgdXNlcl92YWx1ZSA9IGNiKHRvX2pzKHtcInR5cGVcIjogXCJpbnB1dFwiLCBcImRhdGFcIjpwcm9tcHR9KSlcbiAgICAgICAgcHJpbnQodXNlcl92YWx1ZSlcbiAgICAgICAgcmV0dXJuIHVzZXJfdmFsdWVcblxuICAgIGlucHV0ID0gX19kb2RvbmFfaW5wdXRcblxuZGVmIF9fcnVuX2NvZGUoY29kZSk6XG4gICAgcmV0dXJuIGV4ZWMoY29kZSwgZGljdChnbG9iYWxzKCkpKVxuYDtcbiJdLCJuYW1lcyI6WyJwcm94eU1hcmtlciIsIlN5bWJvbCIsImNyZWF0ZUVuZHBvaW50IiwicmVsZWFzZVByb3h5IiwidGhyb3dNYXJrZXIiLCJpc09iamVjdCIsInZhbCIsInRyYW5zZmVySGFuZGxlcnMiLCJNYXAiLCJjYW5IYW5kbGUiLCJzZXJpYWxpemUiLCJvYmoiLCJwb3J0MSIsInBvcnQyIiwiTWVzc2FnZUNoYW5uZWwiLCJleHBvc2UiLCJkZXNlcmlhbGl6ZSIsInBvcnQiLCJzdGFydCIsImNyZWF0ZVByb3h5IiwidGFyZ2V0IiwidmFsdWUiLCJzZXJpYWxpemVkIiwiRXJyb3IiLCJpc0Vycm9yIiwibWVzc2FnZSIsIm5hbWUiLCJzdGFjayIsIk9iamVjdCIsImFzc2lnbiIsImVwIiwic2VsZiIsImFkZEV2ZW50TGlzdGVuZXIiLCJjYWxsYmFjayIsImV2IiwiZGF0YSIsImlkIiwidHlwZSIsInBhdGgiLCJhcmd1bWVudExpc3QiLCJtYXAiLCJmcm9tV2lyZVZhbHVlIiwicmV0dXJuVmFsdWUiLCJwYXJlbnQiLCJzbGljZSIsInJlZHVjZSIsInByb3AiLCJyYXdWYWx1ZSIsImFwcGx5IiwicHJveHkiLCJ0cmFuc2ZlcnMiLCJ0cmFuc2ZlckNhY2hlIiwic2V0IiwidHJhbnNmZXIiLCJ1bmRlZmluZWQiLCJQcm9taXNlIiwicmVzb2x2ZSIsImNhdGNoIiwidGhlbiIsIndpcmVWYWx1ZSIsInRyYW5zZmVyYWJsZXMiLCJ0b1dpcmVWYWx1ZSIsInBvc3RNZXNzYWdlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImNsb3NlRW5kUG9pbnQiLCJlbmRwb2ludCIsImNvbnN0cnVjdG9yIiwiaXNNZXNzYWdlUG9ydCIsImNsb3NlIiwidGhyb3dJZlByb3h5UmVsZWFzZWQiLCJpc1JlbGVhc2VkIiwiaXNQcm94eVJlbGVhc2VkIiwiUHJveHkiLCJnZXQiLCJfdGFyZ2V0IiwicmVxdWVzdFJlc3BvbnNlTWVzc2FnZSIsInAiLCJ0b1N0cmluZyIsImxlbmd0aCIsInIiLCJiaW5kIiwiX3RoaXNBcmciLCJyYXdBcmd1bWVudExpc3QiLCJsYXN0IiwicHJvY2Vzc0FyZ3VtZW50cyIsImNvbnN0cnVjdCIsInByb2Nlc3NlZCIsInYiLCJhcnIiLCJBcnJheSIsInByb3RvdHlwZSIsImNvbmNhdCIsIldlYWtNYXAiLCJoYW5kbGVyIiwic2VyaWFsaXplZFZhbHVlIiwibXNnIiwiZmlsbCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIk51bWJlciIsIk1BWF9TQUZFX0lOVEVHRVIiLCJqb2luIiwibCIsIkxvZ1R5cGUiLCJwYXB5cm9zTG9nIiwibG9nVHlwZSIsImRvTG9nIiwiRGVidWciLCJjb25zb2xlIiwiZXJyb3IiLCJhcmdzIiwibG9nIiwidGhpcyIsIm9uRXZlbnQiLCJsYXVuY2giLCJpbnB1dFRleHRBcnJheSIsImlucHV0TWV0YURhdGEiLCJpbnB1dENhbGxiYWNrIiwiVGV4dERlY29kZXIiLCJBdG9taWNzIiwid2FpdCIsInN0b3JlIiwic2l6ZSIsImV4Y2hhbmdlIiwiYnl0ZXMiLCJkZWNvZGUiLCJyZXF1ZXN0IiwiWE1MSHR0cFJlcXVlc3QiLCJvcGVuIiwic2VuZCIsInN0YXR1cyIsInJlc3BvbnNlVGV4dCIsImdldElucHV0Q2FsbGJhY2siLCJlIiwicnVuQ29kZSIsImNvZGUiLCJfcnVuQ29kZUludGVybmFsIiwiSW1wb3J0YW50IiwiZXJyb3JTdHJpbmciLCJKU09OIiwic3RyaW5naWZ5IiwiaW1wb3J0U2NyaXB0cyIsInB5b2RpZGUiLCJpbml0aWFsaXplZCIsImxvYWRQeW9kaWRlIiwiaW5kZXhVUkwiLCJmdWxsU3RkTGliIiwiZXZlbnRDYWxsYmFjayIsImZyb21FbnRyaWVzIiwiZ2xvYmFscyIsImxvYWRQYWNrYWdlc0Zyb21JbXBvcnRzIiwicnVuUHl0aG9uQXN5bmMiLCJCYWNrZW5kIl0sInNvdXJjZVJvb3QiOiIifQ==