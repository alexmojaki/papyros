(()=>{"use strict";const t=Symbol("Comlink.proxy"),e=Symbol("Comlink.endpoint"),n=Symbol("Comlink.releaseProxy"),r=Symbol("Comlink.thrown"),o=t=>"object"==typeof t&&null!==t||"function"==typeof t,i=new Map([["proxy",{canHandle:e=>o(e)&&e[t],serialize(t){const{port1:e,port2:n}=new MessageChannel;return a(t,e),[n,[n]]},deserialize:t=>(t.start(),c(t,[],undefined))}],["throw",{canHandle:t=>o(t)&&r in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function a(e,n=self){n.addEventListener("message",(function o(i){if(!i||!i.data)return;const{id:u,type:c,path:l}=Object.assign({path:[]},i.data),h=(i.data.argumentList||[]).map(d);let y;try{const n=l.slice(0,-1).reduce(((t,e)=>t[e]),e),r=l.reduce(((t,e)=>t[e]),e);switch(c){case"GET":y=r;break;case"SET":n[l.slice(-1)[0]]=d(i.data.value),y=!0;break;case"APPLY":y=r.apply(n,h);break;case"CONSTRUCT":y=function(e){return Object.assign(e,{[t]:!0})}(new r(...h));break;case"ENDPOINT":{const{port1:t,port2:n}=new MessageChannel;a(e,n),y=function(t,e){return p.set(t,e),t}(t,[t])}break;case"RELEASE":y=void 0;break;default:return}}catch(t){y={value:t,[r]:0}}Promise.resolve(y).catch((t=>({value:t,[r]:0}))).then((t=>{const[e,r]=f(t);n.postMessage(Object.assign(Object.assign({},e),{id:u}),r),"RELEASE"===c&&(n.removeEventListener("message",o),s(n))}))})),n.start&&n.start()}function s(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function u(t){if(t)throw new Error("Proxy has been released and is not useable")}function c(t,r=[],o=function(){}){let i=!1;const a=new Proxy(o,{get(e,o){if(u(i),o===n)return()=>h(t,{type:"RELEASE",path:r.map((t=>t.toString()))}).then((()=>{s(t),i=!0}));if("then"===o){if(0===r.length)return{then:()=>a};const e=h(t,{type:"GET",path:r.map((t=>t.toString()))}).then(d);return e.then.bind(e)}return c(t,[...r,o])},set(e,n,o){u(i);const[a,s]=f(o);return h(t,{type:"SET",path:[...r,n].map((t=>t.toString())),value:a},s).then(d)},apply(n,o,a){u(i);const s=r[r.length-1];if(s===e)return h(t,{type:"ENDPOINT"}).then(d);if("bind"===s)return c(t,r.slice(0,-1));const[p,f]=l(a);return h(t,{type:"APPLY",path:r.map((t=>t.toString())),argumentList:p},f).then(d)},construct(e,n){u(i);const[o,a]=l(n);return h(t,{type:"CONSTRUCT",path:r.map((t=>t.toString())),argumentList:o},a).then(d)}});return a}function l(t){const e=t.map(f);return[e.map((t=>t[0])),(n=e.map((t=>t[1])),Array.prototype.concat.apply([],n))];var n}const p=new WeakMap;function f(t){for(const[e,n]of i)if(n.canHandle(t)){const[r,o]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},o]}return[{type:"RAW",value:t},p.get(t)||[]]}function d(t){switch(t.type){case"HANDLER":return i.get(t.name).deserialize(t.value);case"RAW":return t.value}}function h(t,e,n){return new Promise((r=>{const o=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(n){n.data&&n.data.id&&n.data.id===o&&(t.removeEventListener("message",e),r(n.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:o},e),n)}))}var y,v=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},b=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))};function _(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=t!==y.Debug;r&&(t===y.Error?console.error.apply(console,b([],v(e),!1)):console.log.apply(console,b([],v(e),!1)))}!function(t){t[t.Debug=0]="Debug",t[t.Error=1]="Error",t[t.Important=2]="Important"}(y||(y={}));var m,g=function(){function t(){this.onEvent=function(){}}return t.prototype.launch=function(t,e,n){var r=function(t,e){if(t&&e){var n=new TextDecoder;return function(){for(;"timed-out"===Atomics.wait(e,0,0,100););Atomics.store(e,0,0);var r=Atomics.exchange(e,1,0),o=t.slice(0,r);return n.decode(o)}}return function(){var t=new XMLHttpRequest;do{t.open("GET","/__papyros_input",!1),t.send(null)}while(t.status>=400);return t.responseText}}(e,n);return this.onEvent=function(e){if(t(e),"input"===e.type)return r()},Promise.resolve()},t.prototype.runCode=function(t){return e=this,n=void 0,o=function(){var e,n,r;return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(o){switch(o.label){case 0:_(y.Debug,"Running code in worker: ",t),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._runCodeInternal(t)];case 2:return e=o.sent(),_(y.Important,"ran code: "+t+" and received: ",e),[2,this.onEvent({type:"success",data:e})];case 3:return n=o.sent(),r="toString"in n?n.toString():JSON.stringify(n),_(y.Error,"Error during execution: ",n,r),[2,this.onEvent({type:"error",data:r})];case 4:return[2]}}))},new((r=void 0)||(r=Promise))((function(t,i){function a(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(t){t(n)}))).then(a,s)}u((o=o.apply(e,n||[])).next())}));var e,n,r,o},t}(),w=(m=function(t,e){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},m(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}m(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),E=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},S=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};importScripts("https://cdn.jsdelivr.net/pyodide/v0.18.1/full/pyodide.js"),a(new(function(t){function e(){var e=t.call(this)||this;return e.pyodide={},e.initialized=!1,e}return w(e,t),e.prototype.launch=function(e,n,r){return E(this,void 0,void 0,(function(){var o,i,a=this;return S(this,(function(s){switch(s.label){case 0:return[4,t.prototype.launch.call(this,e,n,r)];case 1:return s.sent(),[4,loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.18.1/full/",fullStdLib:!0})];case 2:return o=s.sent(),this.pyodide=o,[4,this.runCode('\nfrom pyodide import to_js\nimport sys\n\ndef __override_builtins(cb):\n    __capture_stdout(cb)\n    __override_stdin(cb)\n\ndef __capture_stdout(cb):\n    class _OutputWriter:\n\n        def write(self, s):\n            cb(to_js({"type": "output", "data":s}))\n\n        def flush(self):\n            pass # Given data is always immediately written\n\n    global print\n    __original_print = print\n    __writer = _OutputWriter()\n\n    def __dodona_print(*objects, sep=\' \', end=\'\\n\', file=sys.stdout, flush=False):\n        if file == sys.stdout:\n            __original_print(*objects, sep=sep, end=end, file=__writer, flush=flush)\n        else:\n            __original_print(*objects, sep=sep, end=end, file=file, flush=flush)\n\n    print = __dodona_print\n\ndef __override_stdin(cb):\n    global input\n    def __dodona_input(prompt=""):\n        print(prompt, end="")\n        user_value = cb(to_js({"type": "input", "data":prompt}))\n        print(user_value)\n        return user_value\n\n    input = __dodona_input\n\ndef __run_code(code):\n    return exec(code, dict(globals()))\n')];case 3:return s.sent(),i=function(t){return a.onEvent(Object.fromEntries(t))},this.pyodide.globals.get("__override_builtins")(i),this.initialized=!0,[2]}}))}))},e.prototype._runCodeInternal=function(t){return E(this,void 0,void 0,(function(){return S(this,(function(e){switch(e.label){case 0:return[4,this.pyodide.loadPackagesFromImports(t)];case 1:return e.sent(),this.initialized?[2,this.pyodide.globals.get("__run_code")(t)]:[2,this.pyodide.runPythonAsync(t)]}}))}))},e}(g)))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBV0QsRUFBUWpGLE1BQU8sMkJBQTRCLEVBQU9vSCxHQUN0RCxDQUFQLEVBQU8xQixLQUFLQyxRQUFRLENBQUU3RSxLQUFNLFFBQVNGLEtBQU13RyxLLHNUQUd2RCxFQTlDQSxHLGd4RENwQkFHLGNBQWMsNERBdUNkL0gsRUFBTyxJQXBDUCxZQUlJLG1CQUNJLGNBQU8sSyxPQUNQLEVBQUtnSSxRQUFVLEdBQ2YsRUFBS0MsYUFBYyxFLEVBMkIzQixPQWxDMkIsT0FVUixZQUFBN0IsT0FBZixTQUFzQkQsRUFDbEJFLEVBQTZCQyxHLHlHQUM3QixTQUFNLFlBQU1GLE9BQU0sVUFBQ0QsRUFBU0UsRUFBZ0JDLEksT0FDNUIsT0FEaEIsU0FDZ0IsR0FBTTRCLFlBQVksQ0FDOUJDLFNBQVUsaURBQ1ZDLFlBQVksSyxPQUdoQixPQUxNSixFQUFVLFNBSWhCOUIsS0FBSzhCLFFBQVVBLEVBQ2YsR0FBTTlCLEtBQUtzQixRQ3JDZixpbEMsY0RxQ0ksU0FFTWEsRUFBZ0IsU0FBQ2pILEdBQ25CLFNBQUsrRSxRQUFRdEYsT0FBT3lILFlBQVlsSCxLQUNwQzhFLEtBQUs4QixRQUFRTyxRQUFRN0UsSUFBSSxzQkFBekJ3QyxDQUFnRG1DLEdBQ2hEbkMsS0FBSytCLGFBQWMsRSxZQUdSLFlBQUFQLGlCQUFmLFNBQWdDRCxHLDBGQUM1QixTQUFNdkIsS0FBSzhCLFFBQVFRLHdCQUF3QmYsSSxPQUMzQyxPQURBLFNBQ0l2QixLQUFLK0IsWUFDRSxDQUFQLEVBQU8vQixLQUFLOEIsUUFBUU8sUUFBUTdFLElBQUksYUFBekJ3QyxDQUF1Q3VCLElBRXZDLENBQVAsRUFBT3ZCLEtBQUs4QixRQUFRUyxlQUFlaEIsWUFHL0MsRUFsQ0EsQ0FBMkJpQixNIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcGFweXJvcy8uL25vZGVfbW9kdWxlcy9jb21saW5rL2Rpc3QvZXNtL2NvbWxpbmsubWpzIiwid2VicGFjazovL3BhcHlyb3MvLi9zcmMvQ29uc3RhbnRzLnRzIiwid2VicGFjazovL3BhcHlyb3MvLi9zcmMvdXRpbC9Mb2dnaW5nLnRzIiwid2VicGFjazovL3BhcHlyb3MvLi9zcmMvQmFja2VuZC50cyIsIndlYnBhY2s6Ly9wYXB5cm9zLy4vc3JjL3dvcmtlcnMvcHl0aG9uL1B5dGhvbldvcmtlci53b3JrZXIudHMiLCJ3ZWJwYWNrOi8vcGFweXJvcy8uL3NyYy93b3JrZXJzL3B5dGhvbi9pbml0LnB5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IHByb3h5TWFya2VyID0gU3ltYm9sKFwiQ29tbGluay5wcm94eVwiKTtcclxuY29uc3QgY3JlYXRlRW5kcG9pbnQgPSBTeW1ib2woXCJDb21saW5rLmVuZHBvaW50XCIpO1xyXG5jb25zdCByZWxlYXNlUHJveHkgPSBTeW1ib2woXCJDb21saW5rLnJlbGVhc2VQcm94eVwiKTtcclxuY29uc3QgdGhyb3dNYXJrZXIgPSBTeW1ib2woXCJDb21saW5rLnRocm93blwiKTtcclxuY29uc3QgaXNPYmplY3QgPSAodmFsKSA9PiAodHlwZW9mIHZhbCA9PT0gXCJvYmplY3RcIiAmJiB2YWwgIT09IG51bGwpIHx8IHR5cGVvZiB2YWwgPT09IFwiZnVuY3Rpb25cIjtcclxuLyoqXHJcbiAqIEludGVybmFsIHRyYW5zZmVyIGhhbmRsZSB0byBoYW5kbGUgb2JqZWN0cyBtYXJrZWQgdG8gcHJveHkuXHJcbiAqL1xyXG5jb25zdCBwcm94eVRyYW5zZmVySGFuZGxlciA9IHtcclxuICAgIGNhbkhhbmRsZTogKHZhbCkgPT4gaXNPYmplY3QodmFsKSAmJiB2YWxbcHJveHlNYXJrZXJdLFxyXG4gICAgc2VyaWFsaXplKG9iaikge1xyXG4gICAgICAgIGNvbnN0IHsgcG9ydDEsIHBvcnQyIH0gPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTtcclxuICAgICAgICBleHBvc2Uob2JqLCBwb3J0MSk7XHJcbiAgICAgICAgcmV0dXJuIFtwb3J0MiwgW3BvcnQyXV07XHJcbiAgICB9LFxyXG4gICAgZGVzZXJpYWxpemUocG9ydCkge1xyXG4gICAgICAgIHBvcnQuc3RhcnQoKTtcclxuICAgICAgICByZXR1cm4gd3JhcChwb3J0KTtcclxuICAgIH0sXHJcbn07XHJcbi8qKlxyXG4gKiBJbnRlcm5hbCB0cmFuc2ZlciBoYW5kbGVyIHRvIGhhbmRsZSB0aHJvd24gZXhjZXB0aW9ucy5cclxuICovXHJcbmNvbnN0IHRocm93VHJhbnNmZXJIYW5kbGVyID0ge1xyXG4gICAgY2FuSGFuZGxlOiAodmFsdWUpID0+IGlzT2JqZWN0KHZhbHVlKSAmJiB0aHJvd01hcmtlciBpbiB2YWx1ZSxcclxuICAgIHNlcmlhbGl6ZSh7IHZhbHVlIH0pIHtcclxuICAgICAgICBsZXQgc2VyaWFsaXplZDtcclxuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICBzZXJpYWxpemVkID0ge1xyXG4gICAgICAgICAgICAgICAgaXNFcnJvcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogdmFsdWUubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiB2YWx1ZS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YWNrOiB2YWx1ZS5zdGFjayxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzZXJpYWxpemVkID0geyBpc0Vycm9yOiBmYWxzZSwgdmFsdWUgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFtzZXJpYWxpemVkLCBbXV07XHJcbiAgICB9LFxyXG4gICAgZGVzZXJpYWxpemUoc2VyaWFsaXplZCkge1xyXG4gICAgICAgIGlmIChzZXJpYWxpemVkLmlzRXJyb3IpIHtcclxuICAgICAgICAgICAgdGhyb3cgT2JqZWN0LmFzc2lnbihuZXcgRXJyb3Ioc2VyaWFsaXplZC52YWx1ZS5tZXNzYWdlKSwgc2VyaWFsaXplZC52YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IHNlcmlhbGl6ZWQudmFsdWU7XHJcbiAgICB9LFxyXG59O1xyXG4vKipcclxuICogQWxsb3dzIGN1c3RvbWl6aW5nIHRoZSBzZXJpYWxpemF0aW9uIG9mIGNlcnRhaW4gdmFsdWVzLlxyXG4gKi9cclxuY29uc3QgdHJhbnNmZXJIYW5kbGVycyA9IG5ldyBNYXAoW1xyXG4gICAgW1wicHJveHlcIiwgcHJveHlUcmFuc2ZlckhhbmRsZXJdLFxyXG4gICAgW1widGhyb3dcIiwgdGhyb3dUcmFuc2ZlckhhbmRsZXJdLFxyXG5dKTtcclxuZnVuY3Rpb24gZXhwb3NlKG9iaiwgZXAgPSBzZWxmKSB7XHJcbiAgICBlcC5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBmdW5jdGlvbiBjYWxsYmFjayhldikge1xyXG4gICAgICAgIGlmICghZXYgfHwgIWV2LmRhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB7IGlkLCB0eXBlLCBwYXRoIH0gPSBPYmplY3QuYXNzaWduKHsgcGF0aDogW10gfSwgZXYuZGF0YSk7XHJcbiAgICAgICAgY29uc3QgYXJndW1lbnRMaXN0ID0gKGV2LmRhdGEuYXJndW1lbnRMaXN0IHx8IFtdKS5tYXAoZnJvbVdpcmVWYWx1ZSk7XHJcbiAgICAgICAgbGV0IHJldHVyblZhbHVlO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IHBhdGguc2xpY2UoMCwgLTEpLnJlZHVjZSgob2JqLCBwcm9wKSA9PiBvYmpbcHJvcF0sIG9iaik7XHJcbiAgICAgICAgICAgIGNvbnN0IHJhd1ZhbHVlID0gcGF0aC5yZWR1Y2UoKG9iaiwgcHJvcCkgPT4gb2JqW3Byb3BdLCBvYmopO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJHRVRcIiAvKiBHRVQgKi86XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHJhd1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJTRVRcIiAvKiBTRVQgKi86XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRbcGF0aC5zbGljZSgtMSlbMF1dID0gZnJvbVdpcmVWYWx1ZShldi5kYXRhLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJBUFBMWVwiIC8qIEFQUExZICovOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSByYXdWYWx1ZS5hcHBseShwYXJlbnQsIGFyZ3VtZW50TGlzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIkNPTlNUUlVDVFwiIC8qIENPTlNUUlVDVCAqLzpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbmV3IHJhd1ZhbHVlKC4uLmFyZ3VtZW50TGlzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gcHJveHkodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJFTkRQT0lOVFwiIC8qIEVORFBPSU5UICovOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBwb3J0MSwgcG9ydDIgfSA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBvc2Uob2JqLCBwb3J0Mik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gdHJhbnNmZXIocG9ydDEsIFtwb3J0MV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJSRUxFQVNFXCIgLyogUkVMRUFTRSAqLzpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoICh2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHsgdmFsdWUsIFt0aHJvd01hcmtlcl06IDAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKHJldHVyblZhbHVlKVxyXG4gICAgICAgICAgICAuY2F0Y2goKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlLCBbdGhyb3dNYXJrZXJdOiAwIH07XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oKHJldHVyblZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IFt3aXJlVmFsdWUsIHRyYW5zZmVyYWJsZXNdID0gdG9XaXJlVmFsdWUocmV0dXJuVmFsdWUpO1xyXG4gICAgICAgICAgICBlcC5wb3N0TWVzc2FnZShPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHdpcmVWYWx1ZSksIHsgaWQgfSksIHRyYW5zZmVyYWJsZXMpO1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJSRUxFQVNFXCIgLyogUkVMRUFTRSAqLykge1xyXG4gICAgICAgICAgICAgICAgLy8gZGV0YWNoIGFuZCBkZWFjdGl2ZSBhZnRlciBzZW5kaW5nIHJlbGVhc2UgcmVzcG9uc2UgYWJvdmUuXHJcbiAgICAgICAgICAgICAgICBlcC5yZW1vdmVFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBjYWxsYmFjayk7XHJcbiAgICAgICAgICAgICAgICBjbG9zZUVuZFBvaW50KGVwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBpZiAoZXAuc3RhcnQpIHtcclxuICAgICAgICBlcC5zdGFydCgpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGlzTWVzc2FnZVBvcnQoZW5kcG9pbnQpIHtcclxuICAgIHJldHVybiBlbmRwb2ludC5jb25zdHJ1Y3Rvci5uYW1lID09PSBcIk1lc3NhZ2VQb3J0XCI7XHJcbn1cclxuZnVuY3Rpb24gY2xvc2VFbmRQb2ludChlbmRwb2ludCkge1xyXG4gICAgaWYgKGlzTWVzc2FnZVBvcnQoZW5kcG9pbnQpKVxyXG4gICAgICAgIGVuZHBvaW50LmNsb3NlKCk7XHJcbn1cclxuZnVuY3Rpb24gd3JhcChlcCwgdGFyZ2V0KSB7XHJcbiAgICByZXR1cm4gY3JlYXRlUHJveHkoZXAsIFtdLCB0YXJnZXQpO1xyXG59XHJcbmZ1bmN0aW9uIHRocm93SWZQcm94eVJlbGVhc2VkKGlzUmVsZWFzZWQpIHtcclxuICAgIGlmIChpc1JlbGVhc2VkKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUHJveHkgaGFzIGJlZW4gcmVsZWFzZWQgYW5kIGlzIG5vdCB1c2VhYmxlXCIpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGNyZWF0ZVByb3h5KGVwLCBwYXRoID0gW10sIHRhcmdldCA9IGZ1bmN0aW9uICgpIHsgfSkge1xyXG4gICAgbGV0IGlzUHJveHlSZWxlYXNlZCA9IGZhbHNlO1xyXG4gICAgY29uc3QgcHJveHkgPSBuZXcgUHJveHkodGFyZ2V0LCB7XHJcbiAgICAgICAgZ2V0KF90YXJnZXQsIHByb3ApIHtcclxuICAgICAgICAgICAgdGhyb3dJZlByb3h5UmVsZWFzZWQoaXNQcm94eVJlbGVhc2VkKTtcclxuICAgICAgICAgICAgaWYgKHByb3AgPT09IHJlbGVhc2VQcm94eSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIlJFTEVBU0VcIiAvKiBSRUxFQVNFICovLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLm1hcCgocCkgPT4gcC50b1N0cmluZygpKSxcclxuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VFbmRQb2ludChlcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzUHJveHlSZWxlYXNlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChwcm9wID09PSBcInRoZW5cIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhdGgubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgdGhlbjogKCkgPT4gcHJveHkgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJHRVRcIiAvKiBHRVQgKi8sXHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogcGF0aC5tYXAoKHApID0+IHAudG9TdHJpbmcoKSksXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZyb21XaXJlVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHIudGhlbi5iaW5kKHIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVQcm94eShlcCwgWy4uLnBhdGgsIHByb3BdKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldChfdGFyZ2V0LCBwcm9wLCByYXdWYWx1ZSkge1xyXG4gICAgICAgICAgICB0aHJvd0lmUHJveHlSZWxlYXNlZChpc1Byb3h5UmVsZWFzZWQpO1xyXG4gICAgICAgICAgICAvLyBGSVhNRTogRVM2IFByb3h5IEhhbmRsZXIgYHNldGAgbWV0aG9kcyBhcmUgc3VwcG9zZWQgdG8gcmV0dXJuIGFcclxuICAgICAgICAgICAgLy8gYm9vbGVhbi4gVG8gc2hvdyBnb29kIHdpbGwsIHdlIHJldHVybiB0cnVlIGFzeW5jaHJvbm91c2x5IMKvXFxfKOODhClfL8KvXHJcbiAgICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgdHJhbnNmZXJhYmxlc10gPSB0b1dpcmVWYWx1ZShyYXdWYWx1ZSk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlNFVFwiIC8qIFNFVCAqLyxcclxuICAgICAgICAgICAgICAgIHBhdGg6IFsuLi5wYXRoLCBwcm9wXS5tYXAoKHApID0+IHAudG9TdHJpbmcoKSksXHJcbiAgICAgICAgICAgICAgICB2YWx1ZSxcclxuICAgICAgICAgICAgfSwgdHJhbnNmZXJhYmxlcykudGhlbihmcm9tV2lyZVZhbHVlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGFwcGx5KF90YXJnZXQsIF90aGlzQXJnLCByYXdBcmd1bWVudExpc3QpIHtcclxuICAgICAgICAgICAgdGhyb3dJZlByb3h5UmVsZWFzZWQoaXNQcm94eVJlbGVhc2VkKTtcclxuICAgICAgICAgICAgY29uc3QgbGFzdCA9IHBhdGhbcGF0aC5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgaWYgKGxhc3QgPT09IGNyZWF0ZUVuZHBvaW50KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiRU5EUE9JTlRcIiAvKiBFTkRQT0lOVCAqLyxcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnJvbVdpcmVWYWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gV2UganVzdCBwcmV0ZW5kIHRoYXQgYGJpbmQoKWAgZGlkbuKAmXQgaGFwcGVuLlxyXG4gICAgICAgICAgICBpZiAobGFzdCA9PT0gXCJiaW5kXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVQcm94eShlcCwgcGF0aC5zbGljZSgwLCAtMSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IFthcmd1bWVudExpc3QsIHRyYW5zZmVyYWJsZXNdID0gcHJvY2Vzc0FyZ3VtZW50cyhyYXdBcmd1bWVudExpc3QpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogXCJBUFBMWVwiIC8qIEFQUExZICovLFxyXG4gICAgICAgICAgICAgICAgcGF0aDogcGF0aC5tYXAoKHApID0+IHAudG9TdHJpbmcoKSksXHJcbiAgICAgICAgICAgICAgICBhcmd1bWVudExpc3QsXHJcbiAgICAgICAgICAgIH0sIHRyYW5zZmVyYWJsZXMpLnRoZW4oZnJvbVdpcmVWYWx1ZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb25zdHJ1Y3QoX3RhcmdldCwgcmF3QXJndW1lbnRMaXN0KSB7XHJcbiAgICAgICAgICAgIHRocm93SWZQcm94eVJlbGVhc2VkKGlzUHJveHlSZWxlYXNlZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IFthcmd1bWVudExpc3QsIHRyYW5zZmVyYWJsZXNdID0gcHJvY2Vzc0FyZ3VtZW50cyhyYXdBcmd1bWVudExpc3QpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdFJlc3BvbnNlTWVzc2FnZShlcCwge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogXCJDT05TVFJVQ1RcIiAvKiBDT05TVFJVQ1QgKi8sXHJcbiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLm1hcCgocCkgPT4gcC50b1N0cmluZygpKSxcclxuICAgICAgICAgICAgICAgIGFyZ3VtZW50TGlzdCxcclxuICAgICAgICAgICAgfSwgdHJhbnNmZXJhYmxlcykudGhlbihmcm9tV2lyZVZhbHVlKTtcclxuICAgICAgICB9LFxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcHJveHk7XHJcbn1cclxuZnVuY3Rpb24gbXlGbGF0KGFycikge1xyXG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5jb25jYXQuYXBwbHkoW10sIGFycik7XHJcbn1cclxuZnVuY3Rpb24gcHJvY2Vzc0FyZ3VtZW50cyhhcmd1bWVudExpc3QpIHtcclxuICAgIGNvbnN0IHByb2Nlc3NlZCA9IGFyZ3VtZW50TGlzdC5tYXAodG9XaXJlVmFsdWUpO1xyXG4gICAgcmV0dXJuIFtwcm9jZXNzZWQubWFwKCh2KSA9PiB2WzBdKSwgbXlGbGF0KHByb2Nlc3NlZC5tYXAoKHYpID0+IHZbMV0pKV07XHJcbn1cclxuY29uc3QgdHJhbnNmZXJDYWNoZSA9IG5ldyBXZWFrTWFwKCk7XHJcbmZ1bmN0aW9uIHRyYW5zZmVyKG9iaiwgdHJhbnNmZXJzKSB7XHJcbiAgICB0cmFuc2ZlckNhY2hlLnNldChvYmosIHRyYW5zZmVycyk7XHJcbiAgICByZXR1cm4gb2JqO1xyXG59XHJcbmZ1bmN0aW9uIHByb3h5KG9iaikge1xyXG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24ob2JqLCB7IFtwcm94eU1hcmtlcl06IHRydWUgfSk7XHJcbn1cclxuZnVuY3Rpb24gd2luZG93RW5kcG9pbnQodywgY29udGV4dCA9IHNlbGYsIHRhcmdldE9yaWdpbiA9IFwiKlwiKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHBvc3RNZXNzYWdlOiAobXNnLCB0cmFuc2ZlcmFibGVzKSA9PiB3LnBvc3RNZXNzYWdlKG1zZywgdGFyZ2V0T3JpZ2luLCB0cmFuc2ZlcmFibGVzKSxcclxuICAgICAgICBhZGRFdmVudExpc3RlbmVyOiBjb250ZXh0LmFkZEV2ZW50TGlzdGVuZXIuYmluZChjb250ZXh0KSxcclxuICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyOiBjb250ZXh0LnJlbW92ZUV2ZW50TGlzdGVuZXIuYmluZChjb250ZXh0KSxcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gdG9XaXJlVmFsdWUodmFsdWUpIHtcclxuICAgIGZvciAoY29uc3QgW25hbWUsIGhhbmRsZXJdIG9mIHRyYW5zZmVySGFuZGxlcnMpIHtcclxuICAgICAgICBpZiAoaGFuZGxlci5jYW5IYW5kbGUodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IFtzZXJpYWxpemVkVmFsdWUsIHRyYW5zZmVyYWJsZXNdID0gaGFuZGxlci5zZXJpYWxpemUodmFsdWUpO1xyXG4gICAgICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiSEFORExFUlwiIC8qIEhBTkRMRVIgKi8sXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZSxcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogc2VyaWFsaXplZFZhbHVlLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHRyYW5zZmVyYWJsZXMsXHJcbiAgICAgICAgICAgIF07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHR5cGU6IFwiUkFXXCIgLyogUkFXICovLFxyXG4gICAgICAgICAgICB2YWx1ZSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRyYW5zZmVyQ2FjaGUuZ2V0KHZhbHVlKSB8fCBbXSxcclxuICAgIF07XHJcbn1cclxuZnVuY3Rpb24gZnJvbVdpcmVWYWx1ZSh2YWx1ZSkge1xyXG4gICAgc3dpdGNoICh2YWx1ZS50eXBlKSB7XHJcbiAgICAgICAgY2FzZSBcIkhBTkRMRVJcIiAvKiBIQU5ETEVSICovOlxyXG4gICAgICAgICAgICByZXR1cm4gdHJhbnNmZXJIYW5kbGVycy5nZXQodmFsdWUubmFtZSkuZGVzZXJpYWxpemUodmFsdWUudmFsdWUpO1xyXG4gICAgICAgIGNhc2UgXCJSQVdcIiAvKiBSQVcgKi86XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS52YWx1ZTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZXF1ZXN0UmVzcG9uc2VNZXNzYWdlKGVwLCBtc2csIHRyYW5zZmVycykge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaWQgPSBnZW5lcmF0ZVVVSUQoKTtcclxuICAgICAgICBlcC5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCBmdW5jdGlvbiBsKGV2KSB7XHJcbiAgICAgICAgICAgIGlmICghZXYuZGF0YSB8fCAhZXYuZGF0YS5pZCB8fCBldi5kYXRhLmlkICE9PSBpZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVwLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIGwpO1xyXG4gICAgICAgICAgICByZXNvbHZlKGV2LmRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChlcC5zdGFydCkge1xyXG4gICAgICAgICAgICBlcC5zdGFydCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlcC5wb3N0TWVzc2FnZShPYmplY3QuYXNzaWduKHsgaWQgfSwgbXNnKSwgdHJhbnNmZXJzKTtcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIGdlbmVyYXRlVVVJRCgpIHtcclxuICAgIHJldHVybiBuZXcgQXJyYXkoNClcclxuICAgICAgICAuZmlsbCgwKVxyXG4gICAgICAgIC5tYXAoKCkgPT4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpLnRvU3RyaW5nKDE2KSlcclxuICAgICAgICAuam9pbihcIi1cIik7XHJcbn1cblxuZXhwb3J0IHsgY3JlYXRlRW5kcG9pbnQsIGV4cG9zZSwgcHJveHksIHByb3h5TWFya2VyLCByZWxlYXNlUHJveHksIHRyYW5zZmVyLCB0cmFuc2ZlckhhbmRsZXJzLCB3aW5kb3dFbmRwb2ludCwgd3JhcCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29tbGluay5tanMubWFwXG4iLCJleHBvcnQgY29uc3QgTUFJTl9BUFBfSUQgPSBcInBhcHlyb3NcIjtcblxuZXhwb3J0IGNvbnN0IE9VVFBVVF9UQV9JRCA9IFwiY29kZS1vdXRwdXQtYXJlYVwiO1xuZXhwb3J0IGNvbnN0IElOUFVUX1RBX0lEID0gXCJjb2RlLWlucHV0LWFyZWFcIjtcbmV4cG9ydCBjb25zdCBDT0RFX1RBX0lEID0gXCJjb2RlLWFyZWFcIjtcblxuZXhwb3J0IGNvbnN0IFJVTl9CVE5fSUQgPSBcInJ1bi1jb2RlLWJ0blwiO1xuZXhwb3J0IGNvbnN0IFRFUk1JTkFURV9CVE5fSUQgPSBcInRlcm1pbmF0ZS1idG5cIjtcblxuZXhwb3J0IGNvbnN0IExBTkdVQUdFX1NFTEVDVF9JRCA9IFwibGFuZ3VhZ2Utc2VsZWN0XCI7XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX1BST0dSQU1NSU5HX0xBTkdVQUdFID0gXCJweXRob25cIjtcblxuZXhwb3J0IGNvbnN0IElOUFVUX1JFTEFUSVZFX1VSTCA9IFwiL19fcGFweXJvc19pbnB1dFwiO1xuIiwiZXhwb3J0IGVudW0gTG9nVHlwZSB7XG4gICAgRGVidWcsIEVycm9yLCBJbXBvcnRhbnRcbn1cblxuY29uc3QgRU5WSVJPTk1FTlQ6IHN0cmluZyA9IHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8IFwiZGV2ZWxvcG1lbnRcIjtcbmV4cG9ydCBmdW5jdGlvbiBwYXB5cm9zTG9nKGxvZ1R5cGU6IExvZ1R5cGUsIC4uLmFyZ3M6IGFueVtdKTogdm9pZCB7XG4gICAgY29uc3QgZG9Mb2cgPSBFTlZJUk9OTUVOVCAhPT0gXCJwcm9kdWN0aW9uXCIgfHwgbG9nVHlwZSAhPT0gTG9nVHlwZS5EZWJ1ZztcbiAgICBpZiAoZG9Mb2cpIHtcbiAgICAgICAgaWYgKGxvZ1R5cGUgPT09IExvZ1R5cGUuRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoLi4uYXJncyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyguLi5hcmdzKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsImltcG9ydCB7IElOUFVUX1JFTEFUSVZFX1VSTCB9IGZyb20gXCIuL0NvbnN0YW50c1wiO1xuaW1wb3J0IHsgUGFweXJvc0V2ZW50IH0gZnJvbSBcIi4vUGFweXJvc0V2ZW50XCI7XG5pbXBvcnQgeyBMb2dUeXBlLCBwYXB5cm9zTG9nIH0gZnJvbSBcIi4vdXRpbC9Mb2dnaW5nXCI7XG5cbmZ1bmN0aW9uIGdldElucHV0Q2FsbGJhY2soaW5wdXRUZXh0QXJyYXk/OiBVaW50OEFycmF5LCBpbnB1dE1ldGFEYXRhPzogSW50MzJBcnJheSk6ICgpID0+IHN0cmluZyB7XG4gICAgaWYgKGlucHV0VGV4dEFycmF5ICYmIGlucHV0TWV0YURhdGEpIHtcbiAgICAgICAgY29uc3QgdGV4dERlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zdGFudC1jb25kaXRpb25cbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKEF0b21pY3Mud2FpdChpbnB1dE1ldGFEYXRhLCAwLCAwLCAxMDApID09PSBcInRpbWVkLW91dFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHBhcHlyb3NMb2cubG9nKFwid2FpdGluZyBvbiBpbnB1dFwiKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgKGludGVycnVwdEJ1ZmZlclswXSA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICAvLyAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBBdG9taWNzLnN0b3JlKGlucHV0TWV0YURhdGEsIDAsIDApO1xuICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IEF0b21pY3MuZXhjaGFuZ2UoaW5wdXRNZXRhRGF0YSwgMSwgMCk7XG4gICAgICAgICAgICBjb25zdCBieXRlcyA9IGlucHV0VGV4dEFycmF5LnNsaWNlKDAsIHNpemUpO1xuICAgICAgICAgICAgcmV0dXJuIHRleHREZWNvZGVyLmRlY29kZShieXRlcyk7XG4gICAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICAvLyBgZmFsc2VgIG1ha2VzIHRoZSByZXF1ZXN0IHN5bmNocm9ub3VzXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5vcGVuKFwiR0VUXCIsIElOUFVUX1JFTEFUSVZFX1VSTCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIHJlcXVlc3Quc2VuZChudWxsKTtcbiAgICAgICAgICAgIH0gd2hpbGUgKHJlcXVlc3Quc3RhdHVzID49IDQwMCk7IC8vIHRvZG8gYmV0dGVyIGVycm9yIGhhbmRsaW5nXG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdC5yZXNwb25zZVRleHQ7XG4gICAgICAgIH07XG4gICAgfVxufVxuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmFja2VuZCB7XG4gICAgb25FdmVudDogKGU6IFBhcHlyb3NFdmVudCkgPT4gdm9pZDtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWVtcHR5LWZ1bmN0aW9uXG4gICAgICAgIHRoaXMub25FdmVudCA9ICgpID0+IHsgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBiYWNrZW5kLCBzZXR0aW5nIHVwIGFueSBnbG9iYWxzIHJlcXVpcmVkXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbihQYXB5cm9zRXZlbnQpOnZvaWR9IG9uRXZlbnQgQ2FsbGJhY2sgZm9yIHdoZW4gZXZlbnRzIG9jY3VyXG4gICAgICogQHBhcmFtIHtVaW50OEFycmF5fSBpbnB1dFRleHRBcnJheSBPcHRpb25hbCBzaGFyZWQgYnVmZmVyIGZvciBpbnB1dFxuICAgICAqIEBwYXJhbSB7SW50MzJBcnJheX0gaW5wdXRNZXRhRGF0YSBPcHRpb25hbCBzaGFyZWQgYnVmZmVyIGZvciBtZXRhZGF0YSBhYm91dCBpbnB1dFxuICAgICAqIEByZXR1cm4ge1Byb21pc2U8dm9pZD59IFByb21pc2Ugb2YgbGF1bmNoaW5nXG4gICAgICovXG4gICAgbGF1bmNoKG9uRXZlbnQ6IChlOiBQYXB5cm9zRXZlbnQpID0+IHZvaWQsXG4gICAgICAgIGlucHV0VGV4dEFycmF5PzogVWludDhBcnJheSwgaW5wdXRNZXRhRGF0YT86IEludDMyQXJyYXkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgaW5wdXRDYWxsYmFjayA9IGdldElucHV0Q2FsbGJhY2soaW5wdXRUZXh0QXJyYXksIGlucHV0TWV0YURhdGEpO1xuICAgICAgICB0aGlzLm9uRXZlbnQgPSAoZTogUGFweXJvc0V2ZW50KSA9PiB7XG4gICAgICAgICAgICBvbkV2ZW50KGUpO1xuICAgICAgICAgICAgaWYgKGUudHlwZSA9PT0gXCJpbnB1dFwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0Q2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cblxuICAgIGFic3RyYWN0IF9ydW5Db2RlSW50ZXJuYWwoY29kZTogc3RyaW5nKTogUHJvbWlzZTxhbnk+O1xuXG4gICAgLyoqXG4gICAgICogVmFsaWRhdGUgYW5kIHJ1biBhcmJpdHJhcnkgY29kZVxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjb2RlIFRoZSBjb2RlIHRvIHJ1blxuICAgICAqIEByZXR1cm4ge1Byb21pc2U8dm9pZD59IFByb21pc2Ugb2YgZXhlY3V0aW9uXG4gICAgICovXG4gICAgYXN5bmMgcnVuQ29kZShjb2RlOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcGFweXJvc0xvZyhMb2dUeXBlLkRlYnVnLCBcIlJ1bm5pbmcgY29kZSBpbiB3b3JrZXI6IFwiLCBjb2RlKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLl9ydW5Db2RlSW50ZXJuYWwoY29kZSk7XG4gICAgICAgICAgICBwYXB5cm9zTG9nKExvZ1R5cGUuSW1wb3J0YW50LCBcInJhbiBjb2RlOiBcIiArIGNvZGUgKyBcIiBhbmQgcmVjZWl2ZWQ6IFwiLCBkYXRhKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9uRXZlbnQoeyB0eXBlOiBcInN1Y2Nlc3NcIiwgZGF0YTogZGF0YSB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICAgICAgY29uc3QgZXJyb3JTdHJpbmcgPSBcInRvU3RyaW5nXCIgaW4gZXJyb3IgPyBlcnJvci50b1N0cmluZygpIDogSlNPTi5zdHJpbmdpZnkoZXJyb3IpO1xuICAgICAgICAgICAgcGFweXJvc0xvZyhMb2dUeXBlLkVycm9yLCBcIkVycm9yIGR1cmluZyBleGVjdXRpb246IFwiLCBlcnJvciwgZXJyb3JTdHJpbmcpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub25FdmVudCh7IHR5cGU6IFwiZXJyb3JcIiwgZGF0YTogZXJyb3JTdHJpbmcgfSk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCJpbXBvcnQgeyBleHBvc2UgfSBmcm9tIFwiY29tbGlua1wiO1xuaW1wb3J0IHsgQmFja2VuZCB9IGZyb20gXCIuLi8uLi9CYWNrZW5kXCI7XG5pbXBvcnQgeyBQYXB5cm9zRXZlbnQgfSBmcm9tIFwiLi4vLi4vUGFweXJvc0V2ZW50XCI7XG5pbXBvcnQgeyBJTklUSUFMSVpBVElPTl9DT0RFIH0gZnJvbSBcIi4vaW5pdC5weVwiO1xuXG5pbnRlcmZhY2UgTG9hZFB5b2RpZGVBcmdzIHtcbiAgICBpbmRleFVSTDogc3RyaW5nO1xuICAgIGZ1bGxTdGRMaWI6IGJvb2xlYW47XG59XG5pbnRlcmZhY2UgUHlvZGlkZSB7XG4gICAgcnVuUHl0aG9uQXN5bmM6IChjb2RlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD47XG4gICAgbG9hZFBhY2thZ2VzRnJvbUltcG9ydHM6IChjb2RlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD47XG4gICAgZ2xvYmFsczogTWFwPHN0cmluZywgYW55Pjtcbn1cbmRlY2xhcmUgZnVuY3Rpb24gaW1wb3J0U2NyaXB0cyguLi51cmxzOiBzdHJpbmdbXSk6IHZvaWQ7XG5kZWNsYXJlIGZ1bmN0aW9uIGxvYWRQeW9kaWRlKGFyZ3M6IExvYWRQeW9kaWRlQXJncyk6IFByb21pc2U8UHlvZGlkZT47XG5cbmltcG9ydFNjcmlwdHMoXCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvcHlvZGlkZS92MC4xOC4xL2Z1bGwvcHlvZGlkZS5qc1wiKTtcblxuXG5jbGFzcyBQeXRob25Xb3JrZXIgZXh0ZW5kcyBCYWNrZW5kIHtcbiAgICBweW9kaWRlOiBQeW9kaWRlO1xuICAgIGluaXRpYWxpemVkOiBib29sZWFuO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMucHlvZGlkZSA9IHt9IGFzIFB5b2RpZGU7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBvdmVycmlkZSBhc3luYyBsYXVuY2gob25FdmVudDogKGU6IFBhcHlyb3NFdmVudCkgPT4gdm9pZCxcbiAgICAgICAgaW5wdXRUZXh0QXJyYXk/OiBVaW50OEFycmF5LCBpbnB1dE1ldGFEYXRhPzogSW50MzJBcnJheSk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCBzdXBlci5sYXVuY2gob25FdmVudCwgaW5wdXRUZXh0QXJyYXksIGlucHV0TWV0YURhdGEpO1xuICAgICAgICBjb25zdCBweW9kaWRlID0gYXdhaXQgbG9hZFB5b2RpZGUoe1xuICAgICAgICAgICAgaW5kZXhVUkw6IFwiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L3B5b2RpZGUvdjAuMTguMS9mdWxsL1wiLFxuICAgICAgICAgICAgZnVsbFN0ZExpYjogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5weW9kaWRlID0gcHlvZGlkZTtcbiAgICAgICAgYXdhaXQgdGhpcy5ydW5Db2RlKElOSVRJQUxJWkFUSU9OX0NPREUpO1xuICAgICAgICAvLyBQeXRob24gY2FsbHMgb3VyIGZ1bmN0aW9uIHdpdGggYSBkaWN0LCB3aGljaCBtdXN0IGJlIGNvbnZlcnRlZCB0byBhIFBhcHlyb3NFdmVudFxuICAgICAgICBjb25zdCBldmVudENhbGxiYWNrID0gKGRhdGE6IE1hcDxzdHJpbmcsIGFueT4pOiB2b2lkID0+XG4gICAgICAgICAgICB0aGlzLm9uRXZlbnQoT2JqZWN0LmZyb21FbnRyaWVzKGRhdGEpIGFzIFBhcHlyb3NFdmVudCk7XG4gICAgICAgIHRoaXMucHlvZGlkZS5nbG9iYWxzLmdldChcIl9fb3ZlcnJpZGVfYnVpbHRpbnNcIikoZXZlbnRDYWxsYmFjayk7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIG92ZXJyaWRlIGFzeW5jIF9ydW5Db2RlSW50ZXJuYWwoY29kZTogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5weW9kaWRlLmxvYWRQYWNrYWdlc0Zyb21JbXBvcnRzKGNvZGUpO1xuICAgICAgICBpZiAodGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucHlvZGlkZS5nbG9iYWxzLmdldChcIl9fcnVuX2NvZGVcIikoY29kZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5weW9kaWRlLnJ1blB5dGhvbkFzeW5jKGNvZGUpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvc2UobmV3IFB5dGhvbldvcmtlcigpKTtcbiIsImV4cG9ydCBjb25zdCBJTklUSUFMSVpBVElPTl9DT0RFID1cbiAgICBgXG5mcm9tIHB5b2RpZGUgaW1wb3J0IHRvX2pzXG5pbXBvcnQgc3lzXG5cbmRlZiBfX292ZXJyaWRlX2J1aWx0aW5zKGNiKTpcbiAgICBfX2NhcHR1cmVfc3Rkb3V0KGNiKVxuICAgIF9fb3ZlcnJpZGVfc3RkaW4oY2IpXG5cbmRlZiBfX2NhcHR1cmVfc3Rkb3V0KGNiKTpcbiAgICBjbGFzcyBfT3V0cHV0V3JpdGVyOlxuXG4gICAgICAgIGRlZiB3cml0ZShzZWxmLCBzKTpcbiAgICAgICAgICAgIGNiKHRvX2pzKHtcInR5cGVcIjogXCJvdXRwdXRcIiwgXCJkYXRhXCI6c30pKVxuXG4gICAgICAgIGRlZiBmbHVzaChzZWxmKTpcbiAgICAgICAgICAgIHBhc3MgIyBHaXZlbiBkYXRhIGlzIGFsd2F5cyBpbW1lZGlhdGVseSB3cml0dGVuXG5cbiAgICBnbG9iYWwgcHJpbnRcbiAgICBfX29yaWdpbmFsX3ByaW50ID0gcHJpbnRcbiAgICBfX3dyaXRlciA9IF9PdXRwdXRXcml0ZXIoKVxuXG4gICAgZGVmIF9fZG9kb25hX3ByaW50KCpvYmplY3RzLCBzZXA9JyAnLCBlbmQ9J1xcXFxuJywgZmlsZT1zeXMuc3Rkb3V0LCBmbHVzaD1GYWxzZSk6XG4gICAgICAgIGlmIGZpbGUgPT0gc3lzLnN0ZG91dDpcbiAgICAgICAgICAgIF9fb3JpZ2luYWxfcHJpbnQoKm9iamVjdHMsIHNlcD1zZXAsIGVuZD1lbmQsIGZpbGU9X193cml0ZXIsIGZsdXNoPWZsdXNoKVxuICAgICAgICBlbHNlOlxuICAgICAgICAgICAgX19vcmlnaW5hbF9wcmludCgqb2JqZWN0cywgc2VwPXNlcCwgZW5kPWVuZCwgZmlsZT1maWxlLCBmbHVzaD1mbHVzaClcblxuICAgIHByaW50ID0gX19kb2RvbmFfcHJpbnRcblxuZGVmIF9fb3ZlcnJpZGVfc3RkaW4oY2IpOlxuICAgIGdsb2JhbCBpbnB1dFxuICAgIGRlZiBfX2RvZG9uYV9pbnB1dChwcm9tcHQ9XCJcIik6XG4gICAgICAgIHByaW50KHByb21wdCwgZW5kPVwiXCIpXG4gICAgICAgIHVzZXJfdmFsdWUgPSBjYih0b19qcyh7XCJ0eXBlXCI6IFwiaW5wdXRcIiwgXCJkYXRhXCI6cHJvbXB0fSkpXG4gICAgICAgIHByaW50KHVzZXJfdmFsdWUpXG4gICAgICAgIHJldHVybiB1c2VyX3ZhbHVlXG5cbiAgICBpbnB1dCA9IF9fZG9kb25hX2lucHV0XG5cbmRlZiBfX3J1bl9jb2RlKGNvZGUpOlxuICAgIHJldHVybiBleGVjKGNvZGUsIGRpY3QoZ2xvYmFscygpKSlcbmA7XG4iXSwibmFtZXMiOlsicHJveHlNYXJrZXIiLCJTeW1ib2wiLCJjcmVhdGVFbmRwb2ludCIsInJlbGVhc2VQcm94eSIsInRocm93TWFya2VyIiwiaXNPYmplY3QiLCJ2YWwiLCJ0cmFuc2ZlckhhbmRsZXJzIiwiTWFwIiwiY2FuSGFuZGxlIiwic2VyaWFsaXplIiwib2JqIiwicG9ydDEiLCJwb3J0MiIsIk1lc3NhZ2VDaGFubmVsIiwiZXhwb3NlIiwiZGVzZXJpYWxpemUiLCJwb3J0Iiwic3RhcnQiLCJjcmVhdGVQcm94eSIsInRhcmdldCIsInZhbHVlIiwic2VyaWFsaXplZCIsIkVycm9yIiwiaXNFcnJvciIsIm1lc3NhZ2UiLCJuYW1lIiwic3RhY2siLCJPYmplY3QiLCJhc3NpZ24iLCJlcCIsInNlbGYiLCJhZGRFdmVudExpc3RlbmVyIiwiY2FsbGJhY2siLCJldiIsImRhdGEiLCJpZCIsInR5cGUiLCJwYXRoIiwiYXJndW1lbnRMaXN0IiwibWFwIiwiZnJvbVdpcmVWYWx1ZSIsInJldHVyblZhbHVlIiwicGFyZW50Iiwic2xpY2UiLCJyZWR1Y2UiLCJwcm9wIiwicmF3VmFsdWUiLCJhcHBseSIsInByb3h5IiwidHJhbnNmZXJzIiwidHJhbnNmZXJDYWNoZSIsInNldCIsInRyYW5zZmVyIiwidW5kZWZpbmVkIiwiUHJvbWlzZSIsInJlc29sdmUiLCJjYXRjaCIsInRoZW4iLCJ3aXJlVmFsdWUiLCJ0cmFuc2ZlcmFibGVzIiwidG9XaXJlVmFsdWUiLCJwb3N0TWVzc2FnZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjbG9zZUVuZFBvaW50IiwiZW5kcG9pbnQiLCJjb25zdHJ1Y3RvciIsImlzTWVzc2FnZVBvcnQiLCJjbG9zZSIsInRocm93SWZQcm94eVJlbGVhc2VkIiwiaXNSZWxlYXNlZCIsImlzUHJveHlSZWxlYXNlZCIsIlByb3h5IiwiZ2V0IiwiX3RhcmdldCIsInJlcXVlc3RSZXNwb25zZU1lc3NhZ2UiLCJwIiwidG9TdHJpbmciLCJsZW5ndGgiLCJyIiwiYmluZCIsIl90aGlzQXJnIiwicmF3QXJndW1lbnRMaXN0IiwibGFzdCIsInByb2Nlc3NBcmd1bWVudHMiLCJjb25zdHJ1Y3QiLCJwcm9jZXNzZWQiLCJ2IiwiYXJyIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJjb25jYXQiLCJXZWFrTWFwIiwiaGFuZGxlciIsInNlcmlhbGl6ZWRWYWx1ZSIsIm1zZyIsImZpbGwiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJOdW1iZXIiLCJNQVhfU0FGRV9JTlRFR0VSIiwiam9pbiIsImwiLCJMb2dUeXBlIiwicGFweXJvc0xvZyIsImxvZ1R5cGUiLCJkb0xvZyIsIkRlYnVnIiwiY29uc29sZSIsImVycm9yIiwiYXJncyIsImxvZyIsInRoaXMiLCJvbkV2ZW50IiwibGF1bmNoIiwiaW5wdXRUZXh0QXJyYXkiLCJpbnB1dE1ldGFEYXRhIiwiaW5wdXRDYWxsYmFjayIsIlRleHREZWNvZGVyIiwiQXRvbWljcyIsIndhaXQiLCJzdG9yZSIsInNpemUiLCJleGNoYW5nZSIsImJ5dGVzIiwiZGVjb2RlIiwicmVxdWVzdCIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsInNlbmQiLCJzdGF0dXMiLCJyZXNwb25zZVRleHQiLCJnZXRJbnB1dENhbGxiYWNrIiwiZSIsInJ1bkNvZGUiLCJjb2RlIiwiX3J1bkNvZGVJbnRlcm5hbCIsIkltcG9ydGFudCIsImVycm9yU3RyaW5nIiwiSlNPTiIsInN0cmluZ2lmeSIsImltcG9ydFNjcmlwdHMiLCJweW9kaWRlIiwiaW5pdGlhbGl6ZWQiLCJsb2FkUHlvZGlkZSIsImluZGV4VVJMIiwiZnVsbFN0ZExpYiIsImV2ZW50Q2FsbGJhY2siLCJmcm9tRW50cmllcyIsImdsb2JhbHMiLCJsb2FkUGFja2FnZXNGcm9tSW1wb3J0cyIsInJ1blB5dGhvbkFzeW5jIiwiQmFja2VuZCJdLCJzb3VyY2VSb290IjoiIn0=